{"nbformat":4,"nbformat_minor":5,"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.10"},"colab":{"name":"Keras-Seq2Seq.ipynb-V4(tf-transformer) のコピー","provenance":[{"file_id":"1gnTHtlUIXvbmdN-wj3XYh0cbA9ZxNayY","timestamp":1627989175920},{"file_id":"16nCJuq5pVhz4ttGLwJJdLsq1cnJND_MV","timestamp":1627949471558},{"file_id":"17dS2uuvu8xYuVB50nQ_dKMxZ1339v3gS","timestamp":1627522945553},{"file_id":"10Z2NcwruxPj3Zq-h6ZCIBh5jtG9_dKNw","timestamp":1627428694725}],"collapsed_sections":[]},"widgets":{"application/vnd.jupyter.widget-state+json":{"f9d96492f2fd4806859d354b967ab8f0":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_e17b9d1dcae34e09892dc7d07cad9a79","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_0c6b0df3930445b2b51ac5443c8bccb4","IPY_MODEL_70c0333120d74d5eab3bb75d2655c726"]}},"e17b9d1dcae34e09892dc7d07cad9a79":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"0c6b0df3930445b2b51ac5443c8bccb4":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_c87f71dcc88b4d6cb647af08ba29168c","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":257706,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":257706,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_4c4922cff03c4671a108eab87bf5218d"}},"70c0333120d74d5eab3bb75d2655c726":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_981e995d493247dc9a0cef9e8e25163b","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 258k/258k [00:01&lt;00:00, 161kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_001ef2ea9b9a4b9e8c50b5ac34d50a47"}},"c87f71dcc88b4d6cb647af08ba29168c":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"4c4922cff03c4671a108eab87bf5218d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"981e995d493247dc9a0cef9e8e25163b":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"001ef2ea9b9a4b9e8c50b5ac34d50a47":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"38b0a96d298a4de9a7807032d6a5b131":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_2bcb9147da574301b9d17cbfc30faa7d","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_a39a3edbc859403ea944c61f13a1cb39","IPY_MODEL_2c995c45283c42ee9b948bd2f9a13715"]}},"2bcb9147da574301b9d17cbfc30faa7d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"a39a3edbc859403ea944c61f13a1cb39":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_c180c8fde9f048fb81f849c0fcc9c64b","_dom_classes":[],"description":"Downloading: 100%","_model_name":"FloatProgressModel","bar_style":"success","max":110,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":110,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_65a23ff7a1ef4c22bc5f78a4af393b78"}},"2c995c45283c42ee9b948bd2f9a13715":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_3db07c27917d489e85a5c525e1f78d0e","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 110/110 [00:00&lt;00:00, 319B/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_e20d578eb9ec49cd839389b4ed0359c1"}},"c180c8fde9f048fb81f849c0fcc9c64b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"65a23ff7a1ef4c22bc5f78a4af393b78":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"3db07c27917d489e85a5c525e1f78d0e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"e20d578eb9ec49cd839389b4ed0359c1":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}},"accelerator":"GPU"},"cells":[{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"n9wrEuhGc0Fk","executionInfo":{"status":"ok","timestamp":1627989203430,"user_tz":-540,"elapsed":356,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"6759c47f-44bc-46e7-b020-4f4dd038c26b"},"source":["gpu_info = !nvidia-smi\n","gpu_info = '\\n'.join(gpu_info)\n","if gpu_info.find('failed') >= 0:\n","  print('Select the Runtime > \"Change runtime type\" menu to enable a GPU accelerator, ')\n","  print('and then re-execute this cell.')\n","else:\n","  print(gpu_info)"],"id":"n9wrEuhGc0Fk","execution_count":1,"outputs":[{"output_type":"stream","text":["Tue Aug  3 11:13:22 2021       \n","+-----------------------------------------------------------------------------+\n","| NVIDIA-SMI 470.42.01    Driver Version: 460.32.03    CUDA Version: 11.2     |\n","|-------------------------------+----------------------+----------------------+\n","| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n","| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n","|                               |                      |               MIG M. |\n","|===============================+======================+======================|\n","|   0  Tesla P100-PCIE...  Off  | 00000000:00:04.0 Off |                    0 |\n","| N/A   35C    P0    27W / 250W |      0MiB / 16280MiB |      0%      Default |\n","|                               |                      |                  N/A |\n","+-------------------------------+----------------------+----------------------+\n","                                                                               \n","+-----------------------------------------------------------------------------+\n","| Processes:                                                                  |\n","|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |\n","|        ID   ID                                                   Usage      |\n","|=============================================================================|\n","|  No running processes found                                                 |\n","+-----------------------------------------------------------------------------+\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"KK4aJbMtJmIz","executionInfo":{"status":"ok","timestamp":1627989221384,"user_tz":-540,"elapsed":13548,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"6b6e9a18-36f5-4724-ad5e-1ea217bec9c3"},"source":["!pip install transformers==4.5.0 fugashi==1.1.0 ipadic==1.0.0"],"id":"KK4aJbMtJmIz","execution_count":2,"outputs":[{"output_type":"stream","text":["Collecting transformers==4.5.0\n","  Downloading transformers-4.5.0-py3-none-any.whl (2.1 MB)\n","\u001b[K     |████████████████████████████████| 2.1 MB 7.3 MB/s \n","\u001b[?25hCollecting fugashi==1.1.0\n","  Downloading fugashi-1.1.0-cp37-cp37m-manylinux1_x86_64.whl (486 kB)\n","\u001b[K     |████████████████████████████████| 486 kB 57.9 MB/s \n","\u001b[?25hCollecting ipadic==1.0.0\n","  Downloading ipadic-1.0.0.tar.gz (13.4 MB)\n","\u001b[K     |████████████████████████████████| 13.4 MB 15.5 MB/s \n","\u001b[?25hRequirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (2.23.0)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (3.0.12)\n","Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (4.6.1)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (4.41.1)\n","Collecting tokenizers<0.11,>=0.10.1\n","  Downloading tokenizers-0.10.3-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (3.3 MB)\n","\u001b[K     |████████████████████████████████| 3.3 MB 56.8 MB/s \n","\u001b[?25hRequirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (21.0)\n","Collecting sacremoses\n","  Downloading sacremoses-0.0.45-py3-none-any.whl (895 kB)\n","\u001b[K     |████████████████████████████████| 895 kB 40.2 MB/s \n","\u001b[?25hRequirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (1.19.5)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (2019.12.20)\n","Requirement already satisfied: typing-extensions>=3.6.4 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->transformers==4.5.0) (3.7.4.3)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->transformers==4.5.0) (3.5.0)\n","Requirement already satisfied: pyparsing>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging->transformers==4.5.0) (2.4.7)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (3.0.4)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (2021.5.30)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (1.24.3)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (2.10)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers==4.5.0) (1.0.1)\n","Requirement already satisfied: click in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers==4.5.0) (7.1.2)\n","Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers==4.5.0) (1.15.0)\n","Building wheels for collected packages: ipadic\n","  Building wheel for ipadic (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for ipadic: filename=ipadic-1.0.0-py3-none-any.whl size=13556723 sha256=c3f302370fc0915648791f676892ce506289cdbeb0b6a27575925dc6c46aa63c\n","  Stored in directory: /root/.cache/pip/wheels/33/8b/99/cf0d27191876637cd3639a560f93aa982d7855ce826c94348b\n","Successfully built ipadic\n","Installing collected packages: tokenizers, sacremoses, transformers, ipadic, fugashi\n","Successfully installed fugashi-1.1.0 ipadic-1.0.0 sacremoses-0.0.45 tokenizers-0.10.3 transformers-4.5.0\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"ORL3IdiSJ0tm","executionInfo":{"status":"ok","timestamp":1627989223860,"user_tz":-540,"elapsed":2488,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["from transformers import BertJapaneseTokenizer, BertModel"],"id":"ORL3IdiSJ0tm","execution_count":3,"outputs":[]},{"cell_type":"code","metadata":{"id":"_h5NWfrcJ8QB","colab":{"base_uri":"https://localhost:8080/","height":115,"referenced_widgets":["f9d96492f2fd4806859d354b967ab8f0","e17b9d1dcae34e09892dc7d07cad9a79","0c6b0df3930445b2b51ac5443c8bccb4","70c0333120d74d5eab3bb75d2655c726","c87f71dcc88b4d6cb647af08ba29168c","4c4922cff03c4671a108eab87bf5218d","981e995d493247dc9a0cef9e8e25163b","001ef2ea9b9a4b9e8c50b5ac34d50a47","38b0a96d298a4de9a7807032d6a5b131","2bcb9147da574301b9d17cbfc30faa7d","a39a3edbc859403ea944c61f13a1cb39","2c995c45283c42ee9b948bd2f9a13715","c180c8fde9f048fb81f849c0fcc9c64b","65a23ff7a1ef4c22bc5f78a4af393b78","3db07c27917d489e85a5c525e1f78d0e","e20d578eb9ec49cd839389b4ed0359c1"]},"executionInfo":{"status":"ok","timestamp":1627989225990,"user_tz":-540,"elapsed":2136,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"3dd31d43-b15b-4767-9403-50e3bd92b4e7"},"source":["tokenizer = BertJapaneseTokenizer.from_pretrained(\"cl-tohoku/bert-base-japanese-whole-word-masking\")"],"id":"_h5NWfrcJ8QB","execution_count":4,"outputs":[{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"f9d96492f2fd4806859d354b967ab8f0","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=257706.0, style=ProgressStyle(descripti…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"38b0a96d298a4de9a7807032d6a5b131","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, description='Downloading', max=110.0, style=ProgressStyle(description_…"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"d10aaa01-d57a-4679-8fcb-8481da434324","executionInfo":{"status":"ok","timestamp":1627989228419,"user_tz":-540,"elapsed":2433,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["import re\n","import pickle\n","import numpy as np\n","import pandas as pd\n","\n","from sklearn.model_selection import train_test_split\n","import tensorflow as tf\n","from tensorflow import keras\n","from tensorflow.keras import layers\n","# from tensorflow.keras.layers.experimental.preprocessing import TextVectorization\n","from tensorflow.keras import preprocessing as pp"],"id":"d10aaa01-d57a-4679-8fcb-8481da434324","execution_count":5,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"bZrw0fTg2Yse","executionInfo":{"status":"ok","timestamp":1627989244113,"user_tz":-540,"elapsed":15696,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"216714e6-44cb-4ec2-d3e1-3f0bb9878fc8"},"source":["from google.colab import drive\n","drive.mount('/content/drive')"],"id":"bZrw0fTg2Yse","execution_count":6,"outputs":[{"output_type":"stream","text":["Mounted at /content/drive\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"GTAHsIkg8NW8","executionInfo":{"status":"ok","timestamp":1627989244114,"user_tz":-540,"elapsed":17,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"6b7639b0-6871-474a-a2c2-78a4a14d7bcd"},"source":["ls"],"id":"GTAHsIkg8NW8","execution_count":7,"outputs":[{"output_type":"stream","text":["\u001b[0m\u001b[01;34mdrive\u001b[0m/  \u001b[01;34msample_data\u001b[0m/\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"B9hxD4NT2fy9","executionInfo":{"status":"ok","timestamp":1627989244114,"user_tz":-540,"elapsed":11,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"32514a8b-0e65-46ac-8cd8-c868c9e4b8b1"},"source":["cd drive/MyDrive/"],"id":"B9hxD4NT2fy9","execution_count":8,"outputs":[{"output_type":"stream","text":["/content/drive/MyDrive\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"GLFf6DUY22iQ","executionInfo":{"status":"ok","timestamp":1627989244115,"user_tz":-540,"elapsed":9,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"110e1422-dab5-4a14-a0dd-595543f4c869"},"source":["ls | grep dataset"],"id":"GLFf6DUY22iQ","execution_count":9,"outputs":[{"output_type":"stream","text":["datasets.bin\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"_PyUQh__2W7D","executionInfo":{"status":"ok","timestamp":1627989245856,"user_tz":-540,"elapsed":1746,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["with open(\"./datasets.bin\", \"rb\") as f:\n","  datasets = pickle.load(f)"],"id":"_PyUQh__2W7D","execution_count":10,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0lOpESUYlHwP","executionInfo":{"status":"ok","timestamp":1627989245857,"user_tz":-540,"elapsed":5,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"55f9d1e9-3ffc-4838-c0a4-1ff8761ab400"},"source":["len(datasets)"],"id":"0lOpESUYlHwP","execution_count":11,"outputs":[{"output_type":"execute_result","data":{"text/plain":["11989"]},"metadata":{"tags":[]},"execution_count":11}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"tesuiiKb28dT","executionInfo":{"status":"ok","timestamp":1627989245857,"user_tz":-540,"elapsed":4,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"771e59a5-fb78-4d7f-c327-c926ff69e4e3"},"source":["print(datasets[0][0])\n","print()\n","print(datasets[0][1])"],"id":"tesuiiKb28dT","execution_count":12,"outputs":[{"output_type":"stream","text":["お笑いトリオ・安田大サーカスのクロちゃん(44)の所属事務所・松竹芸能は19日、クロちゃんが新型コロナウイルスに感染したことを報告した。【写真】1回目のワクチン接種後には…体温計の写真とともに経過を報告した団長安田サイトでは「7月18日夜の仕事前、体調に違和感と悪寒を感じたため、体温計測したところ37.5度あり、発熱外来を受診、新型コロナウイルスPCR検査を受けた結果、同日深夜に陽性と診断されました」と説明。「今後は保健所の指示に従い適切に対処してまいります」とした。今月15日には、団長安田(47)の新型コロナウイルス感染を公表。「先日感染をご報告させていただきました、団長安田とは直近での接触はなく、保健所からも濃厚接触者には認定されていない為、別ルートでの感染と考えられます」と伝え「この度は仕事関係者・共演者の皆様、いつも応援して下さっている皆様に多大なるご迷惑とご心配をお掛けしていることを、心よりお詫び申し上げます」と記した。最後は「弊社は引き続き、行政機関、医療機関の指導のもと、体調管理の徹底、所属タレントおよび社員、関係各位への感染防止を優先し、新型コロナウイルスの感染予防、拡大防止対策を徹底してまいります」とコメントしている。\n","\n","安田大サーカス・クロちゃん、新型コロナ感染団長安田とは「別ルートでの感染と考えられます」\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":35},"id":"ve19Ro6CmV9T","executionInfo":{"status":"ok","timestamp":1627989248504,"user_tz":-540,"elapsed":4,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"c315f59d-abd8-4659-ce7b-832b1b65c23e"},"source":["\" \".join(tokenizer.tokenize(datasets[0][1]))"],"id":"ve19Ro6CmV9T","execution_count":13,"outputs":[{"output_type":"execute_result","data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'安田 大 サーカス ・ クロ ちゃん 、 新型 コロナ 感染 団長 安田 と は 「 別 ルート で の 感染 と 考え られ ます 」'"]},"metadata":{"tags":[]},"execution_count":13}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"H2Ry_izYlq-r","executionInfo":{"status":"ok","timestamp":1627989281156,"user_tz":-540,"elapsed":32289,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"c76234a0-b60f-42c7-9951-043b2e1e15fa"},"source":["content = [\" \".join(tokenizer.tokenize(d[0])) for d in datasets]\n","title = [\"[BOS] \" + \" \".join(tokenizer.tokenize(d[1])) + \" [EOS]\" for d in datasets]\n","print(content[0])\n","print(title[0])"],"id":"H2Ry_izYlq-r","execution_count":14,"outputs":[{"output_type":"stream","text":["お笑い トリオ ・ 安田 大 サーカス の クロ ちゃん ( 44 ) の 所属 事務所 ・ 松竹 芸能 は 19 日 、 クロ ちゃん が 新型 コロナ ウイルス に 感染 し た こと を 報告 し た 。 【 写真 】 1 回 目 の ワクチン 接種 後 に は ... 体温 ##計 の 写真 とともに 経過 を 報告 し た 団長 安田 サイト で は 「 7 月 18 日 夜 の 仕事 前 、 体調 に 違和感 と 悪 ##寒 を 感じ た ため 、 体温 計測 し た ところ 37 . 5 度 あり 、 発熱 外来 を 受 ##診 、 新型 コロナ ウイルス PC ##R 検査 を 受け た 結果 、 同日 深夜 に 陽性 と 診断 さ れ まし た 」 と 説明 。 「 今後 は 保健 ##所 の 指示 に従い 適切 に 対処 し て まい ##り ます 」 と し た 。 今 ##月 15 日 に は 、 団長 安田 ( 47 ) の 新型 コロナ ウイルス 感染 を 公表 。 「 先 ##日 感染 を ご 報告 さ せ て いただ ##き まし た 、 団長 安田 と は 直近 で の 接触 は なく 、 保健 ##所 から も 濃厚 接触 者 に は 認定 さ れ て い ない 為 、 別 ルート で の 感染 と 考え られ ます 」 と 伝え 「 この 度 は 仕事 関係 者 ・ 共演 者 の 皆 ##様 、 いつも 応援 し て 下さ ##っ て いる 皆 ##様 に 多大 なる ご 迷惑 と ご 心配 を お 掛け し て いる こと を 、 心 より お ##詫び 申し ##上げ ます 」 と 記し た 。 最後 は 「 弊 ##社 は 引き続き 、 行政 機関 、 医療 機関 の 指導 の もと 、 体調 管理 の 徹底 、 所属 タレント および 社員 、 関係 各 ##位 へ の 感染 防止 を 優先 し 、 新型 コロナ ウイルス の 感染 予防 、 拡大 防止 対策 を 徹底 し て まい ##り ます 」 と コメント し て いる 。\n","[BOS] 安田 大 サーカス ・ クロ ちゃん 、 新型 コロナ 感染 団長 安田 と は 「 別 ルート で の 感染 と 考え られ ます 」 [EOS]\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"f1dc058f-aa26-4f99-b514-69638d30f236","executionInfo":{"status":"ok","timestamp":1627989281156,"user_tz":-540,"elapsed":6,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"28d3cd42-0970-49b3-ddf2-809bb141033b"},"source":["len(content), len(title)"],"id":"f1dc058f-aa26-4f99-b514-69638d30f236","execution_count":15,"outputs":[{"output_type":"execute_result","data":{"text/plain":["(11989, 11989)"]},"metadata":{"tags":[]},"execution_count":15}]},{"cell_type":"code","metadata":{"id":"fbqOIVcpe3GX","executionInfo":{"status":"ok","timestamp":1627989281156,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["# content_lens = np.array([len(s.split(\" \")) for s in content])\n","# title_lens = np.array([len(s.split(\" \")) for s in title])"],"id":"fbqOIVcpe3GX","execution_count":16,"outputs":[]},{"cell_type":"code","metadata":{"id":"xylc8bvkfPf0","executionInfo":{"status":"ok","timestamp":1627989281156,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["# (content_lens.mean(), content_lens.std(), content_lens.max()), (title_lens.mean(), title_lens.std(), title_lens.max())"],"id":"xylc8bvkfPf0","execution_count":17,"outputs":[]},{"cell_type":"code","metadata":{"id":"HR1qDVHOtYMj","executionInfo":{"status":"ok","timestamp":1627989281156,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["# datasets_used_idx = ((content_lens < 1000) & (title_lens < 50))"],"id":"HR1qDVHOtYMj","execution_count":18,"outputs":[]},{"cell_type":"code","metadata":{"id":"1tYIgKFbt1k6","executionInfo":{"status":"ok","timestamp":1627989281157,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["# content = np.array(content)[datasets_used_idx]\n","# title = np.array(title)[datasets_used_idx]"],"id":"1tYIgKFbt1k6","execution_count":19,"outputs":[]},{"cell_type":"code","metadata":{"id":"87f55129-0acc-48d8-8e4c-fc64982def53","executionInfo":{"status":"ok","timestamp":1627989290043,"user_tz":-540,"elapsed":7202,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["keras_tokenizer = pp.text.Tokenizer(filters=\"\", lower=False)\n","keras_tokenizer.fit_on_texts(list(content) + list(title))\n","# keras_tokenizer.word_index = dict(tokenizer.vocab)\n","# keras_tokenizer.index_word = {idx: word for word,idx in keras_tokenizer.word_index.items()}"],"id":"87f55129-0acc-48d8-8e4c-fc64982def53","execution_count":20,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"31631ddc-b84e-4be3-b56a-b6fbe4309565","executionInfo":{"status":"ok","timestamp":1627989290044,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"b3d9b759-cde5-48a6-bba3-206318904c1b"},"source":["print(len(keras_tokenizer.word_index))\n","keras_tokenizer.word_index[\"\"] = 0\n","keras_tokenizer.index_word[0] = \"\"\n","print(len(keras_tokenizer.word_index))"],"id":"31631ddc-b84e-4be3-b56a-b6fbe4309565","execution_count":21,"outputs":[{"output_type":"stream","text":["28362\n","28363\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"3eC4O-Uu9hdD","executionInfo":{"status":"ok","timestamp":1627989290044,"user_tz":-540,"elapsed":1,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["with open(\"./keras_tokenizer.bin\", 'wb') as f:\n","    pickle.dump(keras_tokenizer , f)"],"id":"3eC4O-Uu9hdD","execution_count":22,"outputs":[]},{"cell_type":"code","metadata":{"id":"ee7ce94c-2f0e-49fe-83c8-49c08de8384c","executionInfo":{"status":"ok","timestamp":1627989306431,"user_tz":-540,"elapsed":5702,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["X = keras_tokenizer.texts_to_sequences(content)\n","y = keras_tokenizer.texts_to_sequences(title)"],"id":"ee7ce94c-2f0e-49fe-83c8-49c08de8384c","execution_count":23,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5ae385e2-9876-454e-b284-2ac7ee367de9","executionInfo":{"status":"ok","timestamp":1627989306431,"user_tz":-540,"elapsed":8,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"0c67d9e6-a730-408a-de82-8f01702363df"},"source":["\"\".join([keras_tokenizer.index_word[idx] for idx in X[0][0:100]]), \"->\" , \" \".join([keras_tokenizer.index_word[idx] for idx in y[0]])"],"id":"5ae385e2-9876-454e-b284-2ac7ee367de9","execution_count":24,"outputs":[{"output_type":"execute_result","data":{"text/plain":["('お笑いトリオ・安田大サーカスのクロちゃん(44)の所属事務所・松竹芸能は19日、クロちゃんが新型コロナウイルスに感染したことを報告した。【写真】1回目のワクチン接種後には...体温##計の写真とともに経過を報告した団長安田サイトでは「7月18日夜の仕事前、体調に違和感と悪##寒を感じたため、体温計測したところ37.5度あり、発熱外来',\n"," '->',\n"," '[BOS] 安田 大 サーカス ・ クロ ちゃん 、 新型 コロナ 感染 団長 安田 と は 「 別 ルート で の 感染 と 考え られ ます 」 [EOS]')"]},"metadata":{"tags":[]},"execution_count":24}]},{"cell_type":"code","metadata":{"id":"f764185b-e515-4261-bd26-6277dc0d9cda","executionInfo":{"status":"ok","timestamp":1627989307274,"user_tz":-540,"elapsed":846,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["ENC_SEQ_LEN = 600\n","DEC_SEQ_LEN = 50\n","X = pp.sequence.pad_sequences(X, maxlen=ENC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","y = pp.sequence.pad_sequences(y, maxlen=DEC_SEQ_LEN+1, padding=\"post\", truncating=\"post\")"],"id":"f764185b-e515-4261-bd26-6277dc0d9cda","execution_count":25,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5fIfIKx7mSHN","executionInfo":{"status":"ok","timestamp":1627989307275,"user_tz":-540,"elapsed":2,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"76f39be7-4f0f-4557-99d6-742d42120344"},"source":["X_train, X_val ,y_train, y_val = train_test_split(X, y, test_size=0.1, random_state=41)\n","X_train.shape, X_val.shape, y_train.shape, y_val.shape"],"id":"5fIfIKx7mSHN","execution_count":26,"outputs":[{"output_type":"execute_result","data":{"text/plain":["((10790, 600), (1199, 600), (10790, 51), (1199, 51))"]},"metadata":{"tags":[]},"execution_count":26}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"TUtA5vG3vZbz","executionInfo":{"status":"ok","timestamp":1627989308803,"user_tz":-540,"elapsed":7,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"67643435-1278-47ec-d579-f86268786883"},"source":["enc_inp_trn, enc_inp_val = X_train, X_val\n","dec_inp_trn, dec_inp_val = y_train[:,:-1], y_val[:,:-1]\n","dec_out_trn, dec_out_val = y_train[:,1:], y_val[:,1:]\n","enc_inp_trn.shape, dec_inp_trn.shape, dec_out_trn.shape"],"id":"TUtA5vG3vZbz","execution_count":27,"outputs":[{"output_type":"execute_result","data":{"text/plain":["((10790, 600), (10790, 50), (10790, 50))"]},"metadata":{"tags":[]},"execution_count":27}]},{"cell_type":"code","metadata":{"id":"66b7261a-bd8e-4e53-8ebc-a7a6e23dced9","executionInfo":{"status":"ok","timestamp":1627989310759,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["def create_padding_mask(seq):\n","  seq = tf.cast(tf.math.equal(seq, 0), tf.float32)\n","\n","  # アテンション・ロジットにパディングを追加するため\n","  # さらに次元を追加する\n","  return seq[:, tf.newaxis, tf.newaxis, :]\n","\n","def create_look_ahead_mask(size):\n","  mask = 1 - tf.linalg.band_part(tf.ones((size, size)), -1, 0)\n","  return mask  # (seq_len, seq_len)\n","\n","def create_masks(inputs_):\n","  inp, tar = inputs_\n","  # Encoderパディング・マスク\n","  enc_padding_mask = create_padding_mask(inp)\n","\n","  # デコーダーの 2つ目のアテンション・ブロックで使用\n","  # このパディング・マスクはエンコーダーの出力をマスクするのに使用\n","  dec_padding_mask = create_padding_mask(inp)\n","\n","  # デコーダーの 1つ目のアテンション・ブロックで使用\n","  # デコーダーが受け取った入力のパディングと将来のトークンをマスクするのに使用\n","  look_ahead_mask = create_look_ahead_mask(tf.shape(tar)[1])\n","  dec_target_padding_mask = create_padding_mask(tar)\n","  combined_mask = tf.maximum(dec_target_padding_mask, look_ahead_mask)\n","\n","  return enc_padding_mask, combined_mask, dec_padding_mask"],"id":"66b7261a-bd8e-4e53-8ebc-a7a6e23dced9","execution_count":28,"outputs":[]},{"cell_type":"code","metadata":{"id":"mO8KUY6Wb_xT","executionInfo":{"status":"ok","timestamp":1627989314942,"user_tz":-540,"elapsed":352,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["def get_angles(pos, i, d_model):\n","  angle_rates = 1 / np.power(10000, (2 * (i//2)) / np.float32(d_model))\n","  return pos * angle_rates\n","\n","def positional_encoding(position, d_model):\n","  angle_rads = get_angles(np.arange(position)[:, np.newaxis],\n","                          np.arange(d_model)[np.newaxis, :],\n","                          d_model)\n","\n","  # 配列中の偶数インデックスにはsinを適用; 2i\n","  angle_rads[:, 0::2] = np.sin(angle_rads[:, 0::2])\n","\n","  # 配列中の奇数インデックスにはcosを適用; 2i+1\n","  angle_rads[:, 1::2] = np.cos(angle_rads[:, 1::2])\n","\n","  pos_encoding = angle_rads[np.newaxis, ...]\n","\n","  return tf.cast(pos_encoding, dtype=tf.float32)"],"id":"mO8KUY6Wb_xT","execution_count":29,"outputs":[]},{"cell_type":"code","metadata":{"id":"X2Xq4T9CakHe","executionInfo":{"status":"ok","timestamp":1627989315224,"user_tz":-540,"elapsed":1,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["def scaled_dot_product_attention(q, k, v, mask):\n","  \"\"\"アテンションの重みの計算\n","  q, k, vは最初の次元が一致していること\n","  k, vは最後から2番めの次元が一致していること\n","  マスクは型（パディングかルックアヘッドか）によって異なるshapeを持つが、\n","  加算の際にブロードキャスト可能であること\n","  引数：\n","    q: query shape == (..., seq_len_q, depth)\n","    k: key shape == (..., seq_len_k, depth)\n","    v: value shape == (..., seq_len_v, depth_v)\n","    mask: (..., seq_len_q, seq_len_k) にブロードキャスト可能な\n","          shapeを持つ浮動小数点テンソル。既定値はNone\n","\n","  戻り値：\n","    出力、アテンションの重み\n","  \"\"\"\n","\n","  matmul_qk = tf.matmul(q, k, transpose_b=True)  # (..., seq_len_q, seq_len_k)\n","\n","  # matmul_qkをスケール\n","  dk = tf.cast(tf.shape(k)[-1], tf.float32)\n","  scaled_attention_logits = matmul_qk / tf.math.sqrt(dk)\n","\n","  # マスクをスケール済みテンソルに加算\n","  if mask is not None:\n","    scaled_attention_logits += (mask * -1e9)  \n","\n","  # softmax は最後の軸(seq_len_k)について\n","  # 合計が1となるように正規化\n","  attention_weights = tf.nn.softmax(scaled_attention_logits, axis=-1)  # (..., seq_len_q, seq_len_k)\n","\n","  output = tf.matmul(attention_weights, v)  # (..., seq_len_q, depth_v)\n","\n","  return output, attention_weights"],"id":"X2Xq4T9CakHe","execution_count":30,"outputs":[]},{"cell_type":"code","metadata":{"id":"iLs4KO2oaoK7","executionInfo":{"status":"ok","timestamp":1627989315467,"user_tz":-540,"elapsed":2,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["class MultiHeadAttention(layers.Layer):\n","  def __init__(self, d_model, num_heads):\n","    super(MultiHeadAttention, self).__init__()\n","    self.num_heads = num_heads\n","    self.d_model = d_model\n","\n","    assert d_model % self.num_heads == 0\n","\n","    self.depth = d_model // self.num_heads\n","\n","    self.wq = layers.Dense(d_model)\n","    self.wk = layers.Dense(d_model)\n","    self.wv = layers.Dense(d_model)\n","\n","    self.dense = layers.Dense(d_model)\n","\n","  def split_heads(self, x, batch_size):\n","    \"\"\"最後の次元を(num_heads, depth)に分割。\n","    結果をshapeが(batch_size, num_heads, seq_len, depth)となるようにリシェイプする。\n","    \"\"\"\n","    x = tf.reshape(x, (batch_size, -1, self.num_heads, self.depth))\n","    return tf.transpose(x, perm=[0, 2, 1, 3])\n","\n","  def call(self, v, k, q, mask):\n","    batch_size = tf.shape(q)[0]\n","\n","    q = self.wq(q)  # (batch_size, seq_len, d_model)\n","    k = self.wk(k)  # (batch_size, seq_len, d_model)\n","    v = self.wv(v)  # (batch_size, seq_len, d_model)\n","\n","    q = self.split_heads(q, batch_size)  # (batch_size, num_heads, seq_len_q, depth)\n","    k = self.split_heads(k, batch_size)  # (batch_size, num_heads, seq_len_k, depth)\n","    v = self.split_heads(v, batch_size)  # (batch_size, num_heads, seq_len_v, depth)\n","\n","    # scaled_attention.shape == (batch_size, num_heads, seq_len_q, depth)\n","    # attention_weights.shape == (batch_size, num_heads, seq_len_q, seq_len_k)\n","    scaled_attention, attention_weights = scaled_dot_product_attention(\n","        q, k, v, mask)\n","\n","    scaled_attention = tf.transpose(scaled_attention, perm=[0, 2, 1, 3])  # (batch_size, seq_len_q, num_heads, depth)\n","\n","    concat_attention = tf.reshape(scaled_attention, \n","                                  (batch_size, -1, self.d_model))  # (batch_size, seq_len_q, d_model)\n","\n","    output = self.dense(concat_attention)  # (batch_size, seq_len_q, d_model)\n","\n","    return output, attention_weights"],"id":"iLs4KO2oaoK7","execution_count":31,"outputs":[]},{"cell_type":"code","metadata":{"id":"OvPsDSW6apER","executionInfo":{"status":"ok","timestamp":1627989316064,"user_tz":-540,"elapsed":4,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["def point_wise_feed_forward_network(d_model, dff):\n","  return tf.keras.Sequential([\n","      layers.Dense(dff, activation='relu'),  # (batch_size, seq_len, dff)\n","      layers.Dense(d_model)  # (batch_size, seq_len, d_model)\n","  ])"],"id":"OvPsDSW6apER","execution_count":32,"outputs":[]},{"cell_type":"code","metadata":{"id":"gbiphbAUZw65","executionInfo":{"status":"ok","timestamp":1627989316982,"user_tz":-540,"elapsed":4,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["class EncoderLayer(layers.Layer):\n","  def __init__(self, d_model, num_heads, dff, rate=0.1):\n","    super(EncoderLayer, self).__init__()\n","\n","    self.mha = MultiHeadAttention(d_model, num_heads)\n","    self.ffn = point_wise_feed_forward_network(d_model, dff)\n","\n","    self.layernorm1 = layers.LayerNormalization(epsilon=1e-6)\n","    self.layernorm2 = layers.LayerNormalization(epsilon=1e-6)\n","\n","    self.dropout1 = layers.Dropout(rate)\n","    self.dropout2 = layers.Dropout(rate)\n","\n","  def call(self, x, training, mask):\n","\n","    attn_output, _ = self.mha(x, x, x, mask)  # (batch_size, input_seq_len, d_model)\n","    attn_output = self.dropout1(attn_output, training=training)\n","    out1 = self.layernorm1(x + attn_output)  # (batch_size, input_seq_len, d_model)\n","\n","    ffn_output = self.ffn(out1)  # (batch_size, input_seq_len, d_model)\n","    ffn_output = self.dropout2(ffn_output, training=training)\n","    out2 = self.layernorm2(out1 + ffn_output)  # (batch_size, input_seq_len, d_model)\n","\n","    return out2"],"id":"gbiphbAUZw65","execution_count":33,"outputs":[]},{"cell_type":"code","metadata":{"id":"llWf0jEVZ2xo","executionInfo":{"status":"ok","timestamp":1627989317769,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["class DecoderLayer(layers.Layer):\n","  def __init__(self, d_model, num_heads, dff, rate=0.1):\n","    super(DecoderLayer, self).__init__()\n","\n","    self.mha1 = MultiHeadAttention(d_model, num_heads)\n","    self.mha2 = MultiHeadAttention(d_model, num_heads)\n","\n","    self.ffn = point_wise_feed_forward_network(d_model, dff)\n","\n","    self.layernorm1 = layers.LayerNormalization(epsilon=1e-6)\n","    self.layernorm2 = layers.LayerNormalization(epsilon=1e-6)\n","    self.layernorm3 = layers.LayerNormalization(epsilon=1e-6)\n","\n","    self.dropout1 = layers.Dropout(rate)\n","    self.dropout2 = layers.Dropout(rate)\n","    self.dropout3 = layers.Dropout(rate)\n","\n","\n","  def call(self, x, enc_output, training, \n","           look_ahead_mask, padding_mask):\n","    # enc_output.shape == (batch_size, input_seq_len, d_model)\n","\n","    attn1, attn_weights_block1 = self.mha1(x, x, x, look_ahead_mask)  # (batch_size, target_seq_len, d_model)\n","    attn1 = self.dropout1(attn1, training=training)\n","    out1 = self.layernorm1(attn1 + x)\n","\n","    attn2, attn_weights_block2 = self.mha2(\n","        enc_output, enc_output, out1, padding_mask)  # (batch_size, target_seq_len, d_model)\n","    attn2 = self.dropout2(attn2, training=training)\n","    out2 = self.layernorm2(attn2 + out1)  # (batch_size, target_seq_len, d_model)\n","\n","    ffn_output = self.ffn(out2)  # (batch_size, target_seq_len, d_model)\n","    ffn_output = self.dropout3(ffn_output, training=training)\n","    out3 = self.layernorm3(ffn_output + out2)  # (batch_size, target_seq_len, d_model)\n","\n","    return out3, attn_weights_block1, attn_weights_block2"],"id":"llWf0jEVZ2xo","execution_count":34,"outputs":[]},{"cell_type":"code","metadata":{"id":"7eSY4dwKZnAU","executionInfo":{"status":"ok","timestamp":1627989318030,"user_tz":-540,"elapsed":1,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["class Encoder(layers.Layer):\n","  def __init__(self, num_layers, d_model, num_heads, dff, input_vocab_size,\n","               maximum_position_encoding, rate=0.1):\n","    super(Encoder, self).__init__()\n","\n","    self.d_model = d_model\n","    self.num_layers = num_layers\n","\n","    self.embedding = layers.Embedding(input_vocab_size, d_model)\n","    self.pos_encoding = positional_encoding(maximum_position_encoding, \n","                                            self.d_model)\n","\n","\n","    self.enc_layers = [EncoderLayer(d_model, num_heads, dff, rate) \n","                       for _ in range(num_layers)]\n","\n","    self.dropout = layers.Dropout(rate)\n","\n","  def call(self, x, training, mask):\n","\n","    seq_len = tf.shape(x)[1]\n","\n","    # 埋め込みと位置エンコーディングを合算する\n","    x = self.embedding(x)  # (batch_size, input_seq_len, d_model)\n","    x *= tf.math.sqrt(tf.cast(self.d_model, tf.float32))\n","    x += self.pos_encoding[:, :seq_len, :]\n","\n","    x = self.dropout(x, training=training)\n","\n","    for i in range(self.num_layers):\n","      x = self.enc_layers[i](x, training, mask)\n","\n","    return x  # (batch_size, input_seq_len, d_model)"],"id":"7eSY4dwKZnAU","execution_count":35,"outputs":[]},{"cell_type":"code","metadata":{"id":"2x0dP81NZ7ZA","executionInfo":{"status":"ok","timestamp":1627989318721,"user_tz":-540,"elapsed":1,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["class Decoder(layers.Layer):\n","  def __init__(self, num_layers, d_model, num_heads, dff, target_vocab_size,\n","               maximum_position_encoding, rate=0.1):\n","    super(Decoder, self).__init__()\n","\n","    self.d_model = d_model\n","    self.num_layers = num_layers\n","\n","    self.embedding = layers.Embedding(target_vocab_size, d_model)\n","    self.pos_encoding = positional_encoding(maximum_position_encoding, d_model)\n","\n","    self.dec_layers = [DecoderLayer(d_model, num_heads, dff, rate) \n","                       for _ in range(num_layers)]\n","    self.dropout = layers.Dropout(rate)\n","\n","  def call(self, x, enc_output, training, \n","           look_ahead_mask, padding_mask):\n","\n","    seq_len = tf.shape(x)[1]\n","    attention_weights = {}\n","\n","    x = self.embedding(x)  # (batch_size, target_seq_len, d_model)\n","    x *= tf.math.sqrt(tf.cast(self.d_model, tf.float32))\n","    x += self.pos_encoding[:, :seq_len, :]\n","\n","    x = self.dropout(x, training=training)\n","\n","    for i in range(self.num_layers):\n","      x, block1, block2 = self.dec_layers[i](x, enc_output, training,\n","                                             look_ahead_mask, padding_mask)\n","\n","      attention_weights['decoder_layer{}_block1'.format(i+1)] = block1\n","      attention_weights['decoder_layer{}_block2'.format(i+1)] = block2\n","\n","    # x.shape == (batch_size, target_seq_len, d_model)\n","    return x, attention_weights"],"id":"2x0dP81NZ7ZA","execution_count":36,"outputs":[]},{"cell_type":"code","metadata":{"id":"BUZFDywGZImQ","executionInfo":{"status":"ok","timestamp":1627989319007,"user_tz":-540,"elapsed":1,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["class Transformer(tf.keras.Model):\n","  def __init__(self, num_layers, d_model, num_heads, dff, input_vocab_size, \n","               target_vocab_size, pe_input, pe_target, rate=0.1):\n","    super(Transformer, self).__init__()\n","\n","    self.encoder = Encoder(num_layers, d_model, num_heads, dff, \n","                           input_vocab_size, pe_input, rate)\n","\n","    self.decoder = Decoder(num_layers, d_model, num_heads, dff, \n","                           target_vocab_size, pe_target, rate)\n","\n","    self.final_layer = layers.Dense(target_vocab_size)\n","\n","\n","  def call(self, inp, tar, training, enc_padding_mask, \n","           look_ahead_mask, dec_padding_mask):\n","\n","    enc_output = self.encoder(inp, training, enc_padding_mask)  # (batch_size, inp_seq_len, d_model)\n","\n","    # dec_output.shape == (batch_size, tar_seq_len, d_model)\n","    dec_output, attention_weights = self.decoder(\n","        tar, enc_output, training, look_ahead_mask, dec_padding_mask)\n","\n","    final_output = self.final_layer(dec_output)  # (batch_size, tar_seq_len, target_vocab_size)\n","\n","    return final_output#, attention_weights"],"id":"BUZFDywGZImQ","execution_count":37,"outputs":[]},{"cell_type":"code","metadata":{"id":"HLeIJZ2cZfId","executionInfo":{"status":"ok","timestamp":1627989333867,"user_tz":-540,"elapsed":249,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["tf_transformer = Transformer(\n","    num_layers=2, d_model=128, num_heads=4, dff=128,\n","    input_vocab_size=len(keras_tokenizer.word_index), target_vocab_size=len(keras_tokenizer.word_index),\n","    pe_input=ENC_SEQ_LEN, pe_target=DEC_SEQ_LEN)"],"id":"HLeIJZ2cZfId","execution_count":39,"outputs":[]},{"cell_type":"code","metadata":{"id":"A3Hg-CeXdFgy","executionInfo":{"status":"ok","timestamp":1627989337077,"user_tz":-540,"elapsed":1522,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["encoder_inputs = keras.Input(shape=(ENC_SEQ_LEN,), dtype=\"int32\", name=\"encoder_inputs\")\n","decoder_inputs = keras.Input(shape=(DEC_SEQ_LEN,), dtype=\"int32\", name=\"decoder_inputs\")\n","enc_padding_mask, combined_mask, dec_padding_mask = layers.Lambda(create_masks)([encoder_inputs, decoder_inputs])\n","decoder_outputs = tf_transformer(encoder_inputs, decoder_inputs, True, enc_padding_mask, combined_mask, dec_padding_mask)\n","train_model = keras.Model([encoder_inputs, decoder_inputs], decoder_outputs)"],"id":"A3Hg-CeXdFgy","execution_count":40,"outputs":[]},{"cell_type":"code","metadata":{"id":"r_yIBasOf3Ns","executionInfo":{"status":"ok","timestamp":1627989339610,"user_tz":-540,"elapsed":238,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["loss_object = tf.keras.losses.SparseCategoricalCrossentropy(\n","    from_logits=True, reduction='none')\n","def loss_function(real, pred):\n","  mask = tf.math.logical_not(tf.math.equal(real, 0))\n","  loss_ = loss_object(real, pred)\n","\n","  mask = tf.cast(mask, dtype=loss_.dtype)\n","  loss_ *= mask\n","\n","  return tf.reduce_mean(loss_)\n","  \n","train_accuracy = tf.keras.metrics.SparseCategoricalAccuracy(\n","    name='ACC')"],"id":"r_yIBasOf3Ns","execution_count":41,"outputs":[]},{"cell_type":"code","metadata":{"id":"LBXNK6--T_t9","executionInfo":{"status":"ok","timestamp":1627989341728,"user_tz":-540,"elapsed":249,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["class GenerateTitleCallback(keras.callbacks.Callback):\n","  def __init__(self, x_val, y_val):\n","    self.x_val = x_val\n","    self.y_val = y_val\n","\n","  def on_epoch_end(self, epoch, logs=None):\n","    # バリデーションデータの中からランダムで見出しを生成する\n","    sampling_idx = np.random.randint(0, self.x_val.shape[0])\n","    sample_enc_inp = self.x_val[sampling_idx-1:sampling_idx, :]\n","    decoder_sentence = \"[BOS]\"\n","    for i in range(50):\n","      decoder_sentence_ = keras_tokenizer.texts_to_sequences([decoder_sentence])\n","      decoder_sentence_ = pp.sequence.pad_sequences(decoder_sentence_, maxlen=DEC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","      pred = train_model((sample_enc_inp, decoder_sentence_))\n","      sampled_tkn_idx = np.argmax(pred[0,i,:])\n","      sampled_tkn = keras_tokenizer.index_word[sampled_tkn_idx]\n","      decoder_sentence =  decoder_sentence + \" \" + sampled_tkn\n","      if sampled_tkn == \"[EOS]\":\n","        break\n","    pred_title = \"\".join(re.sub(\"#\", \"\", decoder_sentence).split(\" \")[1:-1])\n","    raw_content = re.sub(\"#\", \"\", \"\".join([keras_tokenizer.index_word[idx] for idx in sample_enc_inp[0]]))\n","    print(raw_content)\n","    print(\"↓\")\n","    print(pred_title)\n","\n","call_backs = GenerateTitleCallback(enc_inp_val, dec_inp_val)"],"id":"LBXNK6--T_t9","execution_count":42,"outputs":[]},{"cell_type":"code","metadata":{"id":"-ibCyFvyfJlE","executionInfo":{"status":"ok","timestamp":1627989344537,"user_tz":-540,"elapsed":271,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}}},"source":["train_model.compile(\"adam\", loss=loss_function, metrics=train_accuracy)"],"id":"-ibCyFvyfJlE","execution_count":43,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"1c27758a-8d00-4c0a-83fd-9fbe748177b4","executionInfo":{"status":"ok","timestamp":1627989859220,"user_tz":-540,"elapsed":508332,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"62b2c458-ef1b-4ea2-bf4d-80682a535cbd"},"source":["train_model.fit(\n","    x=(enc_inp_trn, dec_inp_trn), y=dec_out_trn, \n","    validation_data=((enc_inp_val, dec_inp_val), dec_out_val),\n","    batch_size=64, epochs=10,\n","    callbacks=[call_backs]\n","    )"],"id":"1c27758a-8d00-4c0a-83fd-9fbe748177b4","execution_count":44,"outputs":[{"output_type":"stream","text":["Epoch 1/10\n","169/169 [==============================] - 54s 278ms/step - loss: 3.7278 - ACC: 0.0310 - val_loss: 3.3954 - val_ACC: 0.0534\n","今年もチョコミントの季節になりましたね。不二家の「LOOK(ルック)」から、チョコミント味のチョコレートが今年も登場しますよ。涼感が広がるミントクリーム「ルック2つのチョコミントアイス」は、チョコミントアイスをイメージした2つの味わいと食感が楽しめるアソートです。2021年5月11日から期間限定で、全国のスーパー、コンビニなどで販売されます。ミントグリーンひとつは涼感が広がるミントクリームに、とろりとしたチョコソースがアクセントの「ミントグリーン」、コクのあるミントクリームに、もうひとつは、パリパリ食感のココアフィアンティーヌをブレンドした「クリーミーホワイト」です。クリーミーホワイト12粒入りで、価格は130円。昨年も「ルック2つのこだわりチョコミント」が発売され人気でした。期間限定商品なので、チョコミン党は食べ逃がしなく!\n","↓\n","「「「「「「「「「「「「「「「「「「「」\n","Epoch 2/10\n","169/169 [==============================] - 46s 270ms/step - loss: 3.1230 - ACC: 0.0717 - val_loss: 3.0004 - val_ACC: 0.0847\n","シンガーソングライター、俳優の福山雅治さんが、2021年6月に引退したJR九州のキハ66・67形について「買って展示できるなら自腹で車両代、土地代を出すよ」とラジオで発言。ただ合わせて、もっともな「ある条件」も出しています。俺にとっては「ベージュと朱色のキハ」こそが...シンガーソングライター、俳優の福山雅治さんが、「本物の汽車」を購入するかもしれません。2021年7月17日(土)の「福山雅治と荘口彰久の『地底人ラジオ』」へ、リスナーから次のようなメッセージが寄せられました。「大変です!福山さんが大好きな車両がまたひとつ姿を消すようです。長崎地区で走っている(JR九州の)キハ66・67形が6月30日で引退。長崎市民にはなじみがありすぎるあのブルーの車両と、みかん色とベージュっぽいツートンカラーの、あの車両のようです。福山少年にとって思い出の車両をぜひ買い取って、将来、長崎にできるであろう福山雅治ミュージアムに展示をお願いします!」引退したベージュと朱色のキハ66・67形(恵知仁撮影)。長崎出身の福山さんは、次のように答えます。「子どものころ、キハ66・67で行ってたんだよずーっと、ばーちゃんち。『青』はかなり後から登場してきたよ。俺にとっては『ベージュと朱色のキハ』こそが、『弓なりに続く線路』(福山さんの歌『道標』に登場するフレーズ)を走っていた汽車なんですよ」福山さんによると、長崎で「電車」というと路面電車のことで、「汽車」というと、蒸気機関車ではなく、国鉄・JRの列車を指すようです(一応、鉄道的に厳密に言うと、キハ66・67形は「電車」でも「汽車」でもなく「気動車〈ディーゼルカー〉」)。そして福山さんは続けて「買えるの?買って置いておくところがあって、長崎の有志たちがちゃんとお手入れ、維持できたら、車両の購入と土地代は僕、やりますけど。(鉄道車両の保存活動でもよく行われるクラウドファンディングではなく)自腹でいいですよ」と話しました。これを受けてSNSではいま、車両の引退を悲しんでいた全国の鉄道ファンも、大盛り上がりです。実現の可能性は?車両代はいくら?過去に例ありただこうした鉄道車両の保存では、福山さんが指摘するとおり、「ちゃんと手入れ、維持できる\n","↓\n","「「私の」が「「私の」が「私になる」\n","Epoch 3/10\n","169/169 [==============================] - 46s 272ms/step - loss: 2.7171 - ACC: 0.1024 - val_loss: 2.7885 - val_ACC: 0.1030\n","見事な劇的サヨナラで勝利を飾った侍ジャパン。7月28日に東京五輪の野球初戦(対ドミニカ共和国)を迎えた侍ジャパンは9回裏、坂本勇人内野手(32)がサヨナラ打を放ち、逆転勝利をおさめ白星スタートを切った。この日、先発したのはオリックスの山本由伸投手(22)。'19年プレミア12ではリリーフ投手として世界一に貢献、今季はオリックスで自身初の開幕投手も務め、五輪の開幕投手に抜てきされた若きエースだ。ドミニカ戦では6回2安打無失点、9奪三振を記録した。若きエースの密会相手にファン反対その山本の登板前日に『週刊ポスト』(8月13日号)が報じた記事が「侍ジャパン・オリ山本由伸がホテル密会お相手は元エース菅野の元カノ・野崎萌香」という密会報道だ。同誌によれば、山本は7月11日のオフの夜、都内の高級ホテルに隣接するイタリアンレストランの個室で女性2人とディナーを楽しんでいたという。そのひとりがモデルの野崎萌香(31)だった。食事を終えた22時頃、山本と野崎と友人の3人はホテルの客室に消え、女性2人がロビーに姿を現したのは日付が変わるころだった。野崎といえば、2019年秋に侍ジャパンの元エース・巨人の菅野智之投手(31)との交際が発覚、結婚秒読みともいわれていたが今年の4月に破局したばかり。「交際発覚後は堂々とデートを重ね、野崎は菅野の7億円とも言われる豪邸に通い得意の手料理を振舞うほどでした。昨年、菅野はメジャー移籍か残留かで悩んでいましたが、メジャーへ行くなら野崎に一緒についてきてほしかったようです。彼女も彼女で自分の仕事もあるので、なかなか踏み切れず結局、今年の春に別れたといいます」(スポーツ紙記者)その菅野は今季開幕から度重なる故障を抱え不調から抜け出せず、コンディション不良で代表も辞退した。破局から3か月後、野崎が選んだ相手が、新エースの山本ということで野球ファンの間では驚きの声があがった。「山本とは2~3年前に共通の友人の紹介で知り合い、山本が上京するときには何人かの友人を交えて食事をする仲だったそうです。菅野とのことも、いろいろ相談していたそうで破局後にさらに距離が縮まったといいます」(同前)\n","↓\n","【MLB】大谷翔平、2人の平、2戦でも「3位はない」\n","Epoch 4/10\n","169/169 [==============================] - 46s 273ms/step - loss: 2.4167 - ACC: 0.1263 - val_loss: 2.6934 - val_ACC: 0.1121\n","みりんちゃん(生後11カ月・メス)は、奈良県内の住宅地に兄弟と一緒にいた。母猫がいる様子はなく、近所の人が気にかけて様子を見ていたが、雨が降ってきたのを機に保護された。母乳を飲んでいなかったので、全員ガリガリにやせて栄養失調になっていた。【写真】丸いカゴの中で、伸び~!って、どうなってるの?草むらにいた子猫たち2020年6月、奈良県内の住宅地の草むらに4匹の子猫がいた。生後3週間くらいだった。心配した近所の人がしばらく様子を見守っていたが、親猫が迎えに来る様子もなく、雨が降ったのを機に保護したという。子猫たちは泥と雨にまみれて汚れていて、ガリガリにやせていた。ひどい脱水状態だったが、保護主が動物病院に連れて行ったので一命をとりとめた。元気を取り戻すとミルクをよく飲むようになり、その後、預かりボランティアのところに行った。生後2カ月になった頃、猫カフェにデビューし、里親を募集した。このチャンスを逃すもんか!奈良県に住む神谷さんは三人姉弟で、昔から何度も親に「ペットを飼いたい」と声を上げていた。しかし、当時の環境ではペットを飼うことはできず却下され、あきらめムードが漂っていた。ある日、末っ子の弟がぽろっと「猫、飼いたいなあ」とこぼすと、それまでずっと反対していた母親が妙に乗り気になって、「なあ、この猫ちゃん見て」と猫を飼うことに興味を示した。弟が「近くに保護猫カフェっていうのがあるらしい」と見つけてきて、家の中がそわそわしだした。神谷さんも「このチャンスを逃すもんか!」と、猫を迎えるために行動した。弟が高校生になったので家庭も少し落ち着き、さらにコロナ[UNK]のステイホームで家族が揃っていることが多く、動物を飼う心構えや迎えた後の生活について皆で真剣に話し合い、意識を共有することができたので、「今なら飼えるかも...」ということになったという小さくて折れそう神谷さん一家は、家の近くの保護猫カフェを調べて、行ける範囲のところ数軒に足を運んだが、保護猫カフェでは兄弟一緒に里親を募集していることが多かった。「兄弟一緒にい\n","↓\n","「ドラゴン桜」が明かす「私のか?」車になった猫の“猫の\"に聞いた\n","Epoch 5/10\n","169/169 [==============================] - 46s 272ms/step - loss: 2.1705 - ACC: 0.1449 - val_loss: 2.6627 - val_ACC: 0.1165\n","現地時間7月2日、英紙『EveningStandard』は、日本代表DF冨安健洋の獲得を望むトッテナムが、改めてオファーを出す準備をしていると報じた。複数の現地メディアは先日、「トッテナムが1500万ユーロ(約18億7500万円)+ボーナス300万ユーロ(約3億7500万円)の計1800万ユーロを提示したが、ボローニャは2000万ユーロ(約25億円)を下るオファーには応じない姿勢を明らかにした」と伝えた。『EveningStandard』紙によれば、トッテナムは週明けにも「改善したオファー」を出す予定だという。冨安を「守備のオプションが必須なクラブにとって賢明な選択」と評価しているようだ。また、スパーズはインテルのDFミラン・シュクリニアルの獲得にも動いており、移籍が取り沙汰されているFWハリー・ケインについては、「ヌーノ・エスピリト・サント新監督が、EUROが終わる前に、将来について話し合うことを望んでいる」と伝えている。\"守備の国\"と呼ばれるイタリアで評価を高めた22歳のDFは、プレミアリーグに新天地を求めるのか。今後の動向が注目される。構成●サッカーダイジェストWeb編集部【PHOTO】イタリアで評価急上昇中!真のサムライ、冨安健洋のキャリアギャラリー2016-2020\n","↓\n","「東京五輪では何か」「1日連続のかな」「日本の刃」が登場\n","Epoch 6/10\n","169/169 [==============================] - 46s 270ms/step - loss: 1.9536 - ACC: 0.1626 - val_loss: 2.6748 - val_ACC: 0.1188\n","1100万超の有権者をかかえる東京都の都議会議員選挙が6月25日に告示され、投票日は7月4日だ。定数127議席を217人の立候補者が争う。前回は小池百合子知事率いる「都民ファーストの会」と自民党都連との対立や、築地市場の豊洲移転問題の行方など話題が尽きなかった。その4年後となる今回の都議選。やはり、多くの都民が気になるのは都民ファーストの勢いだろう。しかし、国政選挙に比べて日頃の選挙民の関心は薄く、地方議会の活動や議員の仕事ぶりはあまり知られていない。そこで、都民ファーストの動向についてふれたうえで、普段の都議会・都議の活動内容について考えてみたい。小池百合子都知事[Photobygettyimages]離党者が相次いだ都民ファースト都民ファーストは、2016年に知事に初当選した小池氏が立ち上げ、17年1月に地域政党としての活動を始めた。同年7月の前回都議選で大会派だった自民党と戦って大勝し、追加公認を含めて55議席を得た。しかし、その後、計8名が離党した(うち石毛しげる氏は除名処分)。今年の2月19日の記者会見で小池都知事(現在、都民ファースト特別顧問)は「離党等をされた方々というのは、よく有権者が見ているということも確認されたほうがよろしいかと思う」と発言し、党内の引き締めを図っている。都議会の構成は、勢力順に都民ファースト46、自民25、公明23、共産18、立民7...と続いており、都民ファーストは現在も最大勢力だ(数字は都議会広報課公表資料)。今回の選挙では、前回、小池知事率いる都民ファーストと選挙協力した公明党が自民党と協力関係を復活させた。都民ファーストと自民党・公明党の勢力争いとともに、共産党や立憲民主党などの議席の行方も注目される。地方議会の定数は地方自治法の規定に基づいて各自治体の条例で決められている。現在の東京都議会の定数は127。選挙区は42ある。選挙区は市区等の行政区分を原則としているために人口差が大きく、各選挙区の定数は、1名から8名の選挙区までさまざまだが、人口が少ない選挙区よりも多い選挙区の方が定数が少ない「逆転現象」があり、選挙区の定数を4増4減することで是正されるとみられていた。しかし、結局、都民\n","↓\n","「都議選」で入院したの大惨状に大企業のか?\n","Epoch 7/10\n","169/169 [==============================] - 46s 271ms/step - loss: 1.7509 - ACC: 0.1816 - val_loss: 2.7020 - val_ACC: 0.1197\n","福岡県で5才の男の子が餓死した事件で、今年3月その母親とママ友が逮捕されましたが、ママ友にまるで洗脳されたかのような2人の関係性が話題になりました。ママ友のトラブルは近年増加しているといいます。無視やLINEグループ外し、悪口に陰口、価値観の押し付け、マウントなど、その種類はさまざまです。兵庫県在住の真奈さん(仮名・30代)も、ママ友トラブルに巻き込まれた一人です。【漫画】ママ友からどうしてこんなメールが!?...全編を読む真奈さんのもとに、ある日突然、知り合って1年ほどのママ友(A子さん)から「絶縁メール」が届きました。――絶縁メールの内容について教えていただけますか真奈さん:はい、A子さんから来た絶縁メールには「あなたの子育て方針が気に入らない。あなたの考え方はおかしい、情報が後出しだ」と書かれていました。――A子さんが怒っていることは何だったのでしょう?真奈さん:不登校気味の娘が新しいクラスになじめなくて、クラスの子たちからもいじめられていたので担任の先生に相談をしていたのです。しかし、A子さんは「子どものいじめをいちいち担任に相談するなんておかしい。親が子どもの世界に口出しをするなんてありえない」「自分の子どもの味方をするのは間違えている。私は自分の子がいじめられても絶対に自分の子を擁護しない。いじめられる方が悪い」...など文字数にして1000文字程でしょうか。びっしりと私への行動に対する批判や恨みが書きつづられていました。――そもそもA子さんとはどのような関係だったのですか?真奈さん:A子さんと知り合ったきっかけは小学校のお迎えでした。挨拶をするうちに親しくなり、A子さんに「連絡先を交換しませんか」と言われて連絡先を交換しました。ただ、いくら親しくても子どものことや家族のことで話したくないことだってありますよね。しかしA子さんは「私は聞いていない。私に話さないのはおかしい」と言って怒っていました。――それで「情報が後出しだ」などとも書かれていたのですね。真奈さん:メールの最後には「あなたとは考え方が違うから二度と私に話しかけてこないでください。私はこれ以上あなたと話すことはなにもありません。さようなら」と書かれ\n","↓\n","「私は自分で...」ママ友グループだった女性たちの「女性のママ」「ママ友グループ」と思い\n","Epoch 8/10\n","169/169 [==============================] - 46s 270ms/step - loss: 1.5613 - ACC: 0.2009 - val_loss: 2.7698 - val_ACC: 0.1191\n","すき家は5月6日~9日、母に感謝の気持ちを伝える「母の日」にむけて、赤とピンクのカーネーションを全国の牛丼チェーン店「すき家」約900店舗限定で販売する。1店舗100本限定で販売し、売り切れ次第終了となる。すき家母の日カーネーション販売「すき家」では2020年にもカーネーションを販売したが、その際に「身近なすき家でカーネーションを買えるのがいい」「すき家とお花屋さん、実によいタッグだと思います」など好評の声が寄せられたという。今年はより多くの人にカーネーションを届けるため、販売店舗を広げる。販売するカーネーションは、「母への愛・純粋な愛」を表す赤いカーネーションと、「感謝・あたたかい心」を表すピンクのカーネーション。価格は1本100円。販売店舗は、すき家公式サイト内で確認できる。昨年の様子\n","↓\n","可愛い「水筒に」は、電池積載\n","Epoch 9/10\n","169/169 [==============================] - 46s 270ms/step - loss: 1.3802 - ACC: 0.2230 - val_loss: 2.8708 - val_ACC: 0.1184\n","京都アニメーション第1スタジオでの放火殺人事件から2年。事件の起こった7月18日を前に同社は、現地での追悼を控えるよう呼びかけた。18日前後を問わず、「現地へのお越しは固くご辞退申し上げます」としている。京都アニメーションは2日、「7月18日現地追悼のご辞退について」というお知らせをホームページに掲載。冒頭では、事件から2年が経過することについて「悲しみは決して消えることはなく、スタッフ皆で支えあいながらアニメーションを制作し、1日1日を積み重ねて参りました」と苦しい胸の内を綴っている。また、追悼の式典については、「新型感染症に関わる情勢」を鑑みて、昨年同様YouTubeチャンネルで追悼のための映像配信を実施。「7月18日前後を問わず、弊社第1スタジオ跡地付近へのお越しはお控えください。近隣住民の方々へのご配慮を何卒お願い申し上げます」と呼びかけている。映像の配信は、7月18日10時30分から10時40分の予定。10時35分から黙祷を行うとしている。この映像は配信終了後も、当日に限り終日、視聴することができる。\n","↓\n","声優・島相「『エヴァ』で謝罪」発表、事務所が謝罪\n","Epoch 10/10\n","169/169 [==============================] - 46s 269ms/step - loss: 1.2146 - ACC: 0.2462 - val_loss: 2.9678 - val_ACC: 0.1173\n","6月18日、スキューバダイビングをしていたアメリカの女性が水底で緑色の小さなボトルを見つけた。その中には1926年と日付の書かれたメッセージが入っていたことをFacebookに投稿すると、10万件以上もシェアされた。その後、メッセージを書いた本人は亡くなっていたことが分かったものの、その娘に連絡がついたという。『MichiganRadio』などが伝えた。【この記事の他の写真を見る】今回のメッセージボトルは、米ミシガン州シボイガン郡にて難破船ツアーやシュノーケリングなどのアクティビティを提供する会社「NauticalNorthFamilyAdventures」を運営するジェニファー・ドウカーさん(JenniferDowker、45)が発見した。ジェニファーさんはシボイガン川にてスキューバダイビングの装備を身に着け、船底がガラス状になっていて水中を覗くことができるグラスボートを外側から清掃していた。「水中を泳いでいると、水深3メートルほどの場所で小さな緑色のボトルを見つけたんです。手に取ってみると、中に丸まった紙が入っていることに気付きました。よく見ると“This\"という文字が見えて、大喜びしましたね。」ジェニファーさんは普段からこんなことが起きないかと考えていたと言い、まるで物語が始まるかのような発見に興奮したという。ボトルを手に水面に戻ってきたジェニファーさんは、船にいた一等航海士のロブ・ヘンメルさん(RobHemmer)や一緒にいた顧客と共にボトルを開封することにした。ボトルはコルクで栓がされていたものの劣化で一部が欠けてしまっており、中には3分の2ほど水が入っていたという。ロブさんは持っていたジャックナイフでコルクを抜いて中の水を捨てるとそこから器用に手紙を取り出し、慎重に広げてメッセージを確認した。「このメッセージを見つけた人は、ミシガン州シボイガン郡のジョージ・モロー(GeorgeMorrow)に渡して、発見場所を教えてください。」メッセージには“1926年11月\"と日付が記載されており、なんと95年前のメッセージと判明した。「濡れていましたが、まだ字を読めたことに驚きましたよ」と当時の心境を明かしたジェニファーさんだが「この手紙は保存しておかなければ」と考えて、地元の博物館で働い\n","↓\n","10歳男、スマホで10年後手に「祝融号」があった漫画が「絶望する」\n"],"name":"stdout"},{"output_type":"execute_result","data":{"text/plain":["<tensorflow.python.keras.callbacks.History at 0x7ff3229fca90>"]},"metadata":{"tags":[]},"execution_count":44}]},{"cell_type":"code","metadata":{"id":"8e0ac093-6b26-46cb-b619-9ac0b81ecef9"},"source":["train_model.save_weights(\"./train_model_weight.h5\")"],"id":"8e0ac093-6b26-46cb-b619-9ac0b81ecef9","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"h8zb8TgF9ffJ"},"source":["# train_model.load_weights(\"./train_model_weight.h5\")"],"id":"h8zb8TgF9ffJ","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"PtSuV5pwMeee"},"source":["def decode_title(input_sentence):\n","  decoder_sentence = \"[BOS]\"\n","  input_sentence = \" \".join(tokenizer.tokenize(input_sentence))\n","  encoder_sentence_ = keras_tokenizer.texts_to_sequences([input_sentence])\n","  encoder_sentence_ = pp.sequence.pad_sequences(encoder_sentence_, maxlen=ENC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","  for i in range(30):\n","    decoder_sentence_ = keras_tokenizer.texts_to_sequences([decoder_sentence])\n","    decoder_sentence_ = pp.sequence.pad_sequences(decoder_sentence_, maxlen=DEC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","    pred = train_model((encoder_sentence_, decoder_sentence_))\n","    sampled_tkn_idx = np.argmax(pred[0,i,:])\n","    sampled_tkn = keras_tokenizer.index_word[sampled_tkn_idx]\n","    decoder_sentence =  decoder_sentence + \" \" + sampled_tkn\n","    if sampled_tkn == \"[EOS]\":\n","      break\n","  return \"\".join(re.sub(\"#\", \"\", decoder_sentence).split(\" \")[1:-1])"],"id":"PtSuV5pwMeee","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"UPPBudA4QTiv","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1627954747507,"user_tz":-540,"elapsed":2182,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"70590c05-4189-443e-ec79-7bbc25accec7"},"source":["idx = 1000\n","print(datasets[idx][0])\n","print(\"↓\")\n","print(decode_title(datasets[idx][0]))\n","print(\"↓\")\n","print(datasets[idx][1])"],"id":"UPPBudA4QTiv","execution_count":null,"outputs":[{"output_type":"stream","text":["「しっかり休憩を取っているのに疲れが取れない」「工夫しているのに集中力が続かない」毎日の仕事を効率よくしたいのに、なかなか思うようにいかない人がほとんどなのではないでしょうか。もしかしたら、あなたのアプローチが合っていないのかもしれません。「日々を最適化することによって、あなたの仕事や人生は、もっと楽に、もっと楽しくなる」と精神科医でSNSでも信頼を集めている樺沢紫苑さんは言います。私たちが取るべき最適な行動とは一体…。著書『行動最適化大全』より、脳科学・心理学の観点から意外と知らない体事情をお届けします。6時間以下睡眠の危険性①「感情の不安定」国立精神・神経医療研究センターの研究によると、1日に4時間半ほどの睡眠不足状態が5日間続くと、うつ病や統合失調症などの患者と似た脳機能の変化がみられ、不安や混乱、抑うつ(気分の落ち込み)傾向が強まることが明らかにされました。つまり、睡眠不足の人は、それだけで情動が不安定になり、抑うつも現れるのです。「危険の警報装置」ともいわれる脳の扁桃体は、不安、恐怖、怒りなどのマイナス感情のスイッチをオンにしますが、睡眠不足になると扁桃体が簡単に興奮しやすくなります。これにより不安、恐怖、怒りなどが出やすくなるのです。日常的に6時間睡眠以下の人は、「感情の不安定さ」がもうすでに出ている可能性があります。必要な睡眠時間は7時間以上です。睡眠をきちんととることで感情は安定します。たった1時間睡眠を増やすだけで、「仕事や人間関係が順調になる」と思えば、それはものすごく有効な時間投資といえるのではないでしょうか。6時間以下睡眠の危険性②「物覚えが悪くなる」睡眠時間を削って勉強したり、徹夜で勉強したりする人も多いでしょう。しかし、勉強した内容は「6時間以上の睡眠」をとらないと記憶として定着しないので注意してください。人間は、睡眠中に入力された情報の整理を行っていますが、睡眠時間が足りないと、整理する時間が足りなくなり、記憶として定着しません。それでは、せっかくの勉強がムダになります。記憶定着のためにも6時間以上の睡眠は欠かせないのです。明日の自分のパフォーマンスを上げて、幸せになる睡眠とはステップ①「夜の神経」に切り替えるスポーツジムや映画から帰ってきて、すぐに布団に入ってもなかなか眠れないものです。脳や身体が興奮した状態で、睡眠に入るのは無理なのです。仮に寝つけたしても、リラックスできていないので、疲れはとれません。医学的にいえば、「昼の神経」である交感神経から、「夜の神経」である副交感神経への切り替えが必要です。布団に入ったときに、副交感神経が優位のリラックスした状態になっていると睡眠は深まり、疲労回復効果も大きくなります。この副交感神経への切り替えには、約2時間必要だといわれます。つまり、寝る前2時間をリラックスして過ごすことが、「深い睡眠」のための必要条件、また翌日のパフォーマンスを高める必須条件となるのです。リラックスする具体的な方法は以下の7つです。\"1.睡眠90分前入浴/入浴は最強のリラックス法です。2.のんびりする/お風呂上がりなどに、何もしないでボーッとするのはとてもよいことです。3.コミュニケーション/家族団らん、子供と遊ぶ、ペットとたわむれるとオキシトシンが分泌されます。4.読書/読書にはリラックス効果があり、眠気を誘います。夢中になる小説、漫画はダメです。5.リラックス系娯楽/音楽、マッサージ、アロマキャンドルなど。6.暗めの部屋で過ごす/蛍光灯のついた明るい部屋にいると脳は覚醒するので間接照明、赤色光(電球色)のやや暗い部屋で過ごしましょう。すると脳は睡眠の準備に入ります。7.1日の振り返り日記/日記や3行ポジティブ日記を書きます。\"出典行動最適化大全ステップ②とりあえず30分前リラックス寝る前2時間は、「スマホを見ないように!」と注意しても、ほとんどの人は「無理です!」と言います。そこで私は、「寝る前30分は、スマホ利用時間は5分にする」ことをお勧めしています。どうしても、寝る直前にメッセージをチェックしないと落ち着かない人もいるでしょう。だから5分くらいはよしとします。ただし、「ずっとスマホをさわり続けたり、ベッドにスマホを持ち込んだりするのはやめましょう」ということです。寝る前2時間にやってはいけないことを「どうしてもやってしまう」という人はいるでしょう。その場合、まずは「寝る前30分はやらない」というルールからスタートしましょう。それだけでも、寝つきがよくなり、睡眠が深まる人は多いものです。1日24時間、あわただしく過ごしているので、せめて寝る前「30分」だけは、リラックスして、のんびり過ごしてみませんか。それが、睡眠を深め、疲労を回復し、明日の活力につながり、翌日のパフォーマンスを高めるのですから、非常に有益な時間投資といえます。ステップ③ピークエンドの法則で幸福感アップよく「終わり良ければ全てよし」といいますが、これは科学的に正しいのです。ノーベル経済学賞を受賞したダニエル・カーネマン博士は、「ピークエンドの法則」を提唱しています。「ピークエンドの法則」とは、冷水に手を入れて不快感を計測する実験で、最後の30秒だけ「ぬるま湯」に手を入れてもらうグループでは、不快度が大きく減少したという実験から生まれました。つまり人間の印象は「ピーク」と「エンド」で決まるということです。日常生活で何が起きるかは、自分でコントロールできませんが、寝る前に「何を考えるか」は自分でコントロールできます。「上司に叱られた」のようなネガティブな体験を思い出し、クヨクヨしたり、イライラしたり、不安な気持ちで布団に入る人は少なくないはず。「上司に叱られた」ことを思い出して眠れば、「最悪の1日」になりますが、「書類を完成して提出した!」ことを思い出せば、達成感と充実感のある「幸せな1日」として締めくくれるのです。不安とは、扁桃体の興奮の結果です。扁桃体が興奮すると、脳も身体も臨戦状態となりますから、眠りを妨げます。寝る直前は、「ネガティブ体験」ではなく、「ポジティブ体験」を思い出して、ハッピーな気分でそのまま眠りましょう。すると「いい1日だった」という記憶が定着し、睡眠も深まるのです。パフォーマンスが上がる行動がわかる\"本書は、人生をもっと改善し、うまく進めたいのに「どうしたらいいかわからない」人たちに対する、「行動指針」であり「答え」でもあります。\"出典行動最適化大全と樺沢さんが語っている通り、同書には日常生活の悩みが解決するノウハウが分かりやすく紹介されています。何かストレスを感じた時、うまくいかないと悩んでいる時に、ぜひ手にとって欲しい一冊です。同書から、とりあえずできそうな行動を実践してみてはいかがでしょうか?最大限のパフォーマンスを発揮できるようになるはずです。\n","↓\n","精神科医の“6時間10分\"で花火を、、感情が不安定にはし、感情が不安定なるし、静岡\n","↓\n","精神科医「6時間睡眠以下の人は、感情が不安定になるし、物覚えが悪くなる」\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"jytx7fKSOnxH"},"source":["news_sample = '''比嘉愛未（35）主演の連ドラ「推しの王子様」（フジテレビ系木曜夜10時）。乙女ゲームを手がけるベンチャー企業の女社長・泉美が、自身の理想通りにつくった推しキャラのケント様にそっくりな航（渡辺圭祐＝27）に出会うことで始まる物語だが、当初主演予定だった深田恭子（38）が適応障害で休業することを公表し、降板。急きょ代役で泉美を演じることになったのが、比嘉だ。\n","\n","比嘉愛未「2行のセリフ」が言えなかった駆け出し時代\n","\n","「最近の代役といえば、NHK大河『麒麟がくる』でしょう。沢尻エリカの代役で、川口春奈が帰蝶を演じましたが、ふたを開けてみると、〈川口でよかった〉の声がほとんどだった。『推しの王子様』の比嘉も、初回を見る限り、そういう評価になりそうな予感がします。仕事ができる女社長役って、深田よりむしろ比嘉の方がハマる気がしますもんね」（ドラマ制作会社スタッフ）'''"],"id":"jytx7fKSOnxH","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"iBtFkb6vOtcp","colab":{"base_uri":"https://localhost:8080/","height":69},"executionInfo":{"status":"ok","timestamp":1627954717315,"user_tz":-540,"elapsed":10,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"16d9d626-45d4-4b34-ba32-b75e2d2348d7"},"source":["news_sample = re.sub(r\"\\s\", \"\", news_sample)\n","news_sample = re.sub(\"\\u3000\", \"\", news_sample)\n","news_sample"],"id":"iBtFkb6vOtcp","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'比嘉愛未（35）主演の連ドラ「推しの王子様」（フジテレビ系木曜夜10時）。乙女ゲームを手がけるベンチャー企業の女社長・泉美が、自身の理想通りにつくった推しキャラのケント様にそっくりな航（渡辺圭祐＝27）に出会うことで始まる物語だが、当初主演予定だった深田恭子（38）が適応障害で休業することを公表し、降板。急きょ代役で泉美を演じることになったのが、比嘉だ。比嘉愛未「2行のセリフ」が言えなかった駆け出し時代「最近の代役といえば、NHK大河『麒麟がくる』でしょう。沢尻エリカの代役で、川口春奈が帰蝶を演じましたが、ふたを開けてみると、〈川口でよかった〉の声がほとんどだった。『推しの王子様』の比嘉も、初回を見る限り、そういう評価になりそうな予感がします。仕事ができる女社長役って、深田よりむしろ比嘉の方がハマる気がしますもんね」（ドラマ制作会社スタッフ）'"]},"metadata":{"tags":[]},"execution_count":67}]},{"cell_type":"code","metadata":{"id":"H8_FLJcvO-ir","colab":{"base_uri":"https://localhost:8080/","height":35},"executionInfo":{"status":"ok","timestamp":1627954722041,"user_tz":-540,"elapsed":1944,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"76e93694-9eaf-4f68-8357-1bba358673d9"},"source":["decode_title(news_sample[0:400])"],"id":"H8_FLJcvO-ir","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'滅の刃の刃物の声優・中島女児選手がコロナ[UNK]のキャラクター「死ぬのか」とは'"]},"metadata":{"tags":[]},"execution_count":68}]},{"cell_type":"code","metadata":{"id":"SGrFWKmMQX33"},"source":["re.sub().split(\" \")[1:-1]"],"id":"SGrFWKmMQX33","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"KPVbm1NxN_uK"},"source":["re.sub?"],"id":"KPVbm1NxN_uK","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"hMx9de2vOAzZ"},"source":[""],"id":"hMx9de2vOAzZ","execution_count":null,"outputs":[]}]}