{"nbformat":4,"nbformat_minor":5,"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.10"},"colab":{"name":"Keras-Seq2Seq.ipynb-V4(tf-transformer)","provenance":[{"file_id":"16nCJuq5pVhz4ttGLwJJdLsq1cnJND_MV","timestamp":1627949471558},{"file_id":"17dS2uuvu8xYuVB50nQ_dKMxZ1339v3gS","timestamp":1627522945553},{"file_id":"10Z2NcwruxPj3Zq-h6ZCIBh5jtG9_dKNw","timestamp":1627428694725}],"collapsed_sections":[],"machine_shape":"hm"},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"efe20a61f1f345df964de4fa1dc1fba7":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_e3bf14efd8a843779bd9d724bcb15650","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_8eb95ed6a22042c0a5cb1ff528a7a9cb","IPY_MODEL_5b39d5f4e9984f188e5f8dba34a8e18c","IPY_MODEL_f6fbf195cca8437a82c37a78c7c29ddc"]}},"e3bf14efd8a843779bd9d724bcb15650":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"8eb95ed6a22042c0a5cb1ff528a7a9cb":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_8d59aedc0f294c588718cbe864f16412","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"Downloading: 100%","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_0f7c51e3289743888bfc2ed96c1d450d"}},"5b39d5f4e9984f188e5f8dba34a8e18c":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_view_name":"ProgressView","style":"IPY_MODEL_d8605bbe93b24bcdb6e43ce14d076b87","_dom_classes":[],"description":"","_model_name":"FloatProgressModel","bar_style":"success","max":257706,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":257706,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_1ace6c50974a40df9f63bbcb534e032c"}},"f6fbf195cca8437a82c37a78c7c29ddc":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_bf17690d481f44abb33868fb1c9e2932","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 258k/258k [00:00&lt;00:00, 1.01MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_d202490b9fc94346b4ee299c95fbfc28"}},"8d59aedc0f294c588718cbe864f16412":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"0f7c51e3289743888bfc2ed96c1d450d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"d8605bbe93b24bcdb6e43ce14d076b87":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"1ace6c50974a40df9f63bbcb534e032c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"bf17690d481f44abb33868fb1c9e2932":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"d202490b9fc94346b4ee299c95fbfc28":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"R7cZQttqsrp1","executionInfo":{"status":"ok","timestamp":1633941165217,"user_tz":-540,"elapsed":94220,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"5415d205-4c27-472e-ec5c-e0a99f3f0baa"},"source":["!pip install tensorflow==2.4.0-rc0"],"id":"R7cZQttqsrp1","execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting tensorflow==2.4.0-rc0\n","  Downloading tensorflow-2.4.0rc0-cp37-cp37m-manylinux2010_x86_64.whl (394.7 MB)\n","\u001b[K     |████████████████████████████████| 394.7 MB 7.0 kB/s \n","\u001b[?25hRequirement already satisfied: flatbuffers~=1.12.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (1.12)\n","Requirement already satisfied: keras-preprocessing~=1.1.2 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (1.1.2)\n","Requirement already satisfied: six~=1.15.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (1.15.0)\n","Collecting h5py~=2.10.0\n","  Downloading h5py-2.10.0-cp37-cp37m-manylinux1_x86_64.whl (2.9 MB)\n","\u001b[K     |████████████████████████████████| 2.9 MB 34.5 MB/s \n","\u001b[?25hRequirement already satisfied: termcolor~=1.1.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (1.1.0)\n","Collecting gast==0.3.3\n","  Downloading gast-0.3.3-py2.py3-none-any.whl (9.7 kB)\n","Collecting protobuf~=3.13.0\n","  Downloading protobuf-3.13.0-cp37-cp37m-manylinux1_x86_64.whl (1.3 MB)\n","\u001b[K     |████████████████████████████████| 1.3 MB 46.1 MB/s \n","\u001b[?25hRequirement already satisfied: wrapt~=1.12.1 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (1.12.1)\n","Requirement already satisfied: google-pasta~=0.2 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (0.2.0)\n","Requirement already satisfied: wheel~=0.35 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (0.37.0)\n","Requirement already satisfied: numpy~=1.19.2 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (1.19.5)\n","Requirement already satisfied: astunparse~=1.6.3 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (1.6.3)\n","Requirement already satisfied: typing-extensions~=3.7.4 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (3.7.4.3)\n","Collecting grpcio~=1.32.0\n","  Downloading grpcio-1.32.0-cp37-cp37m-manylinux2014_x86_64.whl (3.8 MB)\n","\u001b[K     |████████████████████████████████| 3.8 MB 20.1 MB/s \n","\u001b[?25hRequirement already satisfied: opt-einsum~=3.3.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (3.3.0)\n","Collecting tensorflow-estimator~=2.3.0\n","  Downloading tensorflow_estimator-2.3.0-py2.py3-none-any.whl (459 kB)\n","\u001b[K     |████████████████████████████████| 459 kB 50.5 MB/s \n","\u001b[?25hRequirement already satisfied: absl-py~=0.10 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (0.12.0)\n","Requirement already satisfied: tensorboard~=2.3 in /usr/local/lib/python3.7/dist-packages (from tensorflow==2.4.0-rc0) (2.6.0)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.7/dist-packages (from protobuf~=3.13.0->tensorflow==2.4.0-rc0) (57.4.0)\n","Requirement already satisfied: google-auth-oauthlib<0.5,>=0.4.1 in /usr/local/lib/python3.7/dist-packages (from tensorboard~=2.3->tensorflow==2.4.0-rc0) (0.4.6)\n","Requirement already satisfied: requests<3,>=2.21.0 in /usr/local/lib/python3.7/dist-packages (from tensorboard~=2.3->tensorflow==2.4.0-rc0) (2.23.0)\n","Requirement already satisfied: werkzeug>=0.11.15 in /usr/local/lib/python3.7/dist-packages (from tensorboard~=2.3->tensorflow==2.4.0-rc0) (1.0.1)\n","Requirement already satisfied: tensorboard-plugin-wit>=1.6.0 in /usr/local/lib/python3.7/dist-packages (from tensorboard~=2.3->tensorflow==2.4.0-rc0) (1.8.0)\n","Requirement already satisfied: markdown>=2.6.8 in /usr/local/lib/python3.7/dist-packages (from tensorboard~=2.3->tensorflow==2.4.0-rc0) (3.3.4)\n","Requirement already satisfied: google-auth<2,>=1.6.3 in /usr/local/lib/python3.7/dist-packages (from tensorboard~=2.3->tensorflow==2.4.0-rc0) (1.35.0)\n","Requirement already satisfied: tensorboard-data-server<0.7.0,>=0.6.0 in /usr/local/lib/python3.7/dist-packages (from tensorboard~=2.3->tensorflow==2.4.0-rc0) (0.6.1)\n","Requirement already satisfied: rsa<5,>=3.1.4 in /usr/local/lib/python3.7/dist-packages (from google-auth<2,>=1.6.3->tensorboard~=2.3->tensorflow==2.4.0-rc0) (4.7.2)\n","Requirement already satisfied: pyasn1-modules>=0.2.1 in /usr/local/lib/python3.7/dist-packages (from google-auth<2,>=1.6.3->tensorboard~=2.3->tensorflow==2.4.0-rc0) (0.2.8)\n","Requirement already satisfied: cachetools<5.0,>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from google-auth<2,>=1.6.3->tensorboard~=2.3->tensorflow==2.4.0-rc0) (4.2.4)\n","Requirement already satisfied: requests-oauthlib>=0.7.0 in /usr/local/lib/python3.7/dist-packages (from google-auth-oauthlib<0.5,>=0.4.1->tensorboard~=2.3->tensorflow==2.4.0-rc0) (1.3.0)\n","Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from markdown>=2.6.8->tensorboard~=2.3->tensorflow==2.4.0-rc0) (4.8.1)\n","Requirement already satisfied: pyasn1<0.5.0,>=0.4.6 in /usr/local/lib/python3.7/dist-packages (from pyasn1-modules>=0.2.1->google-auth<2,>=1.6.3->tensorboard~=2.3->tensorflow==2.4.0-rc0) (0.4.8)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests<3,>=2.21.0->tensorboard~=2.3->tensorflow==2.4.0-rc0) (1.24.3)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests<3,>=2.21.0->tensorboard~=2.3->tensorflow==2.4.0-rc0) (2021.5.30)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests<3,>=2.21.0->tensorboard~=2.3->tensorflow==2.4.0-rc0) (2.10)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests<3,>=2.21.0->tensorboard~=2.3->tensorflow==2.4.0-rc0) (3.0.4)\n","Requirement already satisfied: oauthlib>=3.0.0 in /usr/local/lib/python3.7/dist-packages (from requests-oauthlib>=0.7.0->google-auth-oauthlib<0.5,>=0.4.1->tensorboard~=2.3->tensorflow==2.4.0-rc0) (3.1.1)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->markdown>=2.6.8->tensorboard~=2.3->tensorflow==2.4.0-rc0) (3.6.0)\n","Installing collected packages: protobuf, grpcio, tensorflow-estimator, h5py, gast, tensorflow\n","  Attempting uninstall: protobuf\n","    Found existing installation: protobuf 3.17.3\n","    Uninstalling protobuf-3.17.3:\n","      Successfully uninstalled protobuf-3.17.3\n","  Attempting uninstall: grpcio\n","    Found existing installation: grpcio 1.41.0\n","    Uninstalling grpcio-1.41.0:\n","      Successfully uninstalled grpcio-1.41.0\n","  Attempting uninstall: tensorflow-estimator\n","    Found existing installation: tensorflow-estimator 2.6.0\n","    Uninstalling tensorflow-estimator-2.6.0:\n","      Successfully uninstalled tensorflow-estimator-2.6.0\n","  Attempting uninstall: h5py\n","    Found existing installation: h5py 3.1.0\n","    Uninstalling h5py-3.1.0:\n","      Successfully uninstalled h5py-3.1.0\n","  Attempting uninstall: gast\n","    Found existing installation: gast 0.4.0\n","    Uninstalling gast-0.4.0:\n","      Successfully uninstalled gast-0.4.0\n","  Attempting uninstall: tensorflow\n","    Found existing installation: tensorflow 2.6.0\n","    Uninstalling tensorflow-2.6.0:\n","      Successfully uninstalled tensorflow-2.6.0\n","Successfully installed gast-0.3.3 grpcio-1.32.0 h5py-2.10.0 protobuf-3.13.0 tensorflow-2.4.0rc0 tensorflow-estimator-2.3.0\n"]},{"output_type":"display_data","data":{"application/vnd.colab-display-data+json":{"pip_warning":{"packages":["google"]}}},"metadata":{}}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"KK4aJbMtJmIz","executionInfo":{"status":"ok","timestamp":1633941194738,"user_tz":-540,"elapsed":13268,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"a472fa15-f245-40ae-8ffa-550770122fd5"},"source":["!pip install transformers==4.5.0 fugashi==1.1.0 ipadic==1.0.0"],"id":"KK4aJbMtJmIz","execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting transformers==4.5.0\n","  Downloading transformers-4.5.0-py3-none-any.whl (2.1 MB)\n","\u001b[K     |████████████████████████████████| 2.1 MB 5.4 MB/s \n","\u001b[?25hCollecting fugashi==1.1.0\n","  Downloading fugashi-1.1.0-cp37-cp37m-manylinux1_x86_64.whl (486 kB)\n","\u001b[K     |████████████████████████████████| 486 kB 29.7 MB/s \n","\u001b[?25hCollecting ipadic==1.0.0\n","  Downloading ipadic-1.0.0.tar.gz (13.4 MB)\n","\u001b[K     |████████████████████████████████| 13.4 MB 234 kB/s \n","\u001b[?25hRequirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (21.0)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (3.3.0)\n","Collecting tokenizers<0.11,>=0.10.1\n","  Downloading tokenizers-0.10.3-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (3.3 MB)\n","\u001b[K     |████████████████████████████████| 3.3 MB 24.1 MB/s \n","\u001b[?25hRequirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (2.23.0)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (2019.12.20)\n","Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (4.8.1)\n","Collecting sacremoses\n","  Downloading sacremoses-0.0.46-py3-none-any.whl (895 kB)\n","\u001b[K     |████████████████████████████████| 895 kB 50.6 MB/s \n","\u001b[?25hRequirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (1.19.5)\n","Requirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.7/dist-packages (from transformers==4.5.0) (4.62.3)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->transformers==4.5.0) (3.6.0)\n","Requirement already satisfied: typing-extensions>=3.6.4 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->transformers==4.5.0) (3.7.4.3)\n","Requirement already satisfied: pyparsing>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging->transformers==4.5.0) (2.4.7)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (1.24.3)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (2021.5.30)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->transformers==4.5.0) (3.0.4)\n","Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers==4.5.0) (1.15.0)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers==4.5.0) (1.0.1)\n","Requirement already satisfied: click in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers==4.5.0) (7.1.2)\n","Building wheels for collected packages: ipadic\n","  Building wheel for ipadic (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for ipadic: filename=ipadic-1.0.0-py3-none-any.whl size=13556723 sha256=21b60e8143160bfeb33abf4418604520f7cce00490d83a627d0b18ca9cf6f6ff\n","  Stored in directory: /root/.cache/pip/wheels/33/8b/99/cf0d27191876637cd3639a560f93aa982d7855ce826c94348b\n","Successfully built ipadic\n","Installing collected packages: tokenizers, sacremoses, transformers, ipadic, fugashi\n","Successfully installed fugashi-1.1.0 ipadic-1.0.0 sacremoses-0.0.46 tokenizers-0.10.3 transformers-4.5.0\n"]}]},{"cell_type":"code","metadata":{"id":"ORL3IdiSJ0tm","executionInfo":{"status":"ok","timestamp":1633941219773,"user_tz":-540,"elapsed":25049,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}}},"source":["from transformers import BertJapaneseTokenizer, BertModel, T5Tokenizer"],"id":"ORL3IdiSJ0tm","execution_count":2,"outputs":[]},{"cell_type":"code","metadata":{"id":"_h5NWfrcJ8QB","colab":{"base_uri":"https://localhost:8080/","height":81,"referenced_widgets":["efe20a61f1f345df964de4fa1dc1fba7","e3bf14efd8a843779bd9d724bcb15650","8eb95ed6a22042c0a5cb1ff528a7a9cb","5b39d5f4e9984f188e5f8dba34a8e18c","f6fbf195cca8437a82c37a78c7c29ddc","8d59aedc0f294c588718cbe864f16412","0f7c51e3289743888bfc2ed96c1d450d","d8605bbe93b24bcdb6e43ce14d076b87","1ace6c50974a40df9f63bbcb534e032c","bf17690d481f44abb33868fb1c9e2932","d202490b9fc94346b4ee299c95fbfc28"]},"executionInfo":{"status":"ok","timestamp":1633941221003,"user_tz":-540,"elapsed":1248,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"d6afcd53-638f-4d86-f4d5-512c4a8961b7"},"source":["tokenizer = BertJapaneseTokenizer.from_pretrained(\"cl-tohoku/bert-base-japanese-whole-word-masking\")"],"id":"_h5NWfrcJ8QB","execution_count":3,"outputs":[{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"efe20a61f1f345df964de4fa1dc1fba7","version_minor":0,"version_major":2},"text/plain":["Downloading:   0%|          | 0.00/258k [00:00<?, ?B/s]"]},"metadata":{}},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"8b569ac0f4e344b0838761736e4dfa53","version_minor":0,"version_major":2},"text/plain":["Downloading:   0%|          | 0.00/110 [00:00<?, ?B/s]"]},"metadata":{}}]},{"cell_type":"code","metadata":{"id":"d10aaa01-d57a-4679-8fcb-8481da434324","executionInfo":{"status":"ok","timestamp":1633941223519,"user_tz":-540,"elapsed":2518,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}}},"source":["import os\n","import re\n","import pickle\n","import numpy as np\n","import pandas as pd\n","\n","from sklearn.model_selection import train_test_split\n","from sklearn.metrics import confusion_matrix\n","from sklearn.preprocessing import LabelEncoder\n","import tensorflow as tf\n","from tensorflow import keras\n","from tensorflow.keras import layers, metrics, losses\n","# from tensorflow.keras.layers.experimental.preprocessing import TextVectorization\n","from tensorflow.keras import preprocessing as pp"],"id":"d10aaa01-d57a-4679-8fcb-8481da434324","execution_count":4,"outputs":[]},{"cell_type":"code","metadata":{"id":"-A2TvgxuQE3o","executionInfo":{"status":"ok","timestamp":1633941223523,"user_tz":-540,"elapsed":10,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}}},"source":["ALL_SEED = 2021\n","def all_seed_fixed(seed=41):\n","    os.environ['PYTHONHASHSEED'] = str(seed)\n","    np.random.seed(seed)\n","    tf.random.set_seed(seed)\n","all_seed_fixed(ALL_SEED)"],"id":"-A2TvgxuQE3o","execution_count":5,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"lphILcLltKC3","executionInfo":{"status":"ok","timestamp":1633941223523,"user_tz":-540,"elapsed":9,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"3e16f9d0-3799-41f4-d8cb-d6da51f6bd7d"},"source":["tf.__version__, keras.__version__"],"id":"lphILcLltKC3","execution_count":6,"outputs":[{"output_type":"execute_result","data":{"text/plain":["('2.4.0-rc0', '2.4.0')"]},"metadata":{},"execution_count":6}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"bZrw0fTg2Yse","executionInfo":{"status":"ok","timestamp":1633941241607,"user_tz":-540,"elapsed":18089,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"a382f91c-7124-4fd8-a668-69d566e32369"},"source":["from google.colab import drive\n","drive.mount('/content/drive')"],"id":"bZrw0fTg2Yse","execution_count":7,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"B9hxD4NT2fy9","executionInfo":{"status":"ok","timestamp":1633941241608,"user_tz":-540,"elapsed":8,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"2c07ca11-a6ec-4b80-9ee3-b6e9cf96aeac"},"source":["cd drive/MyDrive/"],"id":"B9hxD4NT2fy9","execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["/content/drive/MyDrive\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"GLFf6DUY22iQ","executionInfo":{"status":"ok","timestamp":1633941241970,"user_tz":-540,"elapsed":366,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"88c466b2-ccb3-40c0-a011-431766f2de5c"},"source":["ls -al | grep dataset"],"id":"GLFf6DUY22iQ","execution_count":9,"outputs":[{"output_type":"stream","name":"stdout","text":["-rw------- 1 root root 78862754 Aug 30 02:05 datasets.bin\n","-rw------- 1 root root  3976703 Aug 31 00:48 dev_datasets.bin\n"]}]},{"cell_type":"code","metadata":{"id":"_PyUQh__2W7D","executionInfo":{"status":"ok","timestamp":1633941247147,"user_tz":-540,"elapsed":2547,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}}},"source":["with open(\"./datasets.bin\", \"rb\") as f:\n","  datasets = pickle.load(f)"],"id":"_PyUQh__2W7D","execution_count":10,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0lOpESUYlHwP","executionInfo":{"status":"ok","timestamp":1633941248118,"user_tz":-540,"elapsed":5,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"1af5be20-4609-4c34-d430-c1060a5bdb4c"},"source":["len(datasets)"],"id":"0lOpESUYlHwP","execution_count":11,"outputs":[{"output_type":"execute_result","data":{"text/plain":["24218"]},"metadata":{},"execution_count":11}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":289},"id":"est8GxoKKpP2","executionInfo":{"status":"ok","timestamp":1633941249895,"user_tz":-540,"elapsed":242,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"7c950c6e-2117-4e5b-a232-de28b95a4b73"},"source":["df = pd.DataFrame(datasets, columns=[\"content\", \"title\", \"category\", \"tweet_share\"])\n","df.dropna(inplace=True)\n","df.head()"],"id":"est8GxoKKpP2","execution_count":12,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>content</th>\n","      <th>title</th>\n","      <th>category</th>\n","      <th>tweet_share</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>お笑いトリオ・安田大サーカスのクロちゃんの所属事務所・松竹芸能は19日、クロちゃんが新型コロ...</td>\n","      <td>安田大サーカス・クロちゃん、新型コロナ感染団長安田とは「別ルートでの感染と考えられます」</td>\n","      <td>芸能</td>\n","      <td>1025</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>元ユーチューバー、「へずまりゅう」こと原田将大被告――「…」先月、黒髪で上下黒のスーツを着て...</td>\n","      <td>へずまりゅうに懲役求刑“反省みられない\"</td>\n","      <td>国内</td>\n","      <td>6</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>スピードを上げ…歩道に突進ドライブレコーダーが捉えたのは、コントロールを失った車がスピードを...</td>\n","      <td>【独自】Uターン失敗でパニックに?歩道や花壇に次々と突っ込む…ドラレコが捉えた謎の暴走事故</td>\n","      <td>国内</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>ミュージシャンの小山田圭吾が、学生時代に障がい者へのいじめを行っていたと告白した過去記事をめ...</td>\n","      <td>小山田圭吾のいじめ告白記事『QuickJapan』出版元も謝罪「差別を助長する不適切なもの」</td>\n","      <td>芸能</td>\n","      <td>358</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>韓国の文在寅大統領の日本訪問と首脳会談について19日、韓国側は、不適切な発言を行ったソウルの...</td>\n","      <td>韓国日本大使館幹部処分を首脳会談条件に</td>\n","      <td>海外</td>\n","      <td>28</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                             content  ... tweet_share\n","0  お笑いトリオ・安田大サーカスのクロちゃんの所属事務所・松竹芸能は19日、クロちゃんが新型コロ...  ...        1025\n","1  元ユーチューバー、「へずまりゅう」こと原田将大被告――「…」先月、黒髪で上下黒のスーツを着て...  ...           6\n","2  スピードを上げ…歩道に突進ドライブレコーダーが捉えたのは、コントロールを失った車がスピードを...  ...           3\n","3  ミュージシャンの小山田圭吾が、学生時代に障がい者へのいじめを行っていたと告白した過去記事をめ...  ...         358\n","4  韓国の文在寅大統領の日本訪問と首脳会談について19日、韓国側は、不適切な発言を行ったソウルの...  ...          28\n","\n","[5 rows x 4 columns]"]},"metadata":{},"execution_count":12}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":306},"id":"SwGYLx6YNyw4","executionInfo":{"status":"ok","timestamp":1633941252364,"user_tz":-540,"elapsed":314,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"3ed48ad2-7a8f-4117-8f33-5f78cd0d0e9d"},"source":["df = df.loc[df.category != \"None\"]\n","print(df.shape)\n","df.head()"],"id":"SwGYLx6YNyw4","execution_count":13,"outputs":[{"output_type":"stream","name":"stdout","text":["(24218, 4)\n"]},{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>content</th>\n","      <th>title</th>\n","      <th>category</th>\n","      <th>tweet_share</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>お笑いトリオ・安田大サーカスのクロちゃんの所属事務所・松竹芸能は19日、クロちゃんが新型コロ...</td>\n","      <td>安田大サーカス・クロちゃん、新型コロナ感染団長安田とは「別ルートでの感染と考えられます」</td>\n","      <td>芸能</td>\n","      <td>1025</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>元ユーチューバー、「へずまりゅう」こと原田将大被告――「…」先月、黒髪で上下黒のスーツを着て...</td>\n","      <td>へずまりゅうに懲役求刑“反省みられない\"</td>\n","      <td>国内</td>\n","      <td>6</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>スピードを上げ…歩道に突進ドライブレコーダーが捉えたのは、コントロールを失った車がスピードを...</td>\n","      <td>【独自】Uターン失敗でパニックに?歩道や花壇に次々と突っ込む…ドラレコが捉えた謎の暴走事故</td>\n","      <td>国内</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>ミュージシャンの小山田圭吾が、学生時代に障がい者へのいじめを行っていたと告白した過去記事をめ...</td>\n","      <td>小山田圭吾のいじめ告白記事『QuickJapan』出版元も謝罪「差別を助長する不適切なもの」</td>\n","      <td>芸能</td>\n","      <td>358</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>韓国の文在寅大統領の日本訪問と首脳会談について19日、韓国側は、不適切な発言を行ったソウルの...</td>\n","      <td>韓国日本大使館幹部処分を首脳会談条件に</td>\n","      <td>海外</td>\n","      <td>28</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                             content  ... tweet_share\n","0  お笑いトリオ・安田大サーカスのクロちゃんの所属事務所・松竹芸能は19日、クロちゃんが新型コロ...  ...        1025\n","1  元ユーチューバー、「へずまりゅう」こと原田将大被告――「…」先月、黒髪で上下黒のスーツを着て...  ...           6\n","2  スピードを上げ…歩道に突進ドライブレコーダーが捉えたのは、コントロールを失った車がスピードを...  ...           3\n","3  ミュージシャンの小山田圭吾が、学生時代に障がい者へのいじめを行っていたと告白した過去記事をめ...  ...         358\n","4  韓国の文在寅大統領の日本訪問と首脳会談について19日、韓国側は、不適切な発言を行ったソウルの...  ...          28\n","\n","[5 rows x 4 columns]"]},"metadata":{},"execution_count":13}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"31jtJqfzNtVt","executionInfo":{"status":"ok","timestamp":1633941253218,"user_tz":-540,"elapsed":180,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"44592b5b-4bc6-4cd4-9578-b3c758e95fc2"},"source":["df.category.value_counts()"],"id":"31jtJqfzNtVt","execution_count":14,"outputs":[{"output_type":"execute_result","data":{"text/plain":["芸能              7150\n","IT 経済           3255\n","国内              3089\n","海外              2906\n","グルメ             2127\n","スポーツ            2029\n","ライフ総合           1169\n","ライフスタイル          938\n","恋愛               810\n","ファッション・ビューティ     467\n","車                278\n","Name: category, dtype: int64"]},"metadata":{},"execution_count":14}]},{"cell_type":"code","metadata":{"id":"Vf4Af7gGfmXA","executionInfo":{"status":"ok","timestamp":1633941254771,"user_tz":-540,"elapsed":197,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}}},"source":["# df = df.loc[df.category.isin([\"IT 経済\", \"国内\", \"ライフ総合\", \"恋愛\"])]\n","# df.shape"],"id":"Vf4Af7gGfmXA","execution_count":15,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":289},"id":"JkiRTi_0NXIs","executionInfo":{"status":"ok","timestamp":1633941255114,"user_tz":-540,"elapsed":2,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"00879188-7224-4dc0-bac0-8e42271f9e41"},"source":["le = LabelEncoder()\n","df[\"category_idx\"] = le.fit_transform(df.category.values)\n","df.head()"],"id":"JkiRTi_0NXIs","execution_count":16,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>content</th>\n","      <th>title</th>\n","      <th>category</th>\n","      <th>tweet_share</th>\n","      <th>category_idx</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>お笑いトリオ・安田大サーカスのクロちゃんの所属事務所・松竹芸能は19日、クロちゃんが新型コロ...</td>\n","      <td>安田大サーカス・クロちゃん、新型コロナ感染団長安田とは「別ルートでの感染と考えられます」</td>\n","      <td>芸能</td>\n","      <td>1025</td>\n","      <td>9</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>元ユーチューバー、「へずまりゅう」こと原田将大被告――「…」先月、黒髪で上下黒のスーツを着て...</td>\n","      <td>へずまりゅうに懲役求刑“反省みられない\"</td>\n","      <td>国内</td>\n","      <td>6</td>\n","      <td>6</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>スピードを上げ…歩道に突進ドライブレコーダーが捉えたのは、コントロールを失った車がスピードを...</td>\n","      <td>【独自】Uターン失敗でパニックに?歩道や花壇に次々と突っ込む…ドラレコが捉えた謎の暴走事故</td>\n","      <td>国内</td>\n","      <td>3</td>\n","      <td>6</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>ミュージシャンの小山田圭吾が、学生時代に障がい者へのいじめを行っていたと告白した過去記事をめ...</td>\n","      <td>小山田圭吾のいじめ告白記事『QuickJapan』出版元も謝罪「差別を助長する不適切なもの」</td>\n","      <td>芸能</td>\n","      <td>358</td>\n","      <td>9</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>韓国の文在寅大統領の日本訪問と首脳会談について19日、韓国側は、不適切な発言を行ったソウルの...</td>\n","      <td>韓国日本大使館幹部処分を首脳会談条件に</td>\n","      <td>海外</td>\n","      <td>28</td>\n","      <td>8</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                             content  ... category_idx\n","0  お笑いトリオ・安田大サーカスのクロちゃんの所属事務所・松竹芸能は19日、クロちゃんが新型コロ...  ...            9\n","1  元ユーチューバー、「へずまりゅう」こと原田将大被告――「…」先月、黒髪で上下黒のスーツを着て...  ...            6\n","2  スピードを上げ…歩道に突進ドライブレコーダーが捉えたのは、コントロールを失った車がスピードを...  ...            6\n","3  ミュージシャンの小山田圭吾が、学生時代に障がい者へのいじめを行っていたと告白した過去記事をめ...  ...            9\n","4  韓国の文在寅大統領の日本訪問と首脳会談について19日、韓国側は、不適切な発言を行ったソウルの...  ...            8\n","\n","[5 rows x 5 columns]"]},"metadata":{},"execution_count":16}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"YGL2dH6pppH6","executionInfo":{"status":"ok","timestamp":1633941257533,"user_tz":-540,"elapsed":508,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"5c2ce943-aca6-47a2-927b-72c6e099d0d7"},"source":["df.drop_duplicates(inplace=True)\n","df.shape"],"id":"YGL2dH6pppH6","execution_count":17,"outputs":[{"output_type":"execute_result","data":{"text/plain":["(23913, 5)"]},"metadata":{},"execution_count":17}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":35},"id":"ve19Ro6CmV9T","executionInfo":{"status":"ok","timestamp":1633941258612,"user_tz":-540,"elapsed":286,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"f788ce24-c2a9-460a-85a2-9be3b21fd160"},"source":["\" \".join(tokenizer.tokenize(df.title.iloc[0]))"],"id":"ve19Ro6CmV9T","execution_count":18,"outputs":[{"output_type":"execute_result","data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'安田 大 サーカス ・ クロ ちゃん 、 新型 コロナ 感染 団長 安田 と は 「 別 ルート で の 感染 と 考え られ ます 」'"]},"metadata":{},"execution_count":18}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":379},"id":"iozAZhDxOgXY","executionInfo":{"status":"error","timestamp":1633941318619,"user_tz":-540,"elapsed":59065,"user":{"displayName":"k g.","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"01082649767351199152"}},"outputId":"3fae6e9d-69c0-46a8-cc7c-2b6ea1d91f14"},"source":["df[\"content_\"] = df.content.apply(lambda x: \" \".join(tokenizer.tokenize(x)))\n","df[\"title_\"] = df.title.apply(lambda x: \"[BOS] \" + \" \".join(tokenizer.tokenize(x)) + \" [EOS]\")\n","df.head()"],"id":"iozAZhDxOgXY","execution_count":19,"outputs":[{"output_type":"error","ename":"KeyboardInterrupt","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)","\u001b[0;32m<ipython-input-19-03352f247523>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mdf\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"content_\"\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcontent\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mapply\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;32mlambda\u001b[0m \u001b[0mx\u001b[0m\u001b[0;34m:\u001b[0m \u001b[0;34m\" \"\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjoin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtokenizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mx\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      2\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"title_\"\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtitle\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mapply\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;32mlambda\u001b[0m \u001b[0mx\u001b[0m\u001b[0;34m:\u001b[0m \u001b[0;34m\"[BOS] \"\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0;34m\" \"\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjoin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtokenizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mx\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0;34m\" [EOS]\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mhead\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/pandas/core/series.py\u001b[0m in \u001b[0;36mapply\u001b[0;34m(self, func, convert_dtype, args, **kwds)\u001b[0m\n\u001b[1;32m   4211\u001b[0m             \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   4212\u001b[0m                 \u001b[0mvalues\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mastype\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mobject\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_values\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m-> 4213\u001b[0;31m                 \u001b[0mmapped\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mlib\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mmap_infer\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mvalues\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mf\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mconvert\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mconvert_dtype\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m   4214\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m   4215\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mlen\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmapped\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mand\u001b[0m \u001b[0misinstance\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mmapped\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;36m0\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mSeries\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32mpandas/_libs/lib.pyx\u001b[0m in \u001b[0;36mpandas._libs.lib.map_infer\u001b[0;34m()\u001b[0m\n","\u001b[0;32m<ipython-input-19-03352f247523>\u001b[0m in \u001b[0;36m<lambda>\u001b[0;34m(x)\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0mdf\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"content_\"\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcontent\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mapply\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;32mlambda\u001b[0m \u001b[0mx\u001b[0m\u001b[0;34m:\u001b[0m \u001b[0;34m\" \"\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjoin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtokenizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mx\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      2\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m[\u001b[0m\u001b[0;34m\"title_\"\u001b[0m\u001b[0;34m]\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtitle\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mapply\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;32mlambda\u001b[0m \u001b[0mx\u001b[0m\u001b[0;34m:\u001b[0m \u001b[0;34m\"[BOS] \"\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0;34m\" \"\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mjoin\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtokenizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mx\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;34m+\u001b[0m \u001b[0;34m\" [EOS]\"\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[0mdf\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mhead\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/transformers/tokenization_utils.py\u001b[0m in \u001b[0;36mtokenize\u001b[0;34m(self, text, **kwargs)\u001b[0m\n\u001b[1;32m    360\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    361\u001b[0m         \u001b[0mno_split_token\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0munique_no_split_tokens\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 362\u001b[0;31m         \u001b[0mtokenized_text\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0msplit_on_tokens\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mno_split_token\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mtext\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    363\u001b[0m         \u001b[0;32mreturn\u001b[0m \u001b[0mtokenized_text\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    364\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/transformers/tokenization_utils.py\u001b[0m in \u001b[0;36msplit_on_tokens\u001b[0;34m(tok_list, text)\u001b[0m\n\u001b[1;32m    354\u001b[0m                     (\n\u001b[1;32m    355\u001b[0m                         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_tokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtoken\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mif\u001b[0m \u001b[0mtoken\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0munique_no_split_tokens\u001b[0m \u001b[0;32melse\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0mtoken\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 356\u001b[0;31m                         \u001b[0;32mfor\u001b[0m \u001b[0mtoken\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mtokenized_text\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    357\u001b[0m                     )\n\u001b[1;32m    358\u001b[0m                 )\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/transformers/tokenization_utils.py\u001b[0m in \u001b[0;36m<genexpr>\u001b[0;34m(.0)\u001b[0m\n\u001b[1;32m    354\u001b[0m                     (\n\u001b[1;32m    355\u001b[0m                         \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m_tokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtoken\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;32mif\u001b[0m \u001b[0mtoken\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0munique_no_split_tokens\u001b[0m \u001b[0;32melse\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0mtoken\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 356\u001b[0;31m                         \u001b[0;32mfor\u001b[0m \u001b[0mtoken\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mtokenized_text\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    357\u001b[0m                     )\n\u001b[1;32m    358\u001b[0m                 )\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/transformers/models/bert_japanese/tokenization_bert_japanese.py\u001b[0m in \u001b[0;36m_tokenize\u001b[0;34m(self, text)\u001b[0m\n\u001b[1;32m    188\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    189\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdo_subword_tokenize\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 190\u001b[0;31m             \u001b[0msplit_tokens\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0msub_token\u001b[0m \u001b[0;32mfor\u001b[0m \u001b[0mtoken\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mtokens\u001b[0m \u001b[0;32mfor\u001b[0m \u001b[0msub_token\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msubword_tokenizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtoken\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    191\u001b[0m         \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    192\u001b[0m             \u001b[0msplit_tokens\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtokens\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/transformers/models/bert_japanese/tokenization_bert_japanese.py\u001b[0m in \u001b[0;36m<listcomp>\u001b[0;34m(.0)\u001b[0m\n\u001b[1;32m    188\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    189\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mdo_subword_tokenize\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 190\u001b[0;31m             \u001b[0msplit_tokens\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m[\u001b[0m\u001b[0msub_token\u001b[0m \u001b[0;32mfor\u001b[0m \u001b[0mtoken\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mtokens\u001b[0m \u001b[0;32mfor\u001b[0m \u001b[0msub_token\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msubword_tokenizer\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mtokenize\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtoken\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    191\u001b[0m         \u001b[0;32melse\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    192\u001b[0m             \u001b[0msplit_tokens\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mtokens\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.7/dist-packages/transformers/models/bert/tokenization_bert.py\u001b[0m in \u001b[0;36mtokenize\u001b[0;34m(self, text)\u001b[0m\n\u001b[1;32m    544\u001b[0m                     \u001b[0;32mif\u001b[0m \u001b[0msubstr\u001b[0m \u001b[0;32min\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mvocab\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    545\u001b[0m                         \u001b[0mcur_substr\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0msubstr\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 546\u001b[0;31m                         \u001b[0;32mbreak\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    547\u001b[0m                     \u001b[0mend\u001b[0m \u001b[0;34m-=\u001b[0m \u001b[0;36m1\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    548\u001b[0m                 \u001b[0;32mif\u001b[0m \u001b[0mcur_substr\u001b[0m \u001b[0;32mis\u001b[0m \u001b[0;32mNone\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mKeyboardInterrupt\u001b[0m: "]}]},{"cell_type":"code","metadata":{"id":"87f55129-0acc-48d8-8e4c-fc64982def53"},"source":["keras_tokenizer = pp.text.Tokenizer(filters=\"\", lower=False)\n","keras_tokenizer.fit_on_texts(df.content_.to_list() + df.title_.to_list())"],"id":"87f55129-0acc-48d8-8e4c-fc64982def53","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"31631ddc-b84e-4be3-b56a-b6fbe4309565","executionInfo":{"status":"ok","timestamp":1629854647091,"user_tz":-540,"elapsed":11,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"2ec81f6b-34c4-4c90-ea90-5cb8cf452f2c"},"source":["print(len(keras_tokenizer.word_index))\n","keras_tokenizer.word_index[\"\"] = 0\n","keras_tokenizer.index_word[0] = \"\"\n","print(len(keras_tokenizer.word_index))"],"id":"31631ddc-b84e-4be3-b56a-b6fbe4309565","execution_count":null,"outputs":[{"output_type":"stream","text":["29006\n","29007\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"3eC4O-Uu9hdD"},"source":["with open(\"./keras_tokenizer.bin\", 'wb') as f:\n","    pickle.dump(keras_tokenizer , f)"],"id":"3eC4O-Uu9hdD","execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"E3o0jUKYPlpk"},"source":["## Train, Val Split"],"id":"E3o0jUKYPlpk"},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"f3265sL8PtOY","executionInfo":{"status":"ok","timestamp":1629854647092,"user_tz":-540,"elapsed":11,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"dc271491-01e6-488c-9449-9e4d3d33231e"},"source":["train_df, val_df = train_test_split(df, test_size=0.05, random_state=2021)\n","train_df.shape, val_df.shape"],"id":"f3265sL8PtOY","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["((17738, 7), (934, 7))"]},"metadata":{},"execution_count":29}]},{"cell_type":"code","metadata":{"id":"ee7ce94c-2f0e-49fe-83c8-49c08de8384c"},"source":["train_content = keras_tokenizer.texts_to_sequences(train_df.content_.to_list())\n","val_content = keras_tokenizer.texts_to_sequences(val_df.content_.to_list())\n","train_title = keras_tokenizer.texts_to_sequences(train_df.title_.to_list())\n","val_title = keras_tokenizer.texts_to_sequences(val_df.title_.to_list())"],"id":"ee7ce94c-2f0e-49fe-83c8-49c08de8384c","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5ae385e2-9876-454e-b284-2ac7ee367de9","executionInfo":{"status":"ok","timestamp":1629854656837,"user_tz":-540,"elapsed":20,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"93e6c482-c85e-4848-9578-b2f5f50ba97c"},"source":["\" \".join([keras_tokenizer.index_word[idx] for idx in train_content[0]]), \"->\" , \" \".join([keras_tokenizer.index_word[idx] for idx in train_title[0]])"],"id":"5ae385e2-9876-454e-b284-2ac7ee367de9","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["('202 ##1 年 6 月 28 日 、 韓国 ・ 聯 ##合 ニュース は 、 韓国 の 外交 民間 団体 が 「 独 島 バッジ 」 を 製作 し て 韓国 体育 会 に 寄贈 する 計画 で ある こと を 伝え た 。 記事 に よる と 、 サイバー 外交 使節 団 「 V ##AN ##K 」 は 、 「 E ##AST ##S ##E ##A 」 と 「 Do ##k ##d ##o 」 と 書か れ た 地図 を プリント し た 缶 バッジ を 2000 個 製作 し 、 東京 五輪 参加 者 ら に 配布 する と 明らか に し た 。 東京 五輪 の 出場 選手 や 支援 団 の ユニフォーム 、 服 、 カバ ##ン など に 付け て 広報 する ため に 企画 さ れ た と いう 。 大韓 体育 会 に 寄贈 する 計画 で 、 これ 以外 に も サイバー 外交 官 、 韓国 広報 大使 として 活動 する 会員 に も 配布 する 予定 だ と いう 。 これ を 受け 、 韓国 の ネット 上 で は 「 さす ##が V ##AN ##K 」 「 いい 仕事 を し て くれ た 」 「 選手 団 は ぜ ##ひ バッジ を 付け て 行っ て 」 など 賛同 の 声 が 上がっ て いる 。 一方 、 韓国 政府 に対して は 「 民間 が こんな ##に 頑 ##張っ てる のに 、 政府 は 何 を し て いる の ?」 ##「 歴代 政府 が 今 まで 独 島 問題 に 無 ##責 ##任 だっ た から 、 こんな こと に なっ て しまっ た 」 と 批判 が 寄せ られ 、 その 矛 ##先 は 「 国際 オリンピック 委員 会 は 商売 団体 。 人権 も なに も 、 お金 に なれ ば なん で も やる 」 と IOC に も 向け られ て いる 。 また 、 平 昌 五輪 の 際 に 韓国 政府 は 日本 政府 の 要請 を 受け て 「 統一 旗 」 から 竹島 を 削除 し た ため 「 他人 の 目 を 気 に せ ず 、 今度 こそ は 国民 の 意見 を 推し て ほしい 」 と 求める 声 や 、 「 これ は 政治 的 な 問題 で は なく 地理 的 な 問題 だ から 不利 ##益 に は なら ない はず 」 「 純粋 に 地理 的 な 表示 だ から バッジ を 付け ない 理由 が ない 」 といった 主張 も 出 て いる 。',\n"," '->',\n"," '[BOS] 東京 五輪 で 韓国 選手 ら が 「 独 島 バッジ 」 付ける ? 韓国 の 団体 が 配布 へ = 韓国 ネット 「 ぜ ##ひ 付け て 」 [EOS]')"]},"metadata":{},"execution_count":31}]},{"cell_type":"code","metadata":{"id":"f764185b-e515-4261-bd26-6277dc0d9cda"},"source":["ENC_SEQ_LEN = 1400\n","DEC_SEQ_LEN = 50\n","\n","# 入力\n","train_content = pp.sequence.pad_sequences(train_content, maxlen=ENC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","val_content = pp.sequence.pad_sequences(val_content, maxlen=ENC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","# 出力\n","train_title = pp.sequence.pad_sequences(train_title, maxlen=DEC_SEQ_LEN+1, padding=\"post\", truncating=\"post\")\n","val_title = pp.sequence.pad_sequences(val_title, maxlen=DEC_SEQ_LEN+1, padding=\"post\", truncating=\"post\")"],"id":"f764185b-e515-4261-bd26-6277dc0d9cda","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"TUtA5vG3vZbz"},"source":["train_title_enc, val_title_enc = train_title[:,:-1], val_title[:,:-1]\n","train_title_dec, val_title_dec = train_title[:,1:], val_title[:,1:]"],"id":"TUtA5vG3vZbz","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"7ibGekjCUPDq","executionInfo":{"status":"ok","timestamp":1629854658064,"user_tz":-540,"elapsed":14,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"39b84e96-fd6f-4b76-e3d0-e3cadd142f66"},"source":["# 文書分類ラベル\n","train_category = train_df.category_idx.values\n","val_category = val_df.category_idx.values\n","# # 文書人気予測ラベル\n","# train_tweet = train_df.tweet_share.values\n","# val_tweet = val_df.tweet_share.values\n","\n","train_category.shape, val_category.shape"],"id":"7ibGekjCUPDq","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["((17738,), (934,))"]},"metadata":{},"execution_count":34}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"jD-JIuDFjkJG","executionInfo":{"status":"ok","timestamp":1629854658064,"user_tz":-540,"elapsed":9,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"11042548-927b-40ca-fc38-47c0efda11fb"},"source":["print(train_content.shape, train_title_enc.shape, train_title_dec.shape, train_category.shape)\n","print()\n","print(val_content.shape, val_title_enc.shape, val_title_dec.shape, val_category.shape)"],"id":"jD-JIuDFjkJG","execution_count":null,"outputs":[{"output_type":"stream","text":["(17738, 1400) (17738, 50) (17738, 50) (17738,)\n","\n","(934, 1400) (934, 50) (934, 50) (934,)\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"66b7261a-bd8e-4e53-8ebc-a7a6e23dced9"},"source":["def create_padding_mask(seq):\n","  seq = tf.cast(tf.math.equal(seq, 0), tf.float32)\n","\n","  # アテンション・ロジットにパディングを追加するため\n","  # さらに次元を追加する\n","  return seq[:, tf.newaxis, tf.newaxis, :]\n","\n","def create_look_ahead_mask(size):\n","  mask = 1 - tf.linalg.band_part(tf.ones((size, size)), -1, 0)\n","  return mask  # (seq_len, seq_len)\n","\n","def create_masks(inputs_):\n","  inp, tar = inputs_\n","  # Encoderパディング・マスク\n","  enc_padding_mask = create_padding_mask(inp)\n","\n","  # デコーダーの 2つ目のアテンション・ブロックで使用\n","  # このパディング・マスクはエンコーダーの出力をマスクするのに使用\n","  dec_padding_mask = create_padding_mask(inp)\n","\n","  # デコーダーの 1つ目のアテンション・ブロックで使用\n","  # デコーダーが受け取った入力のパディングと将来のトークンをマスクするのに使用\n","  look_ahead_mask = create_look_ahead_mask(tf.shape(tar)[1])\n","  dec_target_padding_mask = create_padding_mask(tar)\n","  combined_mask = tf.maximum(dec_target_padding_mask, look_ahead_mask)\n","\n","  return enc_padding_mask, combined_mask, dec_padding_mask"],"id":"66b7261a-bd8e-4e53-8ebc-a7a6e23dced9","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ICCwQ4RvYr42","executionInfo":{"status":"ok","timestamp":1629854659495,"user_tz":-540,"elapsed":404,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"387cc4a2-5e58-4460-803f-cf673b2941f4"},"source":["a, b, c = create_masks([train_content[:64, :], train_title_enc[:64, :]])\n","a.shape, b.shape, c.shape"],"id":"ICCwQ4RvYr42","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["(TensorShape([64, 1, 1, 1400]),\n"," TensorShape([64, 1, 50, 50]),\n"," TensorShape([64, 1, 1, 1400]))"]},"metadata":{},"execution_count":37}]},{"cell_type":"code","metadata":{"id":"X2Xq4T9CakHe"},"source":["def scaled_dot_product_attention(q, k, v, mask):\n","  matmul_qk = tf.matmul(q, k, transpose_b=True)  # (..., seq_len_q, seq_len_k)\n","\n","  # matmul_qkをスケール\n","  dk = tf.cast(tf.shape(k)[-1], tf.float32)\n","  scaled_attention_logits = matmul_qk / tf.math.sqrt(dk)\n","\n","  # マスクをスケール済みテンソルに加算\n","  if mask is not None:\n","    scaled_attention_logits += (mask * -1e9)  \n","\n","  # softmax は最後の軸(seq_len_k)について\n","  # 合計が1となるように正規化\n","  attention_weights = tf.nn.softmax(scaled_attention_logits, axis=-1)  # (..., seq_len_q, seq_len_k)\n","\n","  output = tf.matmul(attention_weights, v)  # (..., seq_len_q, depth_v)\n","\n","  return output"],"id":"X2Xq4T9CakHe","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"iLs4KO2oaoK7"},"source":["class MultiHeadAttention(layers.Layer):\n","  def __init__(self, d_model, num_heads):\n","    super(MultiHeadAttention, self).__init__()\n","    self.num_heads = num_heads\n","    self.d_model = d_model\n","\n","    assert d_model % self.num_heads == 0\n","\n","    self.depth = d_model // self.num_heads\n","\n","    self.wq = layers.Dense(d_model)\n","    self.wk = layers.Dense(d_model)\n","    self.wv = layers.Dense(d_model)\n","\n","    self.dense = layers.Dense(d_model)\n","\n","  def split_heads(self, x, batch_size):\n","    \"\"\"最後の次元を(num_heads, depth)に分割。\n","    結果をshapeが(batch_size, num_heads, seq_len, depth)となるようにリシェイプする。\n","    \"\"\"\n","    x = tf.reshape(x, (batch_size, -1, self.num_heads, self.depth))\n","    return tf.transpose(x, perm=[0, 2, 1, 3])\n","\n","  def call(self, v, k, q, mask):\n","    batch_size = tf.shape(q)[0]\n","\n","    q = self.wq(q)  # (batch_size, seq_len, d_model)\n","    k = self.wk(k)  # (batch_size, seq_len, d_model)\n","    v = self.wv(v)  # (batch_size, seq_len, d_model)\n","\n","    q = self.split_heads(q, batch_size)  # (batch_size, num_heads, seq_len_q, depth)\n","    k = self.split_heads(k, batch_size)  # (batch_size, num_heads, seq_len_k, depth)\n","    v = self.split_heads(v, batch_size)  # (batch_size, num_heads, seq_len_v, depth)\n","\n","    # scaled_attention.shape == (batch_size, num_heads, seq_len_q, depth)\n","    # attention_weights.shape == (batch_size, num_heads, seq_len_q, seq_len_k)\n","    scaled_attention = scaled_dot_product_attention(\n","        q, k, v, mask)\n","\n","    scaled_attention = tf.transpose(scaled_attention, perm=[0, 2, 1, 3])  # (batch_size, seq_len_q, num_heads, depth)\n","\n","    concat_attention = tf.reshape(scaled_attention, \n","                                  (batch_size, -1, self.d_model))  # (batch_size, seq_len_q, d_model)\n","\n","    output = self.dense(concat_attention)  # (batch_size, seq_len_q, d_model)\n","\n","    return output"],"id":"iLs4KO2oaoK7","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"OvPsDSW6apER"},"source":["def point_wise_feed_forward_network(d_model, dff):\n","  return tf.keras.Sequential([\n","      layers.Dense(dff, activation='relu'),  # (batch_size, seq_len, dff)\n","      layers.Dense(d_model)  # (batch_size, seq_len, d_model)\n","  ])"],"id":"OvPsDSW6apER","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"gbiphbAUZw65"},"source":["class EncoderLayer(layers.Layer):\n","  def __init__(self, d_model, num_heads, dff, rate=0.1):\n","    super(EncoderLayer, self).__init__()\n","\n","    self.mha = MultiHeadAttention(d_model, num_heads)\n","    self.ffn = point_wise_feed_forward_network(d_model, dff)\n","\n","    self.layernorm1 = layers.LayerNormalization(epsilon=1e-6)\n","    self.layernorm2 = layers.LayerNormalization(epsilon=1e-6)\n","\n","    self.dropout1 = layers.Dropout(rate)\n","    self.dropout2 = layers.Dropout(rate)\n","\n","  def call(self, x, mask):\n","\n","    attn_output = self.mha(x, x, x, mask)  # (batch_size, input_seq_len, d_model)\n","    attn_output = self.dropout1(attn_output)\n","    out1 = self.layernorm1(x + attn_output)  # (batch_size, input_seq_len, d_model)\n","\n","    ffn_output = self.ffn(out1)  # (batch_size, input_seq_len, d_model)\n","    ffn_output = self.dropout2(ffn_output)\n","    out2 = self.layernorm2(out1 + ffn_output)  # (batch_size, input_seq_len, d_model)\n","\n","    return out2"],"id":"gbiphbAUZw65","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"llWf0jEVZ2xo"},"source":["class DecoderLayer(layers.Layer):\n","  def __init__(self, d_model, num_heads, dff, rate=0.1):\n","    super(DecoderLayer, self).__init__()\n","\n","    self.mha1 = MultiHeadAttention(d_model, num_heads)\n","    self.mha2 = MultiHeadAttention(d_model, num_heads)\n","\n","    self.ffn = point_wise_feed_forward_network(d_model, dff)\n","\n","    self.layernorm1 = layers.LayerNormalization(epsilon=1e-6)\n","    self.layernorm2 = layers.LayerNormalization(epsilon=1e-6)\n","    self.layernorm3 = layers.LayerNormalization(epsilon=1e-6)\n","\n","    self.dropout1 = layers.Dropout(rate)\n","    self.dropout2 = layers.Dropout(rate)\n","    self.dropout3 = layers.Dropout(rate)\n","\n","\n","  def call(self, x, enc_output, look_ahead_mask, padding_mask):\n","    # enc_output.shape == (batch_size, input_seq_len, d_model)\n","\n","    attn1 = self.mha1(x, x, x, look_ahead_mask)  # (batch_size, target_seq_len, d_model)\n","    attn1 = self.dropout1(attn1)\n","    out1 = self.layernorm1(attn1 + x)\n","\n","    attn2 = self.mha2(\n","        enc_output, enc_output, out1, padding_mask)  # (batch_size, target_seq_len, d_model)\n","    attn2 = self.dropout2(attn2)\n","    out2 = self.layernorm2(attn2 + out1)  # (batch_size, target_seq_len, d_model)\n","\n","    ffn_output = self.ffn(out2)  # (batch_size, target_seq_len, d_model)\n","    ffn_output = self.dropout3(ffn_output)\n","    out3 = self.layernorm3(ffn_output + out2)  # (batch_size, target_seq_len, d_model)\n","\n","    return out3"],"id":"llWf0jEVZ2xo","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"W1ykovGZJK9_"},"source":["class PositionalEncoding(layers.Layer):\n","  def __init__(self, d_model, input_vocab_size):\n","    super(PositionalEncoding, self).__init__()\n","    self.d_model = d_model\n","    self.pos_encoding = self.positional_encoding(ENC_SEQ_LEN, d_model)\n","    self.embedding = layers.Embedding(input_vocab_size, d_model)\n","    self.dropout = layers.Dropout(0.2)\n","\n","  def call(self, x):\n","    seq_len = tf.shape(x)[1]\n","    x = self.embedding(x)\n","    x *= tf.math.sqrt(tf.cast(self.d_model, tf.float32))\n","    x += self.pos_encoding[:, :seq_len, :]\n","    return self.dropout(x)\n","\n","  def get_angles(self, pos, i, d_model):\n","    angle_rates = 1 / np.power(10000, (2 * (i//2)) / np.float32(d_model))\n","    return pos * angle_rates\n","\n","  def positional_encoding(self, position, d_model):\n","    angle_rads = self.get_angles(np.arange(position)[:, np.newaxis],\n","                            np.arange(d_model)[np.newaxis, :],\n","                            d_model)\n","\n","    # 配列中の偶数インデックスにはsinを適用; 2i\n","    angle_rads[:, 0::2] = np.sin(angle_rads[:, 0::2])\n","\n","    # 配列中の奇数インデックスにはcosを適用; 2i+1\n","    angle_rads[:, 1::2] = np.cos(angle_rads[:, 1::2])\n","\n","    pos_encoding = angle_rads[np.newaxis, ...]\n","\n","    return tf.cast(pos_encoding, dtype=tf.float32) "],"id":"W1ykovGZJK9_","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"7eSY4dwKZnAU"},"source":["class Encoder(keras.Model):\n","  def __init__(self, num_layers, d_model, num_heads, dff, input_vocab_size, category_size, rate=0.1):\n","    super(Encoder, self).__init__()\n","\n","    self.d_model = d_model\n","    self.num_layers = num_layers\n","\n","    self.enc_layers = [EncoderLayer(d_model, num_heads, dff, rate) \n","                       for _ in range(num_layers)]\n","    \n","    self.gmp = layers.GlobalAveragePooling1D()\n","    self.classification_ffn = tf.keras.Sequential(\n","        [layers.Dense(self.d_model*2, activation=\"relu\"), layers.Dropout(0.5), layers.Dense(category_size)])\n","\n","  def call(self, x, mask):\n","    for i in range(self.num_layers):\n","      x = self.enc_layers[i](x, mask)\n","    \n","    gmp_x = self.gmp(x)\n","    x1 = self.classification_ffn(gmp_x)\n","    return x, x1# (batch_size, input_seq_len, d_model), (batch_size, class_num)"],"id":"7eSY4dwKZnAU","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"2x0dP81NZ7ZA"},"source":["class Decoder(keras.Model):\n","  def __init__(self, num_layers, d_model, num_heads, dff, target_vocab_size, rate=0.1):\n","    super(Decoder, self).__init__()\n","\n","    self.d_model = d_model\n","    self.num_layers = num_layers\n","\n","    self.dec_layers = [DecoderLayer(d_model, num_heads, dff, rate) \n","                       for _ in range(num_layers)]\n","    self.final_layer = tf.keras.Sequential(\n","        [layers.Dropout(rate), layers.Dense(target_vocab_size)])\n","\n","  def call(self, x, enc_output,look_ahead_mask, padding_mask):\n","    for i in range(self.num_layers):\n","      x = self.dec_layers[i](x, enc_output, look_ahead_mask, padding_mask)\n","\n","    # x.shape == (batch_size, target_seq_len, d_model)\n","    x = self.final_layer(x)\n","    return x"],"id":"2x0dP81NZ7ZA","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"JQkVQipDvAO-"},"source":["VOCAB_SIZE = len(keras_tokenizer.word_index)\n","D_MODEL = 200\n","DDF = D_MODEL * 2\n","NUM_LAYERS = 2\n","NUM_HEADS = 4\n","# inputs\n","encoder_inputs = keras.Input(shape=(ENC_SEQ_LEN,), dtype=\"int32\", name=\"encoder_inputs\")\n","decoder_inputs = keras.Input(shape=(DEC_SEQ_LEN,), dtype=\"int32\", name=\"decoder_inputs\")\n","enc_padding_mask, combined_mask, dec_padding_mask = layers.Lambda(create_masks)([encoder_inputs, decoder_inputs])\n","# model\n","pos_emb = PositionalEncoding(d_model=D_MODEL, input_vocab_size=VOCAB_SIZE)\n","tf_encoder = Encoder(\n","    num_layers=NUM_LAYERS, d_model=D_MODEL, num_heads=NUM_HEADS, dff=DDF,\n","    input_vocab_size=VOCAB_SIZE, category_size=len(le.classes_), rate=0.2)\n","tf_decoder = Decoder(NUM_LAYERS, D_MODEL, NUM_HEADS, DDF, VOCAB_SIZE, rate=0.1)\n","# feed_foward\n","enc_output, enc_output_cls = tf_encoder(pos_emb(encoder_inputs), enc_padding_mask)\n","dec_output = tf_decoder(pos_emb(decoder_inputs), enc_output, combined_mask, dec_padding_mask)\n","# global model\n","trainer = keras.Model([encoder_inputs, decoder_inputs], [dec_output, enc_output_cls], name=\"s2s\")\n"],"id":"JQkVQipDvAO-","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"jkc1GRvD5mPt"},"source":["dddddd"],"id":"jkc1GRvD5mPt","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"mgSjcoi81nyf","executionInfo":{"status":"ok","timestamp":1629785315400,"user_tz":-540,"elapsed":3,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"bc60d4cb-f194-45b9-f935-f8e01a05e1c3"},"source":["tf_encoder.summary()"],"id":"mgSjcoi81nyf","execution_count":null,"outputs":[{"output_type":"stream","text":["Model: \"encoder_7\"\n","_________________________________________________________________\n","Layer (type)                 Output Shape              Param #   \n","=================================================================\n","encoder_layer_13 (EncoderLay multiple                  322200    \n","_________________________________________________________________\n","encoder_layer_14 (EncoderLay multiple                  322200    \n","_________________________________________________________________\n","global_average_pooling1d_6 ( multiple                  0         \n","_________________________________________________________________\n","sequential_38 (Sequential)   (None, 11)                84811     \n","=================================================================\n","Total params: 729,211\n","Trainable params: 729,211\n","Non-trainable params: 0\n","_________________________________________________________________\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"tFlr_tdb382q","executionInfo":{"status":"ok","timestamp":1629785315400,"user_tz":-540,"elapsed":2,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"0c07886e-33cb-4d0c-ce89-c6a5a2e18f2c"},"source":["tf_decoder.summary()"],"id":"tFlr_tdb382q","execution_count":null,"outputs":[{"output_type":"stream","text":["Model: \"decoder_6\"\n","_________________________________________________________________\n","Layer (type)                 Output Shape              Param #   \n","=================================================================\n","decoder_layer_12 (DecoderLay multiple                  483400    \n","_________________________________________________________________\n","decoder_layer_13 (DecoderLay multiple                  483400    \n","_________________________________________________________________\n","sequential_41 (Sequential)   (None, 50, 29007)         5830407   \n","=================================================================\n","Total params: 6,797,207\n","Trainable params: 6,797,207\n","Non-trainable params: 0\n","_________________________________________________________________\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"p7CHqJJx4ZkD","executionInfo":{"status":"ok","timestamp":1629785315739,"user_tz":-540,"elapsed":2,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"200fa3a2-462e-47d5-ef23-c24c003ab8f5"},"source":["trainer.summary()"],"id":"p7CHqJJx4ZkD","execution_count":null,"outputs":[{"output_type":"stream","text":["Model: \"s2s\"\n","__________________________________________________________________________________________________\n","Layer (type)                    Output Shape         Param #     Connected to                     \n","==================================================================================================\n","decoder_inputs (InputLayer)     [(None, 50)]         0                                            \n","__________________________________________________________________________________________________\n","encoder_inputs (InputLayer)     [(None, 1400)]       0                                            \n","__________________________________________________________________________________________________\n","positional_encoding_7 (Position multiple             5801400     encoder_inputs[0][0]             \n","                                                                 decoder_inputs[0][0]             \n","__________________________________________________________________________________________________\n","lambda_7 (Lambda)               ((None, 1, 1, 1400), 0           encoder_inputs[0][0]             \n","                                                                 decoder_inputs[0][0]             \n","__________________________________________________________________________________________________\n","encoder_7 (Encoder)             ((None, 1400, 200),  729211      positional_encoding_7[0][0]      \n","                                                                 lambda_7[0][0]                   \n","__________________________________________________________________________________________________\n","decoder_6 (Decoder)             (None, 50, 29007)    6797207     positional_encoding_7[1][0]      \n","                                                                 encoder_7[0][0]                  \n","                                                                 lambda_7[0][1]                   \n","                                                                 lambda_7[0][2]                   \n","==================================================================================================\n","Total params: 13,327,818\n","Trainable params: 13,327,818\n","Non-trainable params: 0\n","__________________________________________________________________________________________________\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"r_yIBasOf3Ns"},"source":["def word_loss(real, pred):\n","  mask = tf.math.logical_not(tf.math.equal(real, 0))\n","  # reductionはlossをsumせずに個々に保持すること\n","  loss_object = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True, reduction='none')\n","  loss_ = loss_object(real, pred)\n","\n","  mask = tf.cast(mask, dtype=loss_.dtype)\n","  loss_ *= mask\n","\n","  return tf.reduce_mean(loss_)"],"id":"r_yIBasOf3Ns","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"FCj_uEPrq8xm","executionInfo":{"status":"ok","timestamp":1629785318788,"user_tz":-540,"elapsed":223,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"7fec33df-15e4-45f5-ae0e-326108b30247"},"source":["enumerate"],"id":"FCj_uEPrq8xm","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["enumerate"]},"metadata":{},"execution_count":125}]},{"cell_type":"code","metadata":{"id":"LBXNK6--T_t9"},"source":["class GenerateTitleCallback(keras.callbacks.Callback):\n","  def __init__(self, x_val, y_val):\n","    self.x_val = x_val\n","    self.y_val = y_val\n","\n","  def on_epoch_end(self, epoch, logs=None):\n","    # バリデーションデータの中からランダムで見出しを生成する\n","    sampling_idx = np.random.randint(0, self.x_val.shape[0])\n","    sample_enc_inp = self.x_val[sampling_idx-1:sampling_idx, :]\n","    decoder_sentence = \"[BOS]\"\n","    for i in range(50):\n","      decoder_sentence_ = keras_tokenizer.texts_to_sequences([decoder_sentence])\n","      decoder_sentence_ = pp.sequence.pad_sequences(decoder_sentence_, maxlen=DEC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","      pred, category_pred = trainer((sample_enc_inp, decoder_sentence_))\n","      sampled_tkn_idx = np.argmax(pred[0,i,:])\n","      sampled_tkn = keras_tokenizer.index_word[sampled_tkn_idx]\n","      decoder_sentence =  decoder_sentence + \" \" + sampled_tkn\n","      if sampled_tkn == \"[EOS]\":\n","        break\n","    category_label = le.classes_[np.argmax(category_pred[0])]\n","    pred_title = \"\".join(re.sub(\"#\", \"\", decoder_sentence).split(\" \")[1:-1])\n","    raw_content = re.sub(\"#\", \"\", \"\".join([keras_tokenizer.index_word[idx] for idx in sample_enc_inp[0]]))\n","    print(raw_content)\n","    print(\"↓\")\n","    print(category_label)\n","    print(\"↓\")\n","    print(pred_title)\n","\n","call_backs = GenerateTitleCallback(val_content, val_title_enc)"],"id":"LBXNK6--T_t9","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"gDOO988afEVS"},"source":["trainer.compile(\n","    \"adam\",\n","    loss=[word_loss, losses.SparseCategoricalCrossentropy(from_logits=True)],\n","    metrics=[[metrics.SparseCategoricalAccuracy(name='word_acc')], [metrics.SparseCategoricalAccuracy(name=\"category_acc\")]],\n","    loss_weights=[9, 1]\n","    )"],"id":"gDOO988afEVS","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"qHWU6u9kjiUt","executionInfo":{"status":"ok","timestamp":1629785330616,"user_tz":-540,"elapsed":220,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"165491b2-2c8f-47ae-a3b5-6d5722fb66f9"},"source":["VOCAB_SIZE"],"id":"qHWU6u9kjiUt","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["29007"]},"metadata":{},"execution_count":128}]},{"cell_type":"code","metadata":{"id":"1c27758a-8d00-4c0a-83fd-9fbe748177b4","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1629801374868,"user_tz":-540,"elapsed":3801447,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"2f5cc32f-eadb-4239-96e8-598f5784a064"},"source":["trainer.fit(\n","    x=(train_content, train_title_enc), y=(train_title_dec, train_category), \n","    validation_data=((val_content, val_title_enc), (val_title_dec, val_category)),\n","    batch_size=64, epochs=20,\n","    callbacks=[call_backs]\n","    )"],"id":"1c27758a-8d00-4c0a-83fd-9fbe748177b4","execution_count":null,"outputs":[{"output_type":"stream","text":["Epoch 1/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.9717 - decoder_6_loss: 0.4396 - encoder_7_loss: 0.0152 - decoder_6_word_acc: 0.3683 - encoder_7_category_acc: 0.9953 - val_loss: 36.9453 - val_decoder_6_loss: 3.9267 - val_encoder_7_loss: 1.6048 - val_decoder_6_word_acc: 0.1383 - val_encoder_7_category_acc: 0.8191\n","StrayKidsがニューアルバム「NOEASY」の収録曲「好きでごめん」の予告映像で感性溢れる魅力を披露した。本日、公式SNSにを通じて「StrayKids<NOEASY>UNVEIL:TRACK6“好きでごめん\"」が掲載された。カムバックを控えて、ニューアルバムの収録曲の一部を紹介するシグネチャーティージングコンテンツ「UNVEIL:TRACK」の映像第6弾であり、メンバーたちの声色が強調されて関心を集めた。スタンドマイクの前に立ったメンバーたちは「好きなのが罪になるならとても好きでごめん/表に出さないように努力しても全部見えてごめん」のような現実感のある初々しい心を描いた歌詞を淡々と歌った。ライブの雰囲気を活かし、感性溢れるラップとボーカルの魅力を高めた。世界中のファンが彼らの多彩な魅力に熱い反応を見せた。2ndフルアルバム「NOEASY」は、壮大なメロディーに伝統国楽の華やかで多彩な音を加えたタイトル曲「ソリクン」から叙情的な雰囲気の収録曲まで幅広いジャンルが盛り込まれ、聴く楽しさを高めている。グループのプロデュースユニット“3RACHA\"のバンチャン、チャンビン、ハンを筆頭に、メンバー全員が新譜のクレジットに名を連ねた。他にもVERSACHOI、KrystaYoungs、HotSauce、ホン・ジサンなど、韓国国内外の有数のアーティストが意気投合した。今年6月にMnet「KINGDOM:LEGENDARYWAR」で最終優勝を果たしたStrayKidsは、優勝の恩恵として今月17〜23日の1週間に渡って「KINGDOMWEEK」を開催する。「KINGDOMWEEK:<NO+>」第1回は午後5時30分に放送され、トークショー、リアルバラエティ、カムバックショーなど多彩なコンテンツを順次披露する予定だ。2ndフルアルバム「NOEASY」とタイトル曲「ソリクン」は、今月23日の午後6時に公開される。\n","↓\n","芸能\n","↓\n","StrayKids、2ndフルアルバム「NOEASY」個人予告イメージ第2弾を公開...圧倒的なエネルギーに注目\n","Epoch 2/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.9305 - decoder_6_loss: 0.4345 - encoder_7_loss: 0.0196 - decoder_6_word_acc: 0.3691 - encoder_7_category_acc: 0.9937 - val_loss: 37.1239 - val_decoder_6_loss: 3.9456 - val_encoder_7_loss: 1.6135 - val_decoder_6_word_acc: 0.1390 - val_encoder_7_category_acc: 0.8105\n","【紀州のドン・ファンと元妻最期の5カ月の真実】30同志社女子大もミスコン中止...“逆風\"強まるも女子アナ採用戦線は異状なし?野崎幸助さんの妹のHさんは、趣味の登山で滑落して骨折し、杖をつきながら歩いていた。「そりゃあ大変でしたね」「娘からは無理をするなって怒られてね」Hさんの旦那さんはすでに亡くなり、娘さんは嫁いでいた。今は一人暮らしで、自由を謳歌しているという。テーブルを囲んで4人いるが、早貴被告が会話に加わることはなかった。どうやらタブレットPCでゲームをしているようだった。失礼な態度だと思ったが、注意をする気にもならない。妹さんを入れてドン・ファンと早貴被告の写真を何枚か撮ったが、今度は早貴被告も「NGなので」とは断らなかった。この時に撮影した写真は「紀州のドン・ファン野望篇」の表紙を飾っている。妹さんの部分はトリミングをして消し、早貴被告の顔にボカシを入れた。「キミはどこの出身なの?」以前にドン・ファンから聞いていたが、知らないフリをした。「札幌で〜す」「なんだ、一緒じゃないか」「そうだったんですか?」「うん。ボクは南高校だから」「へえ、頭がいいんですね」札幌南高校が進学校であることは、卒業生の友人がいるから知っているだけだ。私の本当の出身校ではない。「ごめん、ウソをつきました。ボクは社長と一緒で中卒ですから。でも最終学歴は○○自動車教習所だけど」「ワシもや!」手を叩きながらドン・ファンが喜んだ。「狸小路で遊んでいたんですよ。30年ぐらい前に叔父があそこでビジネスホテルを経営していたから」「あそこにビジネスホテルがあったんですか?」これで早貴被告が本当に札幌の出身であることが分かった。南高校の件もあるし、観光客があまり訪れない狸小路のことを知っているというので、まず間違いがないだろうと思った。ススキノに近いため、最近は狸小路にもビジネスホテルが増えたが、この手のホテルはそこを目指さなければ気づかないものだ。取材をするときに私はこのようにして相手が本当のことを言っているのか確かめるようにするクセが身についていた。「キミはどこに住んでいるんだっけ」「新宿区です」「へえ、新宿のどこら辺?」以前にドン・ファンから聞いていたが、これまた知らないフリをした。「抜弁天の辺りです」抜弁天は新宿区内の山手線の内側にあり、歌舞伎町まで徒歩15分程度の場所だ。今から10年ほど前は交通の便が悪かったが、瞬く間に地下鉄の駅ができたり、道路も新しくできたりして、すっかり便利になった。それだけに家賃は安くないと思った。\n","↓\n","ライフ総合\n","↓\n","「シューズのすけっと、『好き』で勝つ出現。夏の風物「シューズの裏」\n","Epoch 3/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.8725 - decoder_6_loss: 0.4284 - encoder_7_loss: 0.0168 - decoder_6_word_acc: 0.3710 - encoder_7_category_acc: 0.9945 - val_loss: 37.2934 - val_decoder_6_loss: 3.9523 - val_encoder_7_loss: 1.7230 - val_decoder_6_word_acc: 0.1387 - val_encoder_7_category_acc: 0.8169\n","とてもエースとは思えない投球だった。最速150台後半の速球は140km台そこそこ。得意のスライダーには、まったくキレがない――。7月1日の広島戦に先発した巨人のエース菅野智之は、ストレートを西川龍馬と鈴木誠也にあっさり本塁打される。2回3分の2を投げ4失点。わずか32球でマウンドを降りた。前回6月13日のロッテ戦に続き、プロ入り9年目で初めて2戦連続3回持たずのノックアウトである。翌日には2軍での再調整が決定。今季、すでに4度目の出場選手登録抹消となった。「あきらかに投球フォームがおかしい。下半身がうまく使えておらず、上半身の力に頼った印象を受けます。手投げで、ボールに全身の力が伝わっていないため迫力がない。以前はマウンド上で『打てるものなら打ってみろ』と、打者を見下ろすような雰囲気がただよっていました。今は違います。『大丈夫かな』と、どこか弱気な表情です。体調の悪さは、周囲が思っているより深刻なのでしょう。原辰徳監督は、長期の離脱を示唆しています。『間はあけとくということは、果たして......。奇跡的に非常にコンディションが上がれば、そのことはないとは言えないね。本人が首をひねる状態なのは間違いないでしょう』と」心配な「悪循環」不調の原因はなんなのだろう。高校時代から菅野を見てきた、日本人初のメジャースカウト大慈弥功氏が解説する。「要因はいくつかあります。まずオフの休養や調整が、思うようにできなかったこと。昨季は新型コロナウイルスの影響で日本シリーズが11月下旬にズレ込んだうえ、菅野はメジャー挑戦を表明し渡米しました。例年ならハワイで3週間ほど自主トレを行い、キャンプで人一倍投げ込むところ、コンディション調整がほとんどできなったんです。いきなりシーズンを迎えたのは、菅野にとってマイナスだったでしょう。それ以上に心配なのが、以前痛めた腰です。昨季は上体をひねるような投げ方をしていましたが、今季は元に戻しました。腰の負担を気にしているのかもしれません。19年には満足に練習できないほど腰を痛め、通常1~2点だった防御率が3点台に落ちています。練習不足が響いたのか、同時に身体もボタつくようになった。体重が増えたため、さらに腰への負担が増すという悪循環にあるのかもしれません」菅野は昨オフにポスティングシステムを利用しメジャーに挑戦したが、結局、巨人に残留した。獲得に名乗りを上げる球団はあったが、複数年契約など条件面で合意にいたらなかったという。今オフは海外FA権を取得して、再びメジャーに挑むとみられる。だが、状況はかなり厳しい。前出の大慈弥氏が続ける。「メジャーのメディカルチェックの厳しさは、日本の比ではありません。今季4度の登録抹消となれば、状況は相当悪い。たとえ体調が万全になり今年中に復帰できても、菅野の希望する条件を提示する球団はまずないでしょう。ましてや菅野は、今年で32歳になります。30代半ばになろうとする選手に、メジャー球団が複数年契約を提示するとは考えられません」メジャーのマウンドに立つという夢の実現は、遠のいてしまった......。残された道はしっかり休養し、巨人のエースとして復活を期すことだろう。日本のファンは、菅野のふてぶてしいほどの投球を待っている。\n","↓\n","スポーツ\n","↓\n","阪神、連敗止め再び貯金20歳に「審判のゴール」の首位人生を支える扇の要かつてのやった理由\n","Epoch 4/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.8553 - decoder_6_loss: 0.4265 - encoder_7_loss: 0.0167 - decoder_6_word_acc: 0.3719 - encoder_7_category_acc: 0.9948 - val_loss: 37.6643 - val_decoder_6_loss: 3.9811 - val_encoder_7_loss: 1.8345 - val_decoder_6_word_acc: 0.1397 - val_encoder_7_category_acc: 0.7998\n","2021年5月、無印良品の冷凍食品の新製品『フライパンで作るミールキット』が発売されました。【生協】ワーママがガチでおすすめ!“超・時短\"なコープ食品【お弁当にも!】ミールキットとは、仕上げの調理のみで食べられる、具材やソースなどがすべてセットされた料理キットのこと。『フライパンで作るミールキット』はすべて一袋あたり一人前の量になっていて、魚介と野菜もしくは肉と野菜がセットで、350円で販売されています。名前の通り、フライパンで約10分以内で作れるようになっているため、とっても手軽です。数種類ある中、今回は5種類を実食レビューします!無印良品の『フライパンで作るミールキット』実食レビュー『たことブロッコリーのアヒージョ』ぶつ切りにしたたこ、大きめにカットされたブロッコリーと揚げじゃがいもが入った『たことブロッコリーのアヒージョ』は、一袋あたり84kcalで、ダイエット中にもおすすめの一品。油と添付のソースを入れて混ぜ合わせ、中火にかけて温まったら具材を入れるだけ。しばし煮込むだけで、あっという間に作れます。たこは加熱する分小さくなってしまうため、ボリュームは減ってしまいますが、約65gの量がある野菜が、ボリュームダウンをしっかりカバーしてくれています。ソースはそこまでにんにくが強くないため、気軽に食べられます。『白身魚のアクアパッツァ』白身魚のメヌケの切り身1枚と、色とりどりのグリル野菜などが入った『白身魚のアクアパッツァ』は、一袋あたり104kcalとこちらも低カロリー。ヘルシー志向の方にもおすすめの一品です。白身魚を両面焼いた後、グリル野菜のズッキーニや赤ピーマン、黄ピーマンなど他の具材を全部入れてさらに炒め、最後にソースを入れるだけ。難易度が高そうなアクアパッツァが、めちゃくちゃ手軽に作れます。あさりが入っているため、魚介のダシがしっかりと効いていて美味。野菜にもソースの味が染みているため、苦みのある野菜もマイルドになっています。皮ごと食べられる白身魚は、予め骨が取り除いてあるため、子どもも安心して食べられますよ。『鶏肉とカリフラワーのレモン煮』大きめにカットされたカリフラワー、プチトマト、レモン、そして蒸し鶏が入った『鶏肉とカリフラワーのレモン煮』は、一袋当たり146kcalとこちらも低カロリー。鶏肉とカリフラワーを炒めたら、ソースとプチトマト、レモンを入れて蒸し焼きにしたら出来上がり!鶏肉のジューシーさはしっかりと残したまま、レモンやプチトマトの酸味が効いているため、後味さっぱり。油っこくないので、一皿あっという間に食べられます。『鶏肉の煮込みデミグラスソース』蒸し鶏、玉ねぎ、大きめにカットされたじゃがいも、ブロッコリーが入った『鶏肉の煮込みデミグラスソース』は、一袋あたり176kcal。鶏肉を炒めた後に残りの具材を入れて蒸し焼きに。仕上げにソースと水を加えてしばし煮込んだら完成です。今回ご紹介する中では、最も食べ応えがあるメニュー。コクのあるデミグラスソースが絡まった鶏肉、腹持ちのいいじゃがいものおかげか、ボリュームがしっかりあります。これなら、育ち盛りの子どもも、物足りなさを感じることがないですよ。『豚肉と野菜のガーリックソース炒め』薄切りの豚肉、大きめにカットされたブロッコリー、ピーマン、そしてヤングコーンがまるごと2本入った『豚肉と野菜のガーリックソース炒め』は、一袋あたり163kcal。野菜を炒めて蒸し焼きにしたら、お肉を入れて軽く炒めてソースを加えるだけ。10分もかかりません。味は濃すぎず、こしょうとニンニクが効いていて、万人受けする味。白飯にぴったりです。ちなみにこのメニュー、野菜だけで100gの量があるんです。そのため、薄切り肉なのに、ボリュームが意外にあります。野菜を沢山食べたいときにもおすすめです。*無印良品の『フライパンで作るミールキット』シリーズ。ぜひ食べてみてください。\n","↓\n","グルメ\n","↓\n","【無印良品】スパイスの刺激的な味わいのチーズスナック菓子店『チーズと旨辛い\n","Epoch 5/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.8338 - decoder_6_loss: 0.4240 - encoder_7_loss: 0.0179 - decoder_6_word_acc: 0.3723 - encoder_7_category_acc: 0.9946 - val_loss: 37.7287 - val_decoder_6_loss: 3.9803 - val_encoder_7_loss: 1.9057 - val_decoder_6_word_acc: 0.1389 - val_encoder_7_category_acc: 0.8094\n","南米ペルーで確認された新型コロナのラムダ株が米国で拡大している。CNNは鳥インフルエンザ情報共有の国際推進機構を引用し、現在まで米国で1060件のラムダ株感染事例が確認されていると8日報じた。先月19日にテキサス州で初めて報告されてから3週間でだ。ラムダ株の伝播力がどの程度かは明らかでないが、英国で昨年広がったアルファ株やインド由来のデルタ株のように従来の新型コロナウイルスより拡大しやすいと推定される。懸念されるのはラムダ株で観察されたワクチン回避能力だ。ワクチンを無力化するほどではないが、一部耐性を持つという研究結果が出ている。世界保健機関はラムダ株を「注目すべき変異株」に指定している。「懸念される変移株」に指定されたアルファ株・ベータ株・ガンマ株・デルタ株より一つ下だ。まだ危険性が正確に確認されていない。ラムダ株は米国など29カ国で報告されている。米国ではデルタ株が絶対的優勢株として定着し、「米国で変異株同士の闘いは終わった。デルタ株が勝った」という評価があった。デルタ株が米国に上陸してから3カ月間で他の変移株を追い出して新規感染者の93.4%を占めたからだ。中国武漢ウイルス研究所の石正麗所長はサウスチャイナモーニングポストのインタビューで「感染者数が増え、ウイルスが突然変異を起こす選択の機会がさらに多くなっている」とし「コロナは終わらないはずで、共に暮らす方法を選ぶ必要がある」と述べた。\n","↓\n","海外\n","↓\n","韓国、デルタ株の感染拡大でのため従業員死亡、デルタ株用と感染拡大\n","Epoch 6/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.7709 - decoder_6_loss: 0.4169 - encoder_7_loss: 0.0184 - decoder_6_word_acc: 0.3741 - encoder_7_category_acc: 0.9946 - val_loss: 37.8860 - val_decoder_6_loss: 3.9997 - val_encoder_7_loss: 1.8883 - val_decoder_6_word_acc: 0.1396 - val_encoder_7_category_acc: 0.8116\n","ファミリーレストラン「ココス」では、2021年6月11日から「アジアンスイーツフェア」が開催中です。インスタ映え抜群の台湾風かき氷や韓国風かき氷をはじめ、台湾の伝統的なヘルシースイーツ「豆花」などが楽しめます。マンゴーとあずきが主役!ココスの夏の定番「純氷のかき氷」が、アジアンスイーツとなって登場します。マンゴーづくしの台湾風かき氷「コットンキャンディのマンゴーかき氷~ヒミツのマンゴープリン~」、韓国語で\"あずきのかき氷\"を意味する「黒糖きな粉パッピンス」の2種です。価格は各759円。かき氷に染み込ませたミルクシロップが、それぞれの味わいをより引き立たせます。マンゴーのかき氷は、台湾スイーツの王道。別添えのマンゴーシロップをかけると、わたあめの中から滑らかな舌触りのマンゴープリンが姿を現します。マンゴーシロップとマンゴープリンには、糖度が高くマンゴーの王様とも呼ばれるアルフォンソマンゴーを使用しています。濃厚で爽やかな甘さが楽しめます。食後のデザートにぴったりなミニサイズもありますよ。韓国風かき氷は、さまざまなトッピングを合わせるのが特徴。今回はゆであずきのほか、[UNK]煎して香りを引き立たせた焦がしきな粉、店舗仕込みのきな粉ホイップ、滑らかな豆花、つるっともちもちのわらび餅、サクサクのチョコクリスピーを合わせました。それぞれの具材を、粟国島産黒糖シロップのコク深い甘味が包み込みます。トッピングてんこ盛りの豆花また、日本でも注目されている台湾スイーツ「豆花」も登場します。プリンのように滑らかな舌触りで甘さ控えめの豆花に、さまざまな具材を贅沢にトッピング。優しい甘さのさつまいも、台湾直輸入の黒糖タピオカのほか、フローズンマンゴー、濃厚な黒ゴマアイス、華やかな香りのジャスミン茶ゼリーを合わせた一品です。価格は429円。豆花を使用したスイーツはもう1品あります。きな粉の香りと味わいを存分に楽しめる「焦がしきな粉パフェ」です。表面にまぶした香ばしい焦がしきな粉に加え、柔らかい口当たりのきな粉ホイップを使用しています。豆花のほかに、しっとりしたさつまいも、つるっともちもちの本わらび粉入りわらび餅、黒ごまアイス、ジャスミン茶ゼリー、チョコクリスピー、ゆであずきを合わせ、さまざまな食感と味わいを楽しめる仕立てです。別添えの黒糖シロップをかけながら楽しんで。いずれも7月中旬ごろまでの提供予定なので、食べ逃がしのないようにしてくださいね。\n","↓\n","グルメ\n","↓\n","【365日アイス女子】大人気スイーツ「バナナマンゴー」も登場!完熟果肉たっぷりの華やか仕上げ\n","Epoch 7/20\n","278/278 [==============================] - 188s 677ms/step - loss: 3.7257 - decoder_6_loss: 0.4120 - encoder_7_loss: 0.0179 - decoder_6_word_acc: 0.3749 - encoder_7_category_acc: 0.9942 - val_loss: 37.7293 - val_decoder_6_loss: 3.9964 - val_encoder_7_loss: 1.7617 - val_decoder_6_word_acc: 0.1390 - val_encoder_7_category_acc: 0.8084\n","「投手1増」のチーム編成...代打や守備固めなど選手起用に影響も東京五輪の野球競技開幕へ向け、仙台市の楽天生命パーク宮城で強化合宿を行なっている侍ジャパン。24日には楽天、25日には巨人を相手に強化試合を行う。気がかりなのは、右脇腹の違和感で別メニュー調整が続くソフトバンク・柳田悠岐外野手の状態。稲葉篤紀監督は、場合によっては強化試合もギータを欠場させ、文字通り“ぶっつけ本番\"で五輪に臨ませる可能性も示唆している。柳田は合宿初日の19日から3日連続でフリー打撃を回避。稲葉監督は「大事を取ってというか、本人は『やれる』と言うけれど、無理をするところではないので、我慢してもらっている」と強調。ただ、必ずしも楽観はできないようだ。合宿3日目には室内練習場でティー打撃を再開したそうで、見守った稲葉監督は「ようやくバットを持てて、すごくうれしそうでした。思ったより振れていた」と評したが、関係者以外立ち入り禁止のエリアで、報道陣に実際の強度はうかがい知れなかった。五輪の初戦となるドミニカ共和国戦が28日に迫っているが、稲葉監督は柳田の起用について極めて慎重だ。24日と25日の強化試合についても「本当にそこに出てもらうことが、いいのかどうなのか」と欠場も視野に入れている。仮に強化試合出場を回避すると、五輪には“ぶっつけ本番\"となるが、指揮官は「彼もランニングがてら、ボールを拾ったり捕ったりして、走っている。走り込みは十分できているので、体のキレはあると思う」と説明。「本人と話しながら慎重に決めていきたい」と言葉を選んだ。センター本職は柳田のみ、鈴木&近藤が練習を始めるも...柳田は押しも押されもせぬ主軸だけに、強化試合を欠場するだけでも、チーム全体に与える影響は小さくない。出場選手の中で、センターを本職としているのは柳田ひとり。他に今季ペナントレースで中堅を守った選手はいない。柳田の別メニュー調整を受けて、広島・鈴木と日本ハム・近藤がセンターの位置でノックを受け始めたが、2人とも経験は浅い。鈴木は昨季、試合途中のシート変更で中堅に回ったケースが2度あった。近藤に至っては、プロ入り後公式戦でセンターを守ったことはないが、実は2019年のWBSCプレミア12開幕前の練習試合でも、稲葉監督の意向で途中から中堅に回ったことがあった。強化試合では代打、代走、守備固めなど、本番を想定して様々な起用を試したいところだが、稲葉監督は「ギータ次第でね。野手が1人減れば、12人しかいなくなるので、なかなか、代打を出して代走を出してとかって、簡単にはできないというか......」とジレンマを抱えている。もともと、代表選手24人の内訳は、2008年北京五輪では投手10人・野手14人だったが、今回は稲葉監督が小刻みな継投を志向していることから、投手を11人に。野手は1減となった経緯があるから、なおさらだ。降って湧いた“ギータ問題\"が、侍ジャパンのアキレス腱とならないためにも、難しい判断が迫られる。\n","↓\n","スポーツ\n","↓\n","侍ジャパンのバトミントンをホログラムで観戦、社会に痛烈皮肉「全然印象で心」\n","Epoch 8/20\n","278/278 [==============================] - 188s 677ms/step - loss: 3.7006 - decoder_6_loss: 0.4095 - encoder_7_loss: 0.0155 - decoder_6_word_acc: 0.3756 - encoder_7_category_acc: 0.9952 - val_loss: 37.7615 - val_decoder_6_loss: 4.0140 - val_encoder_7_loss: 1.6351 - val_decoder_6_word_acc: 0.1386 - val_encoder_7_category_acc: 0.8019\n","「ねこへ深夜にへんなポーズで寝ないでくださいヤバいもんが視えたんかと思って心臓が一瞬止まりました飼い主より」と愛猫、ろんさんへのメッセージと共に2枚の画像をツイッターに投稿した、漫画家のAKRさん。【イラスト】こんな「ヤバいもん」に見えましたよそこに写っていたのは猫...にしては確実に足が1本多く見える妙なポーズの黒猫の姿!しかも、黒くて実態がよくわからない姿を切り取った、AKRさん作画のイラストがさらに恐怖を煽ります。もはや猫なのかすら怪しい猫ちゃんの姿に、「脚が多い...」「そのポーズはめちゃくちゃビビる」「新手の妖怪」と、震えるリプライが殺到しました。「ぎゃー!足が5本に見える[UNK]メンダコの顔が猫になってひっくり返ったみたいなやつ」「メンネコだ」「タランチュラっぽくも見えますね...!」「どこぞの職人がフィギュア化しそうです」ろんさんの変なポーズに震えるリプライだけでなく、「黒猫あるあるですね」という共感の声とともに、いろんな黒猫たちのおもしろ奇妙なポーズ写真も多数寄せられ、リプ欄は多いに盛り上がりました。いったいどんな状況で黒猫のろんさんは変なポーズになっていたのか?飼い主のAKRさんにお話を伺いました。ーー深夜にこの「へんなポーズ」は驚きますね!「これはお風呂に入っている飼い主を爪研ぎソファの上で寝ながら待っていた時の写真なんです。私が近づいたことで目が覚めてしまったようで、目がじわっと開いていて、実際はさらに恐ろしいことになっています」ーーひぃぃっ。この変なポーズのろんさんを抜き描きされたAKRさんのイラストも迫力があります。「写真が暗い部屋で撮ったものなので、ろんの部分が見えづらいかなと思って補足を入れました」ーーろんさんはよくこの爪研ぎソファでくつろいでいるのですか?「ベッドで眠るには暑い時によく使っています。風通しがいいのか、最近のベストお気に入りスポットです」ーー先日、ベッドの上にバスタオルを敷いたら、ろんさんがそこからはみ出さずに寝てくれるようになった漫画を公開されていましたね。「へんなポーズ」撮影後のろんさんは?「この後、\"寝ようよ\"と声をかけたら、ベッドの上の定位置へ移動してくれました」[UNK][UNK]お気に入りの場所に寝そべり、お風呂から上がって来る飼い主さんを変なポーズで待っていた甘えん坊の黒猫、ろんさん。「黒猫って変なところに生えますよね」「うちも黒っぽいせいか、すごく怖い顔になってる時がよくある」というリプライもあったように、ただでさえ液体みたいに変幻自在な猫の身体が、黒い毛並みのせいでさらによくわからない状態になった、驚きのおもしろショット。深夜にこれを目撃するのはさすがに心臓に悪そうですが、大好きな飼い主さんを待ちわびて寝ていた姿だと知ると、たちまち可愛く見えてくるから不思議ですよね。猫好きさんからも絶大な支持を集める、AKRさんのコミックエッセイ『黒猫ろんと暮らしたら』には、黒猫のろんさんと飼い主さんの愛に満ちた楽しい毎日が、おもしろ可愛く描かれています。描き下ろしエピソードも掲載されているので、甘えっ子ろんさんの可愛い姿をもっと知りたい方は、ぜひチェックしてみてくださいね。\n","↓\n","ライフ総合\n","↓\n","[UNK]なニャい...?「いやジャバァ!」の、猫さん「ニャ!」「可愛い」と絶賛の嵐\n","Epoch 9/20\n","278/278 [==============================] - 188s 677ms/step - loss: 3.6646 - decoder_6_loss: 0.4050 - encoder_7_loss: 0.0200 - decoder_6_word_acc: 0.3769 - encoder_7_category_acc: 0.9943 - val_loss: 37.8645 - val_decoder_6_loss: 4.0221 - val_encoder_7_loss: 1.6653 - val_decoder_6_word_acc: 0.1404 - val_encoder_7_category_acc: 0.8019\n","なぜいま芋スイーツ!?ローソン新作「紅芋」は今こそ食べたいひんやり感ローソンにお芋スイーツが登場!2021年5月4日、ローソンから新作スイーツ「徳島産業紅芋沖縄県産使用」が発売されました。沖縄産の紅いもを使い、和三盆を合わせて上品に仕上げたカップスイーツ。これからの暑い季節に向けて、手を汚さずに食べられる気軽なスイーツとして重宝しそうですよ。徳島産業紅芋沖縄県産使用この度、ローソンから新作スイーツ「徳島産業紅芋沖縄県産使用」が発売咲てました。ティラミスバスチーや生バウムクーヘンなどのおしゃれスイーツに紛れて、オレンジと紫を基調とした渋いパッケージが逆に目立っていましたよ。商品名が紅芋○○ではなくただの“紅芋\"なので、パッケージを見ただけではどんなスイーツなのかも想像できません。ローソンブランドではなく、徳島県に本社を持つ徳島産業が製造を手掛けているようです。材料はさつまいも、砂糖、濃縮乳、加糖卵黄、寒天とごくごくシンプル。砂糖はグラニュー糖と和三盆糖の2種類を使っているようですね。袋から出してみると、プラスチックのカップに入った紅芋がお目見え。カップの外からも紫の色合いがとても鮮やかなのがわかりますね。生クリームやソースでデコレーションされている系のスイーツが多いなか、カップに入ったこのタイプは持ち運んでも崩れる心配がないので、アウトドアのおやつとしても重宝しそうです。1個あたりのカロリーは80kcalとやや控えめ。寒天を使っているという点も食物繊維たっぷりでうれしいですよね。しっかりと冷やしていただきます。まじりっけなし、芋の甘さがずばりゼリーほどのプルプル感はなく、しっかりとした固さです。口に含むとさつまいもの風味がふわりと広がり、和三盆糖の甘さがあとを追いかけてきます。砂糖が入っているとはいえ、さつまいもの甘さも生かされていて、とても自然な甘さですよ。紅芋というひとつの素材をいかにおいしくするかにこだわった、直球勝負のスイーツはとても新鮮です。生クリームやカスタードクリームを使ったスイーツを選びがちな筆者ですが、たまにはシンプルなスイーツもいいな、とすっかり癒されましたよ。カップに入ったままスプーンですくって食べましたが、皿の上でひっくり返してカップから取り出せば、つるんとかわいいビジュアルに。ゆっくりとしたティータイムを過ごすなら、カップから出して食べることをおすすめします。寒天を使って固めているせいか、水ようかんのような独特の口どけ。芋ようかんは芋のホクホク感が味わえますが、それよりも水分が多いため口どけがよく、これからの季節にもぴったりですよ。芋スイーツといえば秋がメインなのに「なぜいま!?」という疑問を持ちつつ食べましたが、口どけのよさや甘さ控えめな味わいからして、夏に食べたくなるスイーツだと感じました。素材重視のスイーツで癒し系ティータイムを♪華やかさこそないものの、さつまいもの自然な甘さがキラリと光る癒し系スイーツ。寒天を使ったみずみずしい口どけも心地よく、これからの暑い季節のクールダウンにぴったりですよ♪商品情報■商品名:徳島産業紅芋沖縄県産使用■内容量:1個■価格:183円■カロリー:1個あたり80kcal■販売日:2021年5月4日■販売場所:沖縄地域を除く全国のローソン各店※店舗によって、お取り扱いのない場合がございます。※本記事は個人の感想に基づいたものです。味の感じ方には個人差がありますのでご了承ください。\n","↓\n","グルメ\n","↓\n","ローソンの「どこでも食べても」!ローソンの「[UNK]」はデカい!\n","Epoch 10/20\n","278/278 [==============================] - 188s 675ms/step - loss: 3.6163 - decoder_6_loss: 0.3995 - encoder_7_loss: 0.0212 - decoder_6_word_acc: 0.3783 - encoder_7_category_acc: 0.9937 - val_loss: 38.1710 - val_decoder_6_loss: 4.0443 - val_encoder_7_loss: 1.7719 - val_decoder_6_word_acc: 0.1397 - val_encoder_7_category_acc: 0.8062\n","【芋澤貞雄「裏の裏まで徹底取材」】片瀬那奈の恋人がコカイン所持で逮捕...“攻め過ぎファッション\"に再び脚光が「プロミス・シンデレラ」の第2話終了後に公式インスタグラムで公開された二階堂ふみと岩田剛典のツーショット写真に、岩田のファンがザワついている。■ファンが悲鳴写真には岩田が白いシャツ、ベージュのカーディガンを着て、河川敷で空を見上げ両手を広げる姿と、その後ろでセーラー服の襟で頭を隠そうとする、紺のハイソックス姿の二階堂が写っている。SNS上では〈最高のカップル!〉〈心臓がバクバクしました〉といった称賛の声が上がる一方、〈何か不吉な予感を感じさせる〉〈写真を見ていると胸騒ぎが止まりません〉という不安の声も聞こえた。“胸騒ぎ\"する人がいるのは、二階堂が芸能界の一部で“共演者キラー\"と呼ばれているためだろう。本人が「役柄にのめり込むうち、公私の境目がつかなくなってしまう」と役者仲間に漏らしたことがある。実際、これまでに作品で共演した新井浩文、星野源、菅田将[UNK]らとの関係を取り沙汰されてきた。今年4月には2019年公開の映画「人間失格太宰治と3人の女たち」で共演した成田凌の乱れた私生活を「週刊文春」がスクープし、その中で二階堂の名前が登場した。記事では「かなり頻繁に遊びに来るそうで、他にも“ふみちゃん\"の私物があって、どんな関係なのか謎でしたね」という成田の元恋人の証言も紹介されたため、関係者は慌てふためいたはずだ。岩田のファンは、そんな二階堂との幸せ感いっぱいの写真の“裏側\"が気になってしょうがないのだろう。■二階堂の強力プッシュで2人の共演が実現改めて「プロミス――」の関係者に話を聞いてみると、今回の2人の共演が実現した背景に“二階堂の強い推薦\"があったという。原作の同名人気漫画で描かれている「高級老舗旅館の若旦那」「眉目秀麗で頭脳[UNK]」というイメージに対し、二階堂が「これは岩田さんしかいないでしょ」と、プロデューサーに進言したといわれている。「五輪の影響もあり、視聴率は低調ですが、二階堂さんは本当に楽しそうに収録に参加しています。普通、視聴率が低いと収録現場は“お通夜\"状態になるものですが、『プロミス――』の現場は例外中の例外と言ってもいいほどです」さらに、収録現場での二階堂の気になる振る舞いも聞こえてきた。「二階堂さんはリハーサルや打ち合わせの際に、さりげなく岩田さんの腕や手に自分の手を重ねてみたり、体を預けるくらい接近することがあるそうです。いわゆるボディーコンタクトが非常に巧みなんです」また、別の芸能プロ関係者によると、二階堂がさりげなく岩田の肩を揉んであげたり、2人が肩を組む姿が何度となく目撃されているという。朝ドラの主演や紅白歌合戦の司会も務めた女優なのに、いたってざっくばらんなのも彼女の魅力のひとつ。人目をはばかることなく買い物にも出掛けるし、知り合いの舞台なども平気で見にいくのが二階堂だ。「岩ちゃんは二階堂さんにとって大学の先輩にもあたります。才能あふれる高学歴の岩ちゃんは、二階堂さんにとって“ど真ん中\"の存在じゃないですか」二階堂の所属事務所にとって、岩田との交際の噂は決してマイナスではない。せっかく「エール」の好演で好感度が爆発的に上がった矢先での文春報道のイメージを早く払拭したいはずだ。冒頭に紹介したツーショット写真の撮影中、二階堂は「私、まだOK?イケてる?」と笑いながら岩田に聞いていたという。ドラマの展開とともに、今後の二階堂と岩田の動向からも目が離せなくなってきた。\n","↓\n","芸能\n","↓\n","二階堂ふみ「吐き気がイタすぎ」でも注目の理由5人妻の“束縛\"\n","Epoch 11/20\n","278/278 [==============================] - 188s 675ms/step - loss: 3.5784 - decoder_6_loss: 0.3956 - encoder_7_loss: 0.0179 - decoder_6_word_acc: 0.3791 - encoder_7_category_acc: 0.9940 - val_loss: 38.0607 - val_decoder_6_loss: 4.0425 - val_encoder_7_loss: 1.6782 - val_decoder_6_word_acc: 0.1384 - val_encoder_7_category_acc: 0.8062\n","東京都議選中に、無免許運転で人身事故を起こし、小池百合子都知事が特別顧問を務める地域政党「都民ファーストの会」を除名された木下富美子都議が8日、自身のホームページに謝罪文を掲載した。小池氏は「論外だ」といい自ら議員辞職すべきと通告しているが、謝罪文では出処進退を明言しなかった。このまま居座れば、都民の税金から4年間で8000万円近い報酬を得ることになる。謝罪文は「都民の皆様へ」とタイトルが付けられ、「無免許で自動車を運転し、さらに交通事故を起こしてしまったことについて、猛省しております」と書き出し、被害者に「誠意ある対応を行う」としている。事故の概略は説明しているが、悪質な「免許停止中の運転」については、「捜査中の案件ですので、具体的な事項については、弁護士さんの助言を受けて、それが整理された段階でご説明いたしたい」とした。最も注目される進退については、「私にいただいた29767票の重みを踏まえ、有権者の方々との絆を大切にし、損ねてしまった信頼を取り戻すためにどうすれば良いか、様々な意見をいただきながら、熟考を重ねてまいります」と記すだけで、明記していない。そもそも、警視庁が事故直後に発表して、都民の判断材料を奪わなければ、この2万9767票は変わっていたはずだ。地元では、事故時以外の運転目撃情報も広まっており、[UNK]なき捜査が待たれる。木下氏が都議を続けた場合、任期の4年間で得られる報酬は総額約7960万円=別表=となる。都議の報酬の高さは有名で、人口最少の鳥取県議の報酬と比べると、1・3倍もの開きがある。木下氏は「熟考を重ねる」というが、自身の行動や、小池氏の“辞職通告\"を見れば、結論を出すのは簡単だ。●東京都議の報酬月額81万7600円期末手当409万44円政務活動費月額50万円年間総額1990万1244円4年総額7960万4976円\n","↓\n","国内\n","↓\n","都議会議長に三宅氏無免許事故の木下氏にも無免許更新、都民ファ除名から2日\n","Epoch 12/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.5448 - decoder_6_loss: 0.3919 - encoder_7_loss: 0.0177 - decoder_6_word_acc: 0.3802 - encoder_7_category_acc: 0.9944 - val_loss: 38.5191 - val_decoder_6_loss: 4.0753 - val_encoder_7_loss: 1.8414 - val_decoder_6_word_acc: 0.1391 - val_encoder_7_category_acc: 0.8094\n","昨今、ジャニーズアイドルたちの交際や結婚報道も珍しくなくなった。応援するファンにとっては寂しい気持ちもあるだろうが、一方で当人の幸せを願って祝福するのが本当のファンである、という考え方もある。アイドルの交際報道が出るたびに揺れ動くファン心理が垣間見える。先日もKis-My-Ft2の横尾渉が、『FRIDAY』の取材に対して、一般女性との真剣交際を宣言し、その誠実な対応が注目を集めた。記者に対して「中途半端な気持ちじゃないです」と交際を認め、また相手の女性が一般人であることについて「一般の方なので守ってあげたい」と明言した姿も、世間の好感度を高める結果につながった。ただ、「キスマイ担」や「俺足族」と呼ばれる熱心なファンたちは、今回の報道に複雑な思いを抱いているようだ。熱心な「キスマイ担」の一人である、都内の女子大生Aさんはこう語る。「キスマイのリア恋枠といえば、たま、ひろみつ、たいちゃんあたりだと思うので、横尾さんの交際宣言はそこまでショックじゃない。実際『もう横尾さんもアラフォーだし、幸せになってほしい』と言うファンも多いです。ただ、ファンとしては横尾さんのこれまでの交際相手と噂されている女性たちの“匂わせ\"に複雑な思いはあるんです」“匂わせ\"というのは、自分がアイドルと付き合っていることを“匂わせる\"SNS投稿をすること。「今回のお相手に限らず、横尾さんと交際してきたとされる女性たちは、横尾さんの私物や飼っている犬の写真をアップしたりしていたんです。ファンの中からは、『これで“匂わせ\"しない彼女だったらもっと評価上がったのに』と残念がる声もちらほら」関西の大学に通う「キスマイ担」の女性Bさんは、ジャニーズアイドルの交際相手の“匂わせ\"事情についてこう語る。「SNSが発達してから、ジャニーズアイドルと付き合っているだろう子は簡単に特定できるようになった。本人たちが“匂わせ\"したり、自分からSNSで暴露したりするからです。中には、インスタライブで関係があることを暴露したり、鍵アカウントでアイドルが映り込んだ動画などをアップする子もいる。彼女たちは“匂わせ\"を通じて他のファンたちにマウントを取りたいんだと思います。今後、ジャニーズアイドルの交際報道や結婚報道が出る際には、『匂わせをしない女を選んでいるか?』というところが、ファンからの評価につながると思う。その辺りをしっかりと守れる相手と付き合っていれば、株も上がると思います」誰もがSNSで自由に発信することができるこの時代。もちろんデマ情報が飛び交うこともあるが、アイドルと繋がりのある一般女性がプライベートな情報や個人情報を流出してしまうケースも後を絶たない。それによって活動休止を余儀なくされたジャニーズJr.のタレントもいる。ファンにとってアイドルは“疑似恋愛\"の対象という側面もあるとはいえ、実際に結婚するときは祝福したいという思いもあるだろう。そうした中でファンたちは、最低限のルールとして“匂わせない\"女性との交際を望むようになってきているようだ。\n","↓\n","芸能\n","↓\n","交際相手はその後、本音で続々...「彼女が彼女にいる」の本音を続々\n","Epoch 13/20\n","278/278 [==============================] - 188s 675ms/step - loss: 3.5029 - decoder_6_loss: 0.3873 - encoder_7_loss: 0.0173 - decoder_6_word_acc: 0.3811 - encoder_7_category_acc: 0.9949 - val_loss: 38.4539 - val_decoder_6_loss: 4.0754 - val_encoder_7_loss: 1.7751 - val_decoder_6_word_acc: 0.1396 - val_encoder_7_category_acc: 0.8148\n","●レッドソックス4-8レイズ○<現地時間8月10日フェンウェイ・パーク>レッドソックスの澤村拓一投手は現地時間10日、本拠地で行われたレイズ戦にリリーフ登板。0回2/3を無失点に抑えた。4-1で迎えた6回、先発のエデュアルド・ロドリゲスが打ち込まれて1点を失い、なおも一死一・二塁というピンチで澤村が登板。長打で同点、一発なら逆転という窮地も、4番のヤンディ・ディアスを見事に見逃し三振に仕留めると、オースティン・メドーズは左直で3アウト。大ピンチを6球で切り抜け、自身の役割をしっかりと果たした。ところが、チームはその後追いつかれると、同点の9回に勝ち越し打を浴びて一挙4失点。地区首位・レイズとの差を縮めたいところだったが、逆にゲーム差を「5」に拡げられてしまった。【動画】澤村が火消し!9つ目のホールド【レッドソッックス】復帰の澤村拓一が1死1,2塁の状況で登板!2者連続でアウトにし、今季9つ目のホールドを記録しました[UNK]日本人選手情報https://t.co/PeswhfkGexpic.twitter.com/ZWpl20REc3-MLBJapanAugust11,2021\n","↓\n","スポーツ\n","↓\n","レッドソックス守護神・澤村拓也がA4人に挙げた手にボールが止まらず?「とても難しい状況」\n","Epoch 14/20\n","278/278 [==============================] - 188s 677ms/step - loss: 3.4536 - decoder_6_loss: 0.3823 - encoder_7_loss: 0.0132 - decoder_6_word_acc: 0.3824 - encoder_7_category_acc: 0.9961 - val_loss: 38.4061 - val_decoder_6_loss: 4.0740 - val_encoder_7_loss: 1.7400 - val_decoder_6_word_acc: 0.1393 - val_encoder_7_category_acc: 0.8030\n","5月19日夕方、星野源さんと新垣結衣さんが結婚を発表。ドラマ「逃げるは恥だが役に立つ」で共演し人気を博したお二人、Twitterのトレンドには「ガッキー」「逃げ恥婚」「平匡さん」「ひらまささん」「契約結婚」「リアル夫婦」といった関連ワードが次々とランクインしていた。参考記事:新垣結衣さんと星野源さんが結婚を発表!「ガッキー」「逃げ恥婚」「契約結婚」などの関連ワードがTwitterのトレンドを席巻https://getnews.jp/archives/3013863[リンク]ドラマの原作である漫画「逃げるは恥だが役に立つ」作者の海野つなみ先生はTwitterにて結婚のニュース記事にリンクを貼りええええ~~~!!おめでとうございます~~~!!!とツイート。メールがDMがたくさん届いている旨のツイートも行っていた。しばらく後に新垣結衣さん星野源さん、ご結婚おめでとうございます!これからもお二人の幸せと健康を、心から願っています逃げ恥逃げ恥婚夫婦を超えてゆけとツイートし、Congratulationsonyourmarriage.YuiandGen!とメッセージの入ったお二人のイラスト画像をアップした。なんとも素敵な祝福イラストの投稿、感謝の言葉が次々と寄せられていたようである。※画像は『Twitter』より\n","↓\n","芸能\n","↓\n","星野源「新垣結衣さん」出演、東大生時代も驚いた“結婚生活\"に変化系アイドルたちのお手上げ\n","Epoch 15/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.4168 - decoder_6_loss: 0.3782 - encoder_7_loss: 0.0126 - decoder_6_word_acc: 0.3836 - encoder_7_category_acc: 0.9964 - val_loss: 38.7194 - val_decoder_6_loss: 4.0941 - val_encoder_7_loss: 1.8726 - val_decoder_6_word_acc: 0.1392 - val_encoder_7_category_acc: 0.8009\n","競泳の瀬戸大也、池江[UNK]子、体操の内村航平らメダルを有望視されていた選手が不振に終わるなか、期待がかかるのはバドミントンだ。25日午後6時からは、いよいよ不動のエース・桃田賢斗が初戦に登場する。スキャンダルさえなければ、前回大会で金メダルを取っていてもおかしくなかった桃田。復活までの苦難の道のりを振り返ってみる。***【写真】スキャンダル発覚の原因となったキス写真組長の情婦に手を出してしまったリオ五輪を4カ月後に控えた16年4月、日本バドミントン界に衝撃が走った。桃田が、当時、協会所属選手だった田児賢一らとともに、東京・錦糸町の闇カジノに通っていたことが発覚したのだ。闇カジノ通い発覚後の記者会見。田児賢一が泣きじゃくるなか、桃田はたんたんとした表情だった「発端は桃田の女遊びでした。あの頃の桃田はメダル候補ともてはやされ、完全に調子づいていた。先輩の田児とともに錦糸町で遊びまくっているうちに、あるスナックの美人ママに入れあげてしまったのです」だが、その女性は絶対に手を出してはならない相手だった。指定暴力団に属する組長の情婦だったのである。「組長は桃田が通っていた闇カジノを実質的に仕切っている人物で、桃田とは幾度も同じバカラテーブルで勝負をしたことがあった。組長は桃田とママがキスしている写真を目にして激怒。それがきっかけとなり、彼らのカジノ通いがマスコミに持ち込まれることになったのです」「田児との関係を切れ」報道直後、日本バドミントン協会は、桃田に無期限の競技会出場停止処分、田児に無期限の協会登録抹消処分を課した。この瞬間、桃田のリオ五輪は終わってしまった。「協会は桃田を守り抜くために、田児に責任を押し付けた。カジノ通いは田児が主導したもので、桃田は巻き込まれたと判断したのです。桃田はスキャンダル発覚以降、協会幹部から『田児との関係を切れ』と言われ、その後、一度も連絡を取っていないようです」“悪友\"との関係を断ち切り、1年2カ月の謹慎期間を経て、17年5月に復帰した桃田はそこから快進撃を見せる。国際大会で連戦連勝。18年8月の世界大会で日本男子初の金メダルを獲得、その1カ月後には世界ランキング1位まで上り詰めた。トレセンで起きた“夜這い\"事件だが、この最中、再び女性絡みのスキャンダルが発覚する。今度は何かというと、「18年5月にナショナルトレーニングセンターで強化合宿を行なっていた際、女子選手が桃田の部屋に“夜這い\"していたことがバレてしまったのです」お相手は、こちらも今大会の女子ダブルスでメダルに期待がかかる「フクヒロ」ペアの福島由紀。両人とも独身なのだから構わないのではと思うかもしれないが、「タイミングが悪かった。二人が桃田の部屋で一夜を過ごした日の翌朝に『日本アンチ・ドーピング機構』による抜き打ち検査があったのです。早朝6時、検査員が福島を訪ねたものの部屋にいなかったため、“事件に巻き込まれたのではないか\"と、朝から警備室の防犯カメラを総チェックする大騒動になった」この騒ぎを18年10月に「週刊新潮」が報じると、税金で建設された\"トレセン内で逢引するなんてけしからん\"という声が沸き起こった。だが、詰まるところは若気の至り。厳重注意で済まされたが、それから1年後の20年1月、今度はとんでもない事故に巻き込まれてしまう。交通事故で大怪我マレーシア遠征からの帰り、クアラルンプール国際空港に移動中、桃田が乗っていた車が前方のトラックに衝突。全身打撲と顔面挫傷の大ケガを負ってしまったのだ。まだ東京五輪の延期が決まっていない時期だった。「運転していたドライバーが死亡するほどの大事故でした。帰国後、右眼窩底骨折と診断され、緊急手術。事故直後は『シャトルが二重に見える』と訴えていましたが、懸命なリハビリを経て、昨年12月に全日本総合選手権に出場し、復帰戦で見事優勝を果たした。それから現在に至るまで、世界ランキング1位をキープしています」気になるのは、怪我の後遺症だが、「ほぼ克服しているようです。コロナで1年、五輪が延期になったことが幸いした。本人も『出るからには金メダルを取りたい』と公言しています」幾多の困難を乗り越え、いよいよ夢舞台に立つ桃田に注目したい。デイリー新潮取材班2021年7月25日掲載\n","↓\n","芸能\n","↓\n","瀬戸大也&桃田入り時給取りの瀬戸大也&転落事故で“ギプス\"も「れば」\n","Epoch 16/20\n","278/278 [==============================] - 188s 677ms/step - loss: 3.4203 - decoder_6_loss: 0.3777 - encoder_7_loss: 0.0213 - decoder_6_word_acc: 0.3835 - encoder_7_category_acc: 0.9936 - val_loss: 38.5912 - val_decoder_6_loss: 4.0903 - val_encoder_7_loss: 1.7783 - val_decoder_6_word_acc: 0.1387 - val_encoder_7_category_acc: 0.7987\n","歳をとると出来ることが増える一方で、出来ないことも増えていきます。だからこそ若いうちにしかできない「若いうちに出来ること」を知っておくのはとても大事。Twitterユーザーのあくおんさんが6月10日に投稿した、「『若いうちに出来ること』というのは、長時間の労働でも、自分探しの旅でもなく、マヨネーズをつけた唐揚げで白米をかきこんで、それを背脂多めのラーメンで流し込む、といったことなのです」というツイートが共感を呼んでいます。【その他の画像・さらに詳しい元の記事はこちら】この投稿には、1万件を超えるいいねが付き、「若い時にもっとやっておきたかった」「画像を見て、食べたいけど体が耐えられないおじさんがここに居ます」「30過ぎた辺りからできなくなった」などの声が続出。あくおんさんに今回のツイートをしようと思ったきっかけを聞いてみました。この日、あくおんさんはラーメン屋に来店すると、この日ラーメン店で鶏の唐揚げ・白飯のセットが税別250円という安さだったため思わず注文。あくおんさん曰く「唐揚げ+マヨネーズ+大盛ライス+背脂多めラーメンのマリアージュに感涙した」とのこと。しかし、一緒に来店した先輩たちは背脂多めのラーメンはおろか、揚げ物すら口にしない人が多かったそう......。その経験から「この幸せは若い人にしか分からない」。言い換えると、「この幸せは若いうちにしか体験出来ない」ことに気づいた、あくおんさん。この気持ちを共有しようとツイートしたとのことです。昨今のSNSなどで「若いうちに働け」「若いうちに旅に出ろ」「無理が出来るうちに無理をしろ」といった意見を見て、言っていることは間違ってないし、正しい所もある意見としながらも、「もっと身近な所にも『若いうちに出来ること』があると思いました」と語る、あくおんさん。たしかに、そうかもしれませんね。現在20代で、自作の家系ラーメンで白飯を2合食べたり、野菜マシマシの二郎系ラーメンを食べたりするなど、自ら「破綻した食生活を送っています」と話していた、あくおんさん。現在40代の筆者ですが、まだまだ負けていられないと、無駄に対抗心を燃やしてしまいました。<記事化協力>あくおんさん※訂正:初出時よりセットの説明に変更を加えました。ラーメン・唐揚げ・白飯のセットが税込250円ではなく、正しくは「唐揚げ・白飯のセットが税別250円」でした。お詫びして訂正いたします。\n","↓\n","ライフ総合\n","↓\n","「ご飯を待ち遠しい」外国人の「自宅で作れる」「洋食に」「天才」「あの人に反響\n","Epoch 17/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.3850 - decoder_6_loss: 0.3742 - encoder_7_loss: 0.0170 - decoder_6_word_acc: 0.3846 - encoder_7_category_acc: 0.9944 - val_loss: 38.8953 - val_decoder_6_loss: 4.1243 - val_encoder_7_loss: 1.7766 - val_decoder_6_word_acc: 0.1389 - val_encoder_7_category_acc: 0.8073\n","南米ペルーで確認された新型コロナのラムダ株が米国で拡大している。CNNは鳥インフルエンザ情報共有の国際推進機構を引用し、現在まで米国で1060件のラムダ株感染事例が確認されていると8日報じた。先月19日にテキサス州で初めて報告されてから3週間でだ。ラムダ株の伝播力がどの程度かは明らかでないが、英国で昨年広がったアルファ株やインド由来のデルタ株のように従来の新型コロナウイルスより拡大しやすいと推定される。懸念されるのはラムダ株で観察されたワクチン回避能力だ。ワクチンを無力化するほどではないが、一部耐性を持つという研究結果が出ている。世界保健機関はラムダ株を「注目すべき変異株」に指定している。「懸念される変移株」に指定されたアルファ株・ベータ株・ガンマ株・デルタ株より一つ下だ。まだ危険性が正確に確認されていない。ラムダ株は米国など29カ国で報告されている。米国ではデルタ株が絶対的優勢株として定着し、「米国で変異株同士の闘いは終わった。デルタ株が勝った」という評価があった。デルタ株が米国に上陸してから3カ月間で他の変移株を追い出して新規感染者の93.4%を占めたからだ。中国武漢ウイルス研究所の石正麗所長はサウスチャイナモーニングポストのインタビューで「感染者数が増え、ウイルスが突然変異を起こす選択の機会がさらに多くなっている」とし「コロナは終わらないはずで、共に暮らす方法を選ぶ必要がある」と述べた。\n","↓\n","海外\n","↓\n","韓国、デルタ株の感染力を拡大中に1/デルタ株/台湾\n","Epoch 18/20\n","278/278 [==============================] - 188s 676ms/step - loss: 3.3695 - decoder_6_loss: 0.3721 - encoder_7_loss: 0.0203 - decoder_6_word_acc: 0.3850 - encoder_7_category_acc: 0.9944 - val_loss: 38.8273 - val_decoder_6_loss: 4.1273 - val_encoder_7_loss: 1.6814 - val_decoder_6_word_acc: 0.1378 - val_encoder_7_category_acc: 0.8105\n","認知症の母親を看取った姉妹。その看取りの経験が家族に残したものとは......人はいつか老いて病んで死ぬ。その当たり前のことを私たちは家庭の日常から切り離し、親の老いによる病気や死を、病院に長い間任せきりにしてきた。結果、いつの間にか死は「冷たくて怖いもの」になり、親が死ぬと受け止め方がわからず、喪失感に長く苦しむ人もいる。看取り士とは、余命告知を受けた本人の家族から依頼を受け、本人や家族の不安や恐怖をやわらげ、思い出を共有し、最後は抱きしめて看取ることをうながす仕事。村田晶子さんと楠木智美さんの姉妹は、看取り士の助言と支援を受けながら、認知症の母親を看取った。2人が体験した看取りとはどんなものだったのか。告別式後に受け取る「母親からのギフト」2021年2月末、母親の告別式から約1カ月後のことだ。看取り士の清水直美さんをまじえて、晶子さん、智美さん姉妹の会話がはずんだ。話題は母親が息を引き取った後の出来事。Zoom取材に応じてくれた、妹の智美さんが話す。「清水さんが布団をめくったら、お母さんがなぜか腕を組んでいて、清水さんも『キャッ!』って驚いたんです。腕を組むのはお母さんのくせでしたから」姉の晶子さんはその経緯を説明する。生前、よく腕組みをしていた母親「実は、息を引き取る少し前に施設の看護師さんが来て、母の左手の指で血中酸素濃度を測ったんです。そのとき組んでいた腕を一度外したんです。だから、いつの間にまた組んだんだろうねって、3人で笑ったんですよ」智美さんは、告別式などの慌しさの中で、肉親の最期にじっくりと寄り添った看取りの感動が薄れていったと話す。「看取りに立ち会った家族同士でも、そのときの記憶は互いにバラバラで、曖昧だったりします。ですから、面談では看取り士さんをまじえて、ちぐはぐな記憶の答え合わせができる感じがいいんですよね」この連載の一覧はこちら一般社団法人日本看取り士会に所属する看取り士は、看取りを終えた後で、依頼者と再会することは今までなかった。しかし、コロナ[UNK]が長引き、面会もできずに親が病院などで他界し、家族が指一本触れることなく火葬されることも増えた。肉親の死にちゃんと立ち会えずに後悔をつのらせる人や、喪失感から立ち直れない人たちも増えている。そこで故人に改めて心を寄せる時間を持つために、看取り士が依頼者と面談をすることが増えている。四十九日の法要までに看取りの過程を振り返るのだ。「先の母の腕組みについての笑い話も、その面談時に生まれたもので、私は母からのギフトだと思うんです。だって、亡くなってからも私たちを笑わせてくれる母って、やっぱり偉大ですもん!」今でこそ、母親の看取りをそうにこやかに振り返る姉妹。しかし、認知症の母親が最初の余命告知を受けた2019年末頃、2人の関係は険悪だった。看取り士の姿勢に驚き、喜び、泣いた理由「初めまして、看取り士の清水直美です。おつらいところはないですか?」看取り士の清水直美さん元看護師で看取り士の清水さんは、ベッドでエビのように体を丸める母親に顔を20cmほどに近づけ、背中をさすりながらそう声をかけた。2019年の大晦日の午後、都内の病院の一室。当日が看取り士との初対面で、その後に姉妹は看取り士の派遣契約をかわす予定だった。「お母様は少し震えていて、何かにおびえていらっしゃるようでもありました。ですが、私の問いかけにはうんうんとうなずいたり、時おり私に視線をちらちらと送ったりしてくださいました」認知症を長く患う母親に、清水さんが普通に接してくれたことに、姉妹は驚きながらも、うれしかったと話す。智美さんが後悔も込めて振り返る。「施設の人も私たちも長い間、母とはそんなふうには接してこなかったからです。意思の疎通がとれないと思い込んでいましたから。ですから清水さんの普通の接し方が、ある意味カルチャーショックで、心がふわっとゆるんだんです」病気とはいえ、智美さんは母親を人間として長い間見ていなかったことが申し訳なくて、涙があふれて止まらなかった。どんな状態であれ、人として普通に向き合う看取り士の姿勢が、姉妹の先入観に風穴を開けたことになる。胃潰瘍や逆流性食道炎などで入院した母親が、退院して施設に戻る前のことだ。施設側は食事が自力でとれないなら、胃ろうを増設して戻ってきてほしいこと、さらに施設での看取りはできないことを伝えてきた。姉妹は母親に負担の大きい胃ろうを拒む一方、約6年間過ごした施設で暮らし続けられるようにと、母親に食事をとらせようと懸命だった。でないと施設を追い出されるし、食べないと死んでしまうからだ。ところが、母親は頑なに食事を拒み続けていて、姉妹は焦っていた。血管が細い母親は、点滴を打てる部位もほぼなかった。看取り士の清水さんは、そんな姉妹に何度も繰り返した。「言葉にならないお母さんの気持ちを、ぜひお二人で考えてみてい\n","↓\n","ライフスタイル\n","↓\n","子どもの母が児相に母で母に聞くと、夫が、夫にやっていた「母の娘」\n","Epoch 19/20\n","278/278 [==============================] - 188s 677ms/step - loss: 3.3470 - decoder_6_loss: 0.3696 - encoder_7_loss: 0.0208 - decoder_6_word_acc: 0.3859 - encoder_7_category_acc: 0.9935 - val_loss: 38.9550 - val_decoder_6_loss: 4.1261 - val_encoder_7_loss: 1.8199 - val_decoder_6_word_acc: 0.1384 - val_encoder_7_category_acc: 0.8094\n","歌詞検索サービス「歌ネット」が、8月5日付けの「歌ネット注目度ランキング」を発表した。注目度ランキングは、「発売前の楽曲」のみのランキングで、「歌詞閲覧数」+「いいね!クリック数」の割合でランキングが決定する。通常の歌詞アクセスランキングとも違う、まさに「これから発売される、歌詞が注目されている楽曲」のランキングだ。今回のランキングでは1位に、millenniumparade×Belleの「U」が輝いた。3週連続での首位記録となる。2021年8月18日にリリースされる新曲であり、細田守監督最新作『竜とそばかすの姫』メインテーマとして書き下ろされた。48時間限定で公開された、millenniumparadeと主人公・Belleがコラボレーションした圧巻の冒頭シーンも、80万人以上の視聴数で急上昇チャート入りし話題となった。なお、クリエイターを内包するmillenniumparadeはこれまでも圧倒的なクリエイションで、衝撃的な作品を発表してきたが、他作品との大々的なコラボレーションは今回が初めての試みとなる。2位には、JO1の「REAL」が初登場。2021年8月18日にリリースされるニューシングル『STRANGER』の収録曲であり、ABCテレビ『芸能界常識チェック!~トリニクって何の肉!?』8月エンディングテーマに起用されている。<鏡の奥ずっと[UNK]続けたけど気づいたんだThisismeThisisme>と幕を開ける歌。MVでは、未知の世界に足を踏み入れたJO1が見慣れない世界で新たな自分を発見し迷いながらも進んでいく姿が描かれている。3位には、Da-iCEの「Kartell」が初登場。2021年8月9日にリリースされるデジタルシングルだ。作詞・作曲を手掛けたのはリーダーの工藤大輝。歌詞には<誰が邪魔をしようと積み上げてきた全てが希望>と綴られている。昨年にリリースした『CITRUS』のロングヒットを引っ提げ、Da-iCEにとっての新たな10年への初手として、そして決意を表明する1曲として制作された楽曲となっている。6位には、Uruの「LoveSong」がランクイン。2021年8月25日にCDリリースされるニューシングルであり、8月5日より先行配信されている。比嘉愛未×渡邊圭祐の木曜ドラマ『推しの王子様』主題歌として書き下ろされ、作詞・作曲をUru、編曲をトオミヨウが手掛けた。徐々に積もっていく恋心と大切な人とのかけがえのない時間を描いた、ラブソングでありながら、毎日を懸命に生きる人への応援歌としても聞こえる新境地の1曲となっている。9位には、ジェニーハイの「夏嵐」が初登場。2021年9月1日にリリースされるニューアルバム『ジェニースター』に収録される新曲だ。この楽曲はTikTokで7月19日にスタートしたTikTok夏祭りに合わせて、一部をTikTokで先行公開しており、メンバーの子供時代、青春時代の夏休みの写真を使った動画がアップされ話題となっていた楽曲。サビでは<夏休み心は休めないだってまだ何も残せてないから>と歌われており、まさに夏休みに聞きたいアップテンポながら哀愁が感じられる曲となっている。【2021年8月5日付、歌ネット注目度ランキング】1位U/millenniumparade×Belle2位REAL/JO13位Kartell/Da-iCE4位夏霞/あたらよ5位夏化粧/DOBERMANINFINITY6位LoveSong/Uru7位真夏のトレモロ/EnGene.8位聖者の行進/キタニタツヤ9位夏嵐/ジェニーハイ10位決戦エンドレス/KnightA-騎士A-\n","↓\n","ライフスタイル\n","↓\n","Official髭男dismらが初登場!今注目の歌詞ランキング\n","Epoch 20/20\n","278/278 [==============================] - 188s 677ms/step - loss: 3.2644 - decoder_6_loss: 0.3614 - encoder_7_loss: 0.0120 - decoder_6_word_acc: 0.3879 - encoder_7_category_acc: 0.9964 - val_loss: 39.2729 - val_decoder_6_loss: 4.1499 - val_encoder_7_loss: 1.9236 - val_decoder_6_word_acc: 0.1373 - val_encoder_7_category_acc: 0.7966\n","いつもは家事や育児に無頓着なのに、ふとしたとき夫に「イクメンです」といったパフォーマンスをされると、妻はイラッとするもの。普段の生活を見ているからこそ、人前だけでイクメンぶっちゃって......なんて思うこともあるのではないでしょうか。周りにイクメンアピールするよりも、妻に認められる父親や夫でいてほしいものですよね。ここではそんな、夫のパフォーマンスイクメンにイラッとしたエピソードを聞いてみました。月齢を聞いて「その頃は...」と語る・「子どもが赤ちゃんの頃は、仕事が忙しいとかで残業して夜遅くに帰ってくることも多かったくせに、自分の後輩に子どもが産まれると、『その頃は夜泣きが大変だよなぁ』とか『離乳食たべないこともあるよな』なんて語っていてイラッ。それ、全部私が泣きながら相談したやつじゃん。まるで自分が育てたかのように言わないでほしい」・「友達に子どもが産まれたのでお祝いの電話をかけていた夫。隣の部屋から『今3か月か。可愛いけど大変な頃だよな』とか『夜泣き大丈夫?ちゃんと奥さんをいたわるんだよ』とか聞こえてきてイライラしかない。あなたは自分の子どもが3か月のとき、夜泣きの対応もオムツ替えも一度もしなかったでしょ[UNK]自分はほとんど育児をしてこなかったのに、知り合いに子どもが生まれると、あたかも「イクメンでした」みたいな振る舞いをする。そんなイタい姿を見たらイラっとしますよね。\n","↓\n","恋愛\n","↓\n","イライラ...?イラがしたときの夫に言われたエピソードvol.5\n"],"name":"stdout"},{"output_type":"execute_result","data":{"text/plain":["<tensorflow.python.keras.callbacks.History at 0x7f05c42eefd0>"]},"metadata":{},"execution_count":137}]},{"cell_type":"code","metadata":{"id":"rJJ819yBdgFV"},"source":["# ひろゆきのサンプルいいかも\n","# メインヒロイン"],"id":"rJJ819yBdgFV","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"8e0ac093-6b26-46cb-b619-9ac0b81ecef9"},"source":["trainer.save_weights(\"./trainer_weight_multi.h5\")"],"id":"8e0ac093-6b26-46cb-b619-9ac0b81ecef9","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"MhOqklVXGo0Z"},"source":["trainer.load_weights(\"./trainer_weight_multi.h5\")"],"id":"MhOqklVXGo0Z","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"HPqmTzbBlykm","executionInfo":{"status":"ok","timestamp":1629782229419,"user_tz":-540,"elapsed":222,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"6502182f-8be9-4ecf-84bd-5b7a7f8a1a6d"},"source":["le.classes_"],"id":"HPqmTzbBlykm","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array(['IT 経済', 'グルメ', 'スポーツ', 'ファッション・ビューティ', 'ライフスタイル', 'ライフ総合', '国内',\n","       '恋愛', '海外', '芸能', '車'], dtype=object)"]},"metadata":{},"execution_count":113}]},{"cell_type":"code","metadata":{"id":"9IODVtUC6KxF","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1629854682329,"user_tz":-540,"elapsed":427,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"3fe68f90-ff66-4929-e64c-0fd5a1f7cbdb"},"source":["trainer.layers"],"id":"9IODVtUC6KxF","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[<tensorflow.python.keras.engine.input_layer.InputLayer at 0x7f4ceb6b3410>,\n"," <tensorflow.python.keras.engine.input_layer.InputLayer at 0x7f4ceb6a6850>,\n"," <__main__.PositionalEncoding at 0x7f4ceba84150>,\n"," <tensorflow.python.keras.layers.core.Lambda at 0x7f4cebb78b10>,\n"," <__main__.Encoder at 0x7f4cebb78ed0>,\n"," <__main__.Decoder at 0x7f4ceb33b250>]"]},"metadata":{},"execution_count":48}]},{"cell_type":"code","metadata":{"id":"PtSuV5pwMeee"},"source":["def decode_title(input_sentence):\n","  decoder_sentence = \"[BOS]\"\n","  input_sentence = \" \".join(tokenizer.tokenize(input_sentence))\n","  encoder_sentence_ = keras_tokenizer.texts_to_sequences([input_sentence])\n","  encoder_sentence_ = pp.sequence.pad_sequences(encoder_sentence_, maxlen=ENC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","  for i in range(50):\n","    decoder_sentence_ = keras_tokenizer.texts_to_sequences([decoder_sentence])\n","    decoder_sentence_ = pp.sequence.pad_sequences(decoder_sentence_, maxlen=DEC_SEQ_LEN, padding=\"post\", truncating=\"post\")\n","    pred, _ = trainer((encoder_sentence_, decoder_sentence_))\n","    sampled_tkn_idx = np.argmax(pred[0,i,:])\n","    sampled_tkn = keras_tokenizer.index_word[sampled_tkn_idx]\n","    decoder_sentence =  decoder_sentence + \" \" + sampled_tkn\n","    if sampled_tkn == \"[EOS]\":\n","      break\n","  return \"\".join(re.sub(\"#\", \"\", decoder_sentence).split(\" \")[1:-1])"],"id":"PtSuV5pwMeee","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"UPPBudA4QTiv","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1629797538426,"user_tz":-540,"elapsed":1817,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"d18f23b9-b706-43d8-c67e-e2cfe802e46e"},"source":["idx = np.random.randint(0, len(datasets))\n","print(datasets[idx][0])\n","print(\"↓\")\n","print(decode_title(datasets[idx][0]))\n","print(\"↓\")\n","print(datasets[idx][1])"],"id":"UPPBudA4QTiv","execution_count":null,"outputs":[{"output_type":"stream","text":["[11日ロイター]-豪コモンウェルス銀行は11日、過去最高となる60億豪ドル規模の自社株買いを発表した。新型コロナウイルス流行からの景気回復で通期キャッシュ利益が約20%増えたことを受けた。オーストラリアの新型コロナ流行抑制とそれに伴う早期の景気回復が銀行を支援。また、このところの非中核部門の売却で「豪4大銀行」はキャッシュが豊富となっており、各行は向こう2年間で過去最高となる260億豪ドルの株主還元を見込んでいる。CBAは国内経済の耐性および自社株買い後の潜在的なストレスイベントを吸収できる自行の能力を考慮したと説明。今回の自社株買いでは発行済み株式資本が3.5%超減少する。アナリストは国内最大手行であるCBAの自社株買いについて、50億豪ドル規模になると予想していた。競合のオーストラリア・アンド・ニュージーランド・バンキング・グループとナショナル・オーストラリア銀行は先月、合計で40億豪ドル相当の自社株買い計画を発表した。CBAのマット・コミン最高経営責任者は、2021会計年度における豪景気回復の力強さを認識しつつ、新型コロナ流行が引き続き経済に影響を及ぼすほか、金利低下が自行の将来の利益にとって圧力になると指摘した。6月30日までの会計年度では、CBAの税引き後キャッシュ純利益は19.8%増の86億5000万豪ドル。アナリスト5人によるコンセンサス予想を上回った。最終配当は1株当たり2.00豪ドルとした。規制当局が配当を制限していた昨年は98豪セントだった。配当性向はCBAのキャッシュ利益の71%に相当。同行は引き続き通期配当性向目標をキャッシュ利益の70─80%にするとした。融資減損費用は5億5400万豪ドルとなり、昨年の25億2000万豪ドルから減少した。\n","↓\n","豪CBA、44億ドル規模の自社株買い発表景気回復で利益が拡大\n","↓\n","豪CBA、44億ドル規模の自社株買い発表景気回復で利益が拡大\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"jytx7fKSOnxH"},"source":["news_sample = '''比嘉愛未（35）主演の連ドラ「推しの王子様」（フジテレビ系木曜夜10時）。乙女ゲームを手がけるベンチャー企業の女社長・泉美が、自身の理想通りにつくった推しキャラのケント様にそっくりな航（渡辺圭祐＝27）に出会うことで始まる物語だが、当初主演予定だった深田恭子（38）が適応障害で休業することを公表し、降板。急きょ代役で泉美を演じることになったのが、比嘉だ。\n","\n","比嘉愛未「2行のセリフ」が言えなかった駆け出し時代\n","\n","「最近の代役といえば、NHK大河『麒麟がくる』でしょう。沢尻エリカの代役で、川口春奈が帰蝶を演じましたが、ふたを開けてみると、〈川口でよかった〉の声がほとんどだった。『推しの王子様』の比嘉も、初回を見る限り、そういう評価になりそうな予感がします。仕事ができる女社長役って、深田よりむしろ比嘉の方がハマる気がしますもんね」（ドラマ制作会社スタッフ）'''"],"id":"jytx7fKSOnxH","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"iBtFkb6vOtcp","colab":{"base_uri":"https://localhost:8080/","height":103},"executionInfo":{"status":"ok","timestamp":1628582715378,"user_tz":-540,"elapsed":282,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"16354b8b-e765-4875-c239-e27aeb0e8462"},"source":["news_sample = re.sub(r\"\\s\", \"\", news_sample)\n","news_sample = re.sub(\"\\u3000\", \"\", news_sample)\n","news_sample"],"id":"iBtFkb6vOtcp","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'比嘉愛未（35）主演の連ドラ「推しの王子様」（フジテレビ系木曜夜10時）。乙女ゲームを手がけるベンチャー企業の女社長・泉美が、自身の理想通りにつくった推しキャラのケント様にそっくりな航（渡辺圭祐＝27）に出会うことで始まる物語だが、当初主演予定だった深田恭子（38）が適応障害で休業することを公表し、降板。急きょ代役で泉美を演じることになったのが、比嘉だ。比嘉愛未「2行のセリフ」が言えなかった駆け出し時代「最近の代役といえば、NHK大河『麒麟がくる』でしょう。沢尻エリカの代役で、川口春奈が帰蝶を演じましたが、ふたを開けてみると、〈川口でよかった〉の声がほとんどだった。『推しの王子様』の比嘉も、初回を見る限り、そういう評価になりそうな予感がします。仕事ができる女社長役って、深田よりむしろ比嘉の方がハマる気がしますもんね」（ドラマ制作会社スタッフ）'"]},"metadata":{"tags":[]},"execution_count":280}]},{"cell_type":"code","metadata":{"id":"H8_FLJcvO-ir","colab":{"base_uri":"https://localhost:8080/","height":35},"executionInfo":{"status":"ok","timestamp":1628582718516,"user_tz":-540,"elapsed":1804,"user":{"displayName":"k g.","photoUrl":"","userId":"01082649767351199152"}},"outputId":"8e443e48-5085-4255-9176-23b30e093220"},"source":["decode_title(news_sample)"],"id":"H8_FLJcvO-ir","execution_count":null,"outputs":[{"output_type":"execute_result","data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'『ウマ娘』次回「レオ杯」8月下旬開催!阪神、芝...気になるレース環境は?'"]},"metadata":{"tags":[]},"execution_count":281}]},{"cell_type":"code","metadata":{"id":"SGrFWKmMQX33"},"source":["re.sub().split(\" \")[1:-1]"],"id":"SGrFWKmMQX33","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"KPVbm1NxN_uK"},"source":["re.sub?"],"id":"KPVbm1NxN_uK","execution_count":null,"outputs":[]},{"cell_type":"code","metadata":{"id":"hMx9de2vOAzZ"},"source":[""],"id":"hMx9de2vOAzZ","execution_count":null,"outputs":[]}]}